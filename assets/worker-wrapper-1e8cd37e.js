class cs{constructor(){this._listeners={}}addEventListener(e,r){const n=this._listeners;return n[e]===void 0&&(n[e]=[]),n[e].indexOf(r)===-1&&n[e].push(r),this}removeEventListener(e,r){if(this._listeners===void 0)return this;const s=this._listeners[e];if(s!==void 0){const i=s.indexOf(r);i!==-1&&s.splice(i,1)}return this}dispatchEvent(e){if(this._listeners===void 0)return this;const n=this._listeners[e.type];if(n!==void 0){const s=n.slice(0);for(let i=0,a=s.length;i<a;i++)s[i].call(this,e)}return this}dispose(){for(const e in this._listeners)delete this._listeners[e]}}class tr extends cs{constructor(e,r,n,s={}){if(super(),this._name=void 0,this._parent=void 0,this._child=void 0,this._attributes=void 0,this._disposed=!1,this._name=e,this._parent=r,this._child=n,this._attributes=s,!r.isOnGraph(n))throw new Error("Cannot connect disconnected graphs.")}getName(){return this._name}getParent(){return this._parent}getChild(){return this._child}setChild(e){return this._child=e,this}getAttributes(){return this._attributes}dispose(){this._disposed||(this._disposed=!0,this.dispatchEvent({type:"dispose",target:this}),super.dispose())}isDisposed(){return this._disposed}}class hf extends cs{constructor(...e){super(...e),this._emptySet=new Set,this._edges=new Set,this._parentEdges=new Map,this._childEdges=new Map}listEdges(){return Array.from(this._edges)}listParentEdges(e){return Array.from(this._childEdges.get(e)||this._emptySet)}listParents(e){return this.listParentEdges(e).map(r=>r.getParent())}listChildEdges(e){return Array.from(this._parentEdges.get(e)||this._emptySet)}listChildren(e){return this.listChildEdges(e).map(r=>r.getChild())}disconnectParents(e,r){let n=this.listParentEdges(e);return r&&(n=n.filter(s=>r(s.getParent()))),n.forEach(s=>s.dispose()),this}createEdge(e,r,n,s){return this._registerEdge(new tr(e,r,n,s))}_registerEdge(e){this._edges.add(e);const r=e.getParent();this._parentEdges.has(r)||this._parentEdges.set(r,new Set),this._parentEdges.get(r).add(e);const n=e.getChild();return this._childEdges.has(n)||this._childEdges.set(n,new Set),this._childEdges.get(n).add(e),e.addEventListener("dispose",()=>this._removeEdge(e)),e}_removeEdge(e){return this._edges.delete(e),this._parentEdges.get(e.getParent()).delete(e),this._childEdges.get(e.getChild()).delete(e),this}}function Rr(){return Rr=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},Rr.apply(this,arguments)}function qn(t){return t instanceof tr}function vr(t){return Array.isArray(t)&&t[0]instanceof tr}function xr(t){return!!(gf(t)&&pf(t)instanceof tr)}function pf(t){for(const e in t)return t[e]}function gf(t){return!!t&&Object.getPrototypeOf(t)===Object.prototype}const fe=Symbol("attributes"),Jt=Symbol("immutableKeys");class ls extends cs{constructor(e){super(),this._disposed=!1,this.graph=void 0,this[fe]=void 0,this[Jt]=void 0,this.graph=e,this[Jt]=new Set,this[fe]=this._createAttributes()}getDefaults(){return{}}_createAttributes(){const e=this.getDefaults(),r={};for(const n in e){const s=e[n];if(s instanceof ls){const i=this.graph.createEdge(n,this,s);i.addEventListener("dispose",()=>s.dispose()),this[Jt].add(n),r[n]=i}else r[n]=s}return r}isOnGraph(e){return this.graph===e.graph}isDisposed(){return this._disposed}dispose(){this._disposed||(this.graph.listChildEdges(this).forEach(e=>e.dispose()),this.graph.disconnectParents(this),this._disposed=!0,this.dispatchEvent({type:"dispose"}))}detach(){return this.graph.disconnectParents(this),this}swap(e,r){for(const n in this[fe]){const s=this[fe][n];if(qn(s)){const i=s;i.getChild()===e&&this.setRef(n,r,i.getAttributes())}else if(vr(s)){const a=s.find(o=>o.getChild()===e);if(a){const o=a.getAttributes();this.removeRef(n,e).addRef(n,r,o)}}else if(xr(s)){const i=s;for(const a in i){const o=i[a];o.getChild()===e&&this.setRefMap(n,a,r,o.getAttributes())}}}return this}get(e){return this[fe][e]}set(e,r){return this[fe][e]=r,this.dispatchEvent({type:"change",attribute:e})}getRef(e){const r=this[fe][e];return r?r.getChild():null}setRef(e,r,n){if(this[Jt].has(e))throw new Error(`Cannot overwrite immutable attribute, "${e}".`);const s=this[fe][e];if(s&&s.dispose(),!r)return this;const i=this.graph.createEdge(e,this,r,n);return i.addEventListener("dispose",()=>{delete this[fe][e],this.dispatchEvent({type:"change",attribute:e})}),this[fe][e]=i,this.dispatchEvent({type:"change",attribute:e})}listRefs(e){return this[fe][e].map(n=>n.getChild())}addRef(e,r,n){const s=this.graph.createEdge(e,this,r,n),i=this[fe][e];return i.push(s),s.addEventListener("dispose",()=>{let a;for(;(a=i.indexOf(s))!==-1;)i.splice(a,1);this.dispatchEvent({type:"change",attribute:e})}),this.dispatchEvent({type:"change",attribute:e})}removeRef(e,r){return this[fe][e].filter(i=>i.getChild()===r).forEach(i=>i.dispose()),this}listRefMapKeys(e){return Object.keys(this[fe][e])}listRefMapValues(e){return Object.values(this[fe][e]).map(r=>r.getChild())}getRefMap(e,r){const n=this[fe][e];return n[r]?n[r].getChild():null}setRefMap(e,r,n,s){const i=this[fe][e],a=i[r];if(a&&a.dispose(),!n)return this;s=Object.assign(s||{},{key:r});const o=this.graph.createEdge(e,this,n,Rr({},s,{key:r}));return o.addEventListener("dispose",()=>{delete i[r],this.dispatchEvent({type:"change",attribute:e,key:r})}),i[r]=o,this.dispatchEvent({type:"change",attribute:e,key:r})}dispatchEvent(e){return super.dispatchEvent(Rr({},e,{target:this})),this.graph.dispatchEvent(Rr({},e,{target:this,type:`node:${e.type}`})),this}}const ki="v3.10.1",rr="@glb.bin";var q,nn,ze,et,Ut;(function(t){t.ACCESSOR="Accessor",t.ANIMATION="Animation",t.ANIMATION_CHANNEL="AnimationChannel",t.ANIMATION_SAMPLER="AnimationSampler",t.BUFFER="Buffer",t.CAMERA="Camera",t.MATERIAL="Material",t.MESH="Mesh",t.PRIMITIVE="Primitive",t.PRIMITIVE_TARGET="PrimitiveTarget",t.NODE="Node",t.ROOT="Root",t.SCENE="Scene",t.SKIN="Skin",t.TEXTURE="Texture",t.TEXTURE_INFO="TextureInfo"})(q||(q={})),function(t){t.INTERLEAVED="interleaved",t.SEPARATE="separate"}(nn||(nn={})),function(t){t.ARRAY_BUFFER="ARRAY_BUFFER",t.ELEMENT_ARRAY_BUFFER="ELEMENT_ARRAY_BUFFER",t.INVERSE_BIND_MATRICES="INVERSE_BIND_MATRICES",t.OTHER="OTHER",t.SPARSE="SPARSE"}(ze||(ze={})),function(t){t[t.R=4096]="R",t[t.G=256]="G",t[t.B=16]="B",t[t.A=1]="A"}(et||(et={})),function(t){t.GLTF="GLTF",t.GLB="GLB"}(Ut||(Ut={}));const sn={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};var Hr,Hn=typeof Float32Array<"u"?Float32Array:Array;function Un(t){return Math.hypot(t[0],t[1],t[2])}function df(t,e,r){var n=e[0],s=e[1],i=e[2],a=r[3]*n+r[7]*s+r[11]*i+r[15];return t[0]=(r[0]*n+r[4]*s+r[8]*i+r[12])/(a=a||1),t[1]=(r[1]*n+r[5]*s+r[9]*i+r[13])/a,t[2]=(r[2]*n+r[6]*s+r[10]*i+r[14])/a,t}function mf(t){const e={min:[1/0,1/0,1/0],max:[-1/0,-1/0,-1/0]},r=t.propertyType===q.NODE?[t]:t.listChildren();for(const n of r)n.traverse(s=>{const i=s.getMesh();if(!i)return;const a=vf(i,s.getWorldMatrix());Wn(a.min,e),Wn(a.max,e)});return e}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)}),Hr=new Hn(3),Hn!=Float32Array&&(Hr[0]=0,Hr[1]=0,Hr[2]=0);function vf(t,e){const r={min:[1/0,1/0,1/0],max:[-1/0,-1/0,-1/0]};for(const n of t.listPrimitives()){const s=n.getAttribute("POSITION");if(!s)continue;let i=[0,0,0],a=[0,0,0];for(let o=0;o<s.getCount();o++)i=s.getElement(o,i),a=df(a,i,e),Wn(a,r)}return r}function Wn(t,e){for(let r=0;r<3;r++)e.min[r]=Math.min(t[r],e.min[r]),e.max[r]=Math.max(t[r],e.max[r])}class Q{static createBufferFromDataURI(e){if(typeof Buffer>"u"){const r=atob(e.split(",")[1]),n=new Uint8Array(r.length);for(let s=0;s<r.length;s++)n[s]=r.charCodeAt(s);return n}{const r=e.split(",")[1],n=e.indexOf("base64")>=0;return Buffer.from(r,n?"base64":"utf8")}}static encodeText(e){return typeof TextEncoder<"u"?new TextEncoder().encode(e):Buffer.from(e)}static decodeText(e){return typeof TextDecoder<"u"?new TextDecoder().decode(e):Buffer.from(e).toString("utf8")}static concat(e){let r=0;for(const i of e)r+=i.byteLength;const n=new Uint8Array(r);let s=0;for(const i of e)n.set(i,s),s+=i.byteLength;return n}static pad(e,r=0){const n=this.padNumber(e.byteLength);if(n===e.byteLength)return e;const s=new Uint8Array(n);if(s.set(e),r!==0)for(let i=e.byteLength;i<n;i++)s[i]=r;return s}static padNumber(e){return 4*Math.ceil(e/4)}static equals(e,r){if(e===r)return!0;if(e.byteLength!==r.byteLength)return!1;let n=e.byteLength;for(;n--;)if(e[n]!==r[n])return!1;return!0}static toView(e,r=0,n=1/0){return new Uint8Array(e.buffer,e.byteOffset+r,Math.min(e.byteLength,n))}static assertView(e){if(e&&!ArrayBuffer.isView(e))throw new Error(`Method requires Uint8Array parameter; received "${typeof e}".`);return e}}let Be=class{static hexToFactor(e,r){e=Math.floor(e);const n=r;return n[0]=(e>>16&255)/255,n[1]=(e>>8&255)/255,n[2]=(255&e)/255,this.convertSRGBToLinear(r,r)}static factorToHex(e){const r=[...e],[n,s,i]=this.convertLinearToSRGB(e,r);return 255*n<<16^255*s<<8^255*i<<0}static convertSRGBToLinear(e,r){const n=e,s=r;for(let i=0;i<3;i++)s[i]=n[i]<.04045?.0773993808*n[i]:Math.pow(.9478672986*n[i]+.0521327014,2.4);return r}static convertLinearToSRGB(e,r){const n=e,s=r;for(let i=0;i<3;i++)s[i]=n[i]<.0031308?12.92*n[i]:1.055*Math.pow(n[i],.41666)-.055;return r}},Gi=class qi{match(e){return e.length>=8&&e[0]===137&&e[1]===80&&e[2]===78&&e[3]===71&&e[4]===13&&e[5]===10&&e[6]===26&&e[7]===10}getSize(e){const r=new DataView(e.buffer,e.byteOffset);return Q.decodeText(e.slice(12,16))===qi.PNG_FRIED_CHUNK_NAME?[r.getUint32(32,!1),r.getUint32(36,!1)]:[r.getUint32(16,!1),r.getUint32(20,!1)]}getChannels(e){return 4}};Gi.PNG_FRIED_CHUNK_NAME="CgBI";let ot=class{static registerFormat(e,r){this.impls[e]=r}static getMimeType(e){for(const r in this.impls)if(this.impls[r].match(e))return r;return null}static getSize(e,r){return this.impls[r]?this.impls[r].getSize(e):null}static getChannels(e,r){return this.impls[r]?this.impls[r].getChannels(e):null}static getVRAMByteLength(e,r){if(!this.impls[r])return null;if(this.impls[r].getVRAMByteLength)return this.impls[r].getVRAMByteLength(e);let n=0;const s=this.getSize(e,r);if(!s)return null;for(;s[0]>1||s[1]>1;)n+=s[0]*s[1]*4,s[0]=Math.max(Math.floor(s[0]/2),1),s[1]=Math.max(Math.floor(s[1]/2),1);return n+=4,n}static mimeTypeToExtension(e){return e==="image/jpeg"?"jpg":e.split("/").pop()}static extensionToMimeType(e){return e==="jpg"?"image/jpeg":e?`image/${e}`:""}};function xf(t,e){if(e>t.byteLength)throw new TypeError("Corrupt JPG, exceeded buffer limits");if(t.getUint8(e)!==255)throw new TypeError("Invalid JPG, marker table corrupted");return t}ot.impls={"image/jpeg":new class{match(t){return t.length>=3&&t[0]===255&&t[1]===216&&t[2]===255}getSize(t){let e,r,n=new DataView(t.buffer,t.byteOffset+4);for(;n.byteLength;){if(e=n.getUint16(0,!1),xf(n,e),r=n.getUint8(e+1),r===192||r===193||r===194)return[n.getUint16(e+7,!1),n.getUint16(e+5,!1)];n=new DataView(t.buffer,n.byteOffset+e+2)}throw new TypeError("Invalid JPG, no size found")}getChannels(t){return 3}},"image/png":new Gi};let nr=class{static basename(e){const r=e.split(/[\\/]/).pop();return r.substring(0,r.lastIndexOf("."))}static extension(e){if(e.startsWith("data:image/")){const r=e.match(/data:(image\/\w+)/)[1];return ot.mimeTypeToExtension(r)}return e.startsWith("data:model/gltf+json")?"gltf":e.startsWith("data:model/gltf-binary")?"glb":e.startsWith("data:application/")?"bin":e.split(/[\\/]/).pop().split(/[.]/).pop()}};function pi(t){return Object.prototype.toString.call(t)==="[object Object]"}function Dt(t){if(pi(t)===!1)return!1;const e=t.constructor;if(e===void 0)return!0;const r=e.prototype;return pi(r)!==!1&&Object.prototype.hasOwnProperty.call(r,"isPrototypeOf")!==!1}var Ln,Xn;(function(t){t[t.SILENT=4]="SILENT",t[t.ERROR=3]="ERROR",t[t.WARN=2]="WARN",t[t.INFO=1]="INFO",t[t.DEBUG=0]="DEBUG"})(Xn||(Xn={}));let Lt=class yr{constructor(e){this.verbosity=void 0,this.verbosity=e}debug(e){this.verbosity<=yr.Verbosity.DEBUG&&console.debug(e)}info(e){this.verbosity<=yr.Verbosity.INFO&&console.info(e)}warn(e){this.verbosity<=yr.Verbosity.WARN&&console.warn(e)}error(e){this.verbosity<=yr.Verbosity.ERROR&&console.error(e)}};function yf(t,e,r){var n=e[0],s=e[1],i=e[2],a=e[3],o=e[4],c=e[5],f=e[6],h=e[7],d=e[8],m=e[9],y=e[10],M=e[11],R=e[12],p=e[13],w=e[14],g=e[15],x=r[0],T=r[1],I=r[2],b=r[3];return t[0]=x*n+T*o+I*d+b*R,t[1]=x*s+T*c+I*m+b*p,t[2]=x*i+T*f+I*y+b*w,t[3]=x*a+T*h+I*M+b*g,t[4]=(x=r[4])*n+(T=r[5])*o+(I=r[6])*d+(b=r[7])*R,t[5]=x*s+T*c+I*m+b*p,t[6]=x*i+T*f+I*y+b*w,t[7]=x*a+T*h+I*M+b*g,t[8]=(x=r[8])*n+(T=r[9])*o+(I=r[10])*d+(b=r[11])*R,t[9]=x*s+T*c+I*m+b*p,t[10]=x*i+T*f+I*y+b*w,t[11]=x*a+T*h+I*M+b*g,t[12]=(x=r[12])*n+(T=r[13])*o+(I=r[14])*d+(b=r[15])*R,t[13]=x*s+T*c+I*m+b*p,t[14]=x*i+T*f+I*y+b*w,t[15]=x*a+T*h+I*M+b*g,t}Ln=Lt,Lt.Verbosity=Xn,Lt.DEFAULT_INSTANCE=new Ln(Ln.Verbosity.INFO);let ve=class Yn{static identity(e){return e}static eq(e,r,n=1e-5){if(e.length!==r.length)return!1;for(let s=0;s<e.length;s++)if(Math.abs(e[s]-r[s])>n)return!1;return!0}static decodeNormalizedInt(e,r){switch(r){case 5126:return e;case 5123:return e/65535;case 5121:return e/255;case 5122:return Math.max(e/32767,-1);case 5120:return Math.max(e/127,-1);default:throw new Error("Invalid component type.")}}static denormalize(e,r){return Yn.decodeNormalizedInt(e,r)}static encodeNormalizedInt(e,r){switch(r){case 5126:return e;case 5123:return Math.round(65535*e);case 5121:return Math.round(255*e);case 5122:return Math.round(32767*e);case 5120:return Math.round(127*e);default:throw new Error("Invalid component type.")}}static normalize(e,r){return Yn.encodeNormalizedInt(e,r)}static decompose(e,r,n,s){let i=Un([e[0],e[1],e[2]]);const a=Un([e[4],e[5],e[6]]),o=Un([e[8],e[9],e[10]]);var c,f,h,d,m,y,M,R,p,w,g,x,T,I,b,F,O;((f=(c=e)[0])*(M=c[5])-(h=c[1])*(y=c[4]))*((x=c[10])*(O=c[15])-(T=c[11])*(F=c[14]))-(f*(R=c[6])-(d=c[2])*y)*((g=c[9])*O-T*(b=c[13]))+(f*(p=c[7])-(m=c[3])*y)*(g*F-x*b)+(h*R-d*M)*((w=c[8])*O-T*(I=c[12]))-(h*p-m*M)*(w*F-x*I)+(d*p-m*R)*(w*b-g*I)<0&&(i=-i),r[0]=e[12],r[1]=e[13],r[2]=e[14];const C=e.slice(),V=1/i,L=1/a,j=1/o;C[0]*=V,C[1]*=V,C[2]*=V,C[4]*=L,C[5]*=L,C[6]*=L,C[8]*=j,C[9]*=j,C[10]*=j,function(G,P){var Y=new Hn(3);(function(mt,Fe){var ct=Fe[4],xt=Fe[5],tt=Fe[6],Fr=Fe[8],Tn=Fe[9],Dr=Fe[10];mt[0]=Math.hypot(Fe[0],Fe[1],Fe[2]),mt[1]=Math.hypot(ct,xt,tt),mt[2]=Math.hypot(Fr,Tn,Dr)})(Y,P);var te=1/Y[0],K=1/Y[1],ie=1/Y[2],se=P[0]*te,ae=P[1]*K,oe=P[2]*ie,he=P[4]*te,Ae=P[5]*K,ge=P[6]*ie,ce=P[8]*te,Ce=P[9]*K,He=P[10]*ie,dt=se+Ae+He,le=0;dt>0?(le=2*Math.sqrt(dt+1),G[3]=.25*le,G[0]=(ge-Ce)/le,G[1]=(ce-oe)/le,G[2]=(ae-he)/le):se>Ae&&se>He?(le=2*Math.sqrt(1+se-Ae-He),G[3]=(ge-Ce)/le,G[0]=.25*le,G[1]=(ae+he)/le,G[2]=(ce+oe)/le):Ae>He?(le=2*Math.sqrt(1+Ae-se-He),G[3]=(ce-oe)/le,G[0]=(ae+he)/le,G[1]=.25*le,G[2]=(ge+Ce)/le):(le=2*Math.sqrt(1+He-se-Ae),G[3]=(ae-he)/le,G[0]=(ce+oe)/le,G[1]=(ge+Ce)/le,G[2]=.25*le)}(n,C),s[0]=i,s[1]=a,s[2]=o}static compose(e,r,n,s){const i=s,a=r[0],o=r[1],c=r[2],f=r[3],h=a+a,d=o+o,m=c+c,y=a*h,M=a*d,R=a*m,p=o*d,w=o*m,g=c*m,x=f*h,T=f*d,I=f*m,b=n[0],F=n[1],O=n[2];return i[0]=(1-(p+g))*b,i[1]=(M+I)*b,i[2]=(R-T)*b,i[3]=0,i[4]=(M-I)*F,i[5]=(1-(y+g))*F,i[6]=(w+x)*F,i[7]=0,i[8]=(R+T)*O,i[9]=(w-x)*O,i[10]=(1-(y+p))*O,i[11]=0,i[12]=e[0],i[13]=e[1],i[14]=e[2],i[15]=1,i}};function Tf(t,e){if(!!t!=!!e)return!1;const r=t.getChild(),n=e.getChild();return r===n||r.equals(n)}function Mf(t,e){if(!!t!=!!e||t.length!==e.length)return!1;for(let r=0;r<t.length;r++){const n=t[r],s=e[r];if(n.getChild()!==s.getChild()&&!n.getChild().equals(s.getChild()))return!1}return!0}function Ef(t,e){if(!!t!=!!e)return!1;const r=Object.keys(t),n=Object.keys(e);if(r.length!==n.length)return!1;for(const s in t){const i=t[s],a=e[s];if(!!i!=!!a)return!1;const o=i.getChild(),c=a.getChild();if(o!==c&&!o.equals(c))return!1}return!0}function Hi(t,e){if(t===e)return!0;if(!!t!=!!e||!t||!e||t.length!==e.length)return!1;for(let r=0;r<t.length;r++)if(t[r]!==e[r])return!1;return!0}function Wi(t,e){if(t===e)return!0;if(!!t!=!!e)return!1;if(!Dt(t)||!Dt(e))return t===e;const r=t,n=e;let s,i=0,a=0;for(s in r)i++;for(s in n)a++;if(i!==a)return!1;for(s in r){const o=r[s],c=n[s];if(an(o)&&an(c)){if(!Hi(o,c))return!1}else if(Dt(o)&&Dt(c)){if(!Wi(o,c))return!1}else if(o!==c)return!1}return!0}function an(t){return Array.isArray(t)||ArrayBuffer.isView(t)}const gi=new Set,Rf=function(){let t="";for(let e=0;e<6;e++)t+="23456789abdegjkmnpqrvwxyzABDEGJKMNPQRVWXYZ".charAt(Math.floor(42*Math.random()));return t},wf=function(){for(let t=0;t<999;t++){const e=Rf();if(!gi.has(e))return gi.add(e),e}return""},di="https://null.example";let wr=class{static dirname(e){const r=e.lastIndexOf("/");return r===-1?"./":e.substring(0,r+1)}static basename(e){return nr.basename(new URL(e,di).pathname)}static extension(e){return nr.extension(new URL(e,di).pathname)}static resolve(e,r){if(!this.isRelativePath(r))return r;const n=e.split("/"),s=r.split("/");n.pop();for(let i=0;i<s.length;i++)s[i]!=="."&&(s[i]===".."?n.pop():n.push(s[i]));return n.join("/")}static isAbsoluteURL(e){return this.PROTOCOL_REGEXP.test(e)}static isRelativePath(e){return!/^(?:[a-zA-Z]+:)?\//.test(e)}};wr.DEFAULT_INIT={},wr.PROTOCOL_REGEXP=/^[a-zA-Z]+:\/\//;const gt=t=>t,If=new Set;let fs=class extends ls{constructor(e,r=""){super(e),this[fe].name=r,this.init(),this.dispatchEvent({type:"create"})}getGraph(){return this.graph}getDefaults(){return Object.assign(super.getDefaults(),{name:"",extras:{}})}set(e,r){return Array.isArray(r)&&(r=r.slice()),super.set(e,r)}getName(){return this.get("name")}setName(e){return this.set("name",e)}getExtras(){return this.get("extras")}setExtras(e){return this.set("extras",e)}clone(){return new this.constructor(this.graph).copy(this,gt)}copy(e,r=gt){for(const n in this[fe]){const s=this[fe][n];if(s instanceof tr)this[Jt].has(n)||s.dispose();else if(vr(s))for(const i of s)i.dispose();else if(xr(s))for(const i in s)s[i].dispose()}for(const n in e[fe]){const s=this[fe][n],i=e[fe][n];if(i instanceof tr)this[Jt].has(n)?s.getChild().copy(r(i.getChild()),r):this.setRef(n,r(i.getChild()),i.getAttributes());else if(vr(i))for(const a of i)this.addRef(n,r(a.getChild()),a.getAttributes());else if(xr(i))for(const a in i){const o=i[a];this.setRefMap(n,a,r(o.getChild()),o.getAttributes())}else this[fe][n]=Dt(i)?JSON.parse(JSON.stringify(i)):Array.isArray(i)||i instanceof ArrayBuffer||ArrayBuffer.isView(i)?i.slice():i}return this}equals(e,r=If){if(this===e)return!0;if(this.propertyType!==e.propertyType)return!1;for(const n in this[fe]){if(r.has(n))continue;const s=this[fe][n],i=e[fe][n];if(qn(s)||qn(i)){if(!Tf(s,i))return!1}else if(vr(s)||vr(i)){if(!Mf(s,i))return!1}else if(xr(s)||xr(i)){if(!Ef(s,i))return!1}else if(Dt(s)||Dt(i)){if(!Wi(s,i))return!1}else if(an(s)||an(i)){if(!Hi(s,i))return!1}else if(s!==i)return!1}return!0}detach(){return this.graph.disconnectParents(this,e=>e.propertyType!=="Root"),this}listParents(){return this.graph.listParents(this)}},Le=class extends fs{getDefaults(){return Object.assign(super.getDefaults(),{extensions:{}})}getExtension(e){return this.getRefMap("extensions",e)}setExtension(e,r){return r&&r.t(this),this.setRefMap("extensions",e,r)}listExtensions(){return this.listRefMapValues("extensions")}},X=class de extends Le{constructor(...e){super(...e),this.i=ve.identity,this.o=ve.identity}init(){this.propertyType=q.ACCESSOR}getDefaults(){return Object.assign(super.getDefaults(),{array:null,type:de.Type.SCALAR,componentType:de.ComponentType.FLOAT,normalized:!1,sparse:!1,buffer:null})}copy(e,r=gt){return super.copy(e,r),this.i=e.i,this.o=e.o,this}static getElementSize(e){switch(e){case de.Type.SCALAR:return 1;case de.Type.VEC2:return 2;case de.Type.VEC3:return 3;case de.Type.VEC4:case de.Type.MAT2:return 4;case de.Type.MAT3:return 9;case de.Type.MAT4:return 16;default:throw new Error("Unexpected type: "+e)}}static getComponentSize(e){switch(e){case de.ComponentType.BYTE:case de.ComponentType.UNSIGNED_BYTE:return 1;case de.ComponentType.SHORT:case de.ComponentType.UNSIGNED_SHORT:return 2;case de.ComponentType.UNSIGNED_INT:case de.ComponentType.FLOAT:return 4;default:throw new Error("Unexpected component type: "+e)}}getMinNormalized(e){const r=this.getElementSize();this.getMin(e);for(let n=0;n<r;n++)e[n]=this.o(e[n]);return e}getMin(e){const r=this.get("array"),n=this.getCount(),s=this.getElementSize();for(let i=0;i<s;i++)e[i]=1/0;for(let i=0;i<n*s;i+=s)for(let a=0;a<s;a++){const o=r[i+a];Number.isFinite(o)&&(e[a]=Math.min(e[a],o))}return e}getMaxNormalized(e){const r=this.getElementSize();this.getMax(e);for(let n=0;n<r;n++)e[n]=this.o(e[n]);return e}getMax(e){const r=this.get("array"),n=this.getCount(),s=this.getElementSize();for(let i=0;i<s;i++)e[i]=-1/0;for(let i=0;i<n*s;i+=s)for(let a=0;a<s;a++){const o=r[i+a];Number.isFinite(o)&&(e[a]=Math.max(e[a],o))}return e}getCount(){const e=this.get("array");return e?e.length/this.getElementSize():0}getType(){return this.get("type")}setType(e){return this.set("type",e)}getElementSize(){return de.getElementSize(this.get("type"))}getComponentSize(){return this.get("array").BYTES_PER_ELEMENT}getComponentType(){return this.get("componentType")}getNormalized(){return this.get("normalized")}setNormalized(e){return this.set("normalized",e),e?(this.o=r=>ve.decodeNormalizedInt(r,this.get("componentType")),this.i=r=>ve.encodeNormalizedInt(r,this.get("componentType"))):(this.o=ve.identity,this.i=ve.identity),this}getScalar(e){const r=this.getElementSize();return this.o(this.get("array")[e*r])}setScalar(e,r){return this.get("array")[e*this.getElementSize()]=this.i(r),this}getElement(e,r){const n=this.getElementSize(),s=this.get("array");for(let i=0;i<n;i++)r[i]=this.o(s[e*n+i]);return r}setElement(e,r){const n=this.getElementSize(),s=this.get("array");for(let i=0;i<n;i++)s[e*n+i]=this.i(r[i]);return this}getSparse(){return this.get("sparse")}setSparse(e){return this.set("sparse",e)}getBuffer(){return this.getRef("buffer")}setBuffer(e){return this.setRef("buffer",e)}getArray(){return this.get("array")}setArray(e){return this.set("componentType",e?function(r){switch(r.constructor){case Float32Array:return de.ComponentType.FLOAT;case Uint32Array:return de.ComponentType.UNSIGNED_INT;case Uint16Array:return de.ComponentType.UNSIGNED_SHORT;case Uint8Array:return de.ComponentType.UNSIGNED_BYTE;case Int16Array:return de.ComponentType.SHORT;case Int8Array:return de.ComponentType.BYTE;default:throw new Error("Unknown accessor componentType.")}}(e):de.ComponentType.FLOAT),this.set("array",e),this}getByteLength(){const e=this.get("array");return e?e.byteLength:0}};X.Type={SCALAR:"SCALAR",VEC2:"VEC2",VEC3:"VEC3",VEC4:"VEC4",MAT2:"MAT2",MAT3:"MAT3",MAT4:"MAT4"},X.ComponentType={BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,UNSIGNED_INT:5125,FLOAT:5126};let Xi=class extends Le{init(){this.propertyType=q.ANIMATION}getDefaults(){return Object.assign(super.getDefaults(),{channels:[],samplers:[]})}addChannel(e){return this.addRef("channels",e)}removeChannel(e){return this.removeRef("channels",e)}listChannels(){return this.listRefs("channels")}addSampler(e){return this.addRef("samplers",e)}removeSampler(e){return this.removeRef("samplers",e)}listSamplers(){return this.listRefs("samplers")}},us=class extends Le{init(){this.propertyType=q.ANIMATION_CHANNEL}getDefaults(){return Object.assign(super.getDefaults(),{targetPath:null,targetNode:null,sampler:null})}getTargetPath(){return this.get("targetPath")}setTargetPath(e){return this.set("targetPath",e)}getTargetNode(){return this.getRef("targetNode")}setTargetNode(e){return this.setRef("targetNode",e)}getSampler(){return this.getRef("sampler")}setSampler(e){return this.setRef("sampler",e)}};us.TargetPath={TRANSLATION:"translation",ROTATION:"rotation",SCALE:"scale",WEIGHTS:"weights"};let mn=class Yi extends Le{init(){this.propertyType=q.ANIMATION_SAMPLER}getDefaultAttributes(){return Object.assign(super.getDefaults(),{interpolation:Yi.Interpolation.LINEAR,input:null,output:null})}getInterpolation(){return this.get("interpolation")}setInterpolation(e){return this.set("interpolation",e)}getInput(){return this.getRef("input")}setInput(e){return this.setRef("input",e,{usage:ze.OTHER})}getOutput(){return this.getRef("output")}setOutput(e){return this.setRef("output",e,{usage:ze.OTHER})}};mn.Interpolation={LINEAR:"LINEAR",STEP:"STEP",CUBICSPLINE:"CUBICSPLINE"};let Ki=class extends Le{init(){this.propertyType=q.BUFFER}getDefaults(){return Object.assign(super.getDefaults(),{uri:""})}getURI(){return this.get("uri")}setURI(e){return this.set("uri",e)}},$r=class Ji extends Le{init(){this.propertyType=q.CAMERA}getDefaults(){return Object.assign(super.getDefaults(),{type:Ji.Type.PERSPECTIVE,znear:.1,zfar:100,aspectRatio:null,yfov:2*Math.PI*50/360,xmag:1,ymag:1})}getType(){return this.get("type")}setType(e){return this.set("type",e)}getZNear(){return this.get("znear")}setZNear(e){return this.set("znear",e)}getZFar(){return this.get("zfar")}setZFar(e){return this.set("zfar",e)}getAspectRatio(){return this.get("aspectRatio")}setAspectRatio(e){return this.set("aspectRatio",e)}getYFov(){return this.get("yfov")}setYFov(e){return this.set("yfov",e)}getXMag(){return this.get("xmag")}setXMag(e){return this.set("xmag",e)}getYMag(){return this.get("ymag")}setYMag(e){return this.set("ymag",e)}};$r.Type={PERSPECTIVE:"perspective",ORTHOGRAPHIC:"orthographic"};let we=class extends fs{t(e){if(!this.parentTypes.includes(e.propertyType))throw new Error(`Parent "${e.propertyType}" invalid for child "${this.propertyType}".`)}};we.EXTENSION_NAME=void 0;let ye=class Kn extends Le{init(){this.propertyType=q.TEXTURE_INFO}getDefaults(){return Object.assign(super.getDefaults(),{texCoord:0,magFilter:null,minFilter:null,wrapS:Kn.WrapMode.REPEAT,wrapT:Kn.WrapMode.REPEAT})}getTexCoord(){return this.get("texCoord")}setTexCoord(e){return this.set("texCoord",e)}getMagFilter(){return this.get("magFilter")}setMagFilter(e){return this.set("magFilter",e)}getMinFilter(){return this.get("minFilter")}setMinFilter(e){return this.set("minFilter",e)}getWrapS(){return this.get("wrapS")}setWrapS(e){return this.set("wrapS",e)}getWrapT(){return this.get("wrapT")}setWrapT(e){return this.set("wrapT",e)}};ye.WrapMode={CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648,REPEAT:10497},ye.MagFilter={NEAREST:9728,LINEAR:9729},ye.MinFilter={NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987};const{R:Wr,G:Xr,B:Yr,A:Af}=et;let sr=class Zi extends Le{init(){this.propertyType=q.MATERIAL}getDefaults(){return Object.assign(super.getDefaults(),{alphaMode:Zi.AlphaMode.OPAQUE,alphaCutoff:.5,doubleSided:!1,baseColorFactor:[1,1,1,1],baseColorTexture:null,baseColorTextureInfo:new ye(this.graph,"baseColorTextureInfo"),emissiveFactor:[0,0,0],emissiveTexture:null,emissiveTextureInfo:new ye(this.graph,"emissiveTextureInfo"),normalScale:1,normalTexture:null,normalTextureInfo:new ye(this.graph,"normalTextureInfo"),occlusionStrength:1,occlusionTexture:null,occlusionTextureInfo:new ye(this.graph,"occlusionTextureInfo"),roughnessFactor:1,metallicFactor:1,metallicRoughnessTexture:null,metallicRoughnessTextureInfo:new ye(this.graph,"metallicRoughnessTextureInfo")})}getDoubleSided(){return this.get("doubleSided")}setDoubleSided(e){return this.set("doubleSided",e)}getAlpha(){return this.get("baseColorFactor")[3]}setAlpha(e){const r=this.get("baseColorFactor").slice();return r[3]=e,this.set("baseColorFactor",r)}getAlphaMode(){return this.get("alphaMode")}setAlphaMode(e){return this.set("alphaMode",e)}getAlphaCutoff(){return this.get("alphaCutoff")}setAlphaCutoff(e){return this.set("alphaCutoff",e)}getBaseColorFactor(){return this.get("baseColorFactor")}setBaseColorFactor(e){return this.set("baseColorFactor",e)}getBaseColorHex(){return Be.factorToHex(this.get("baseColorFactor"))}setBaseColorHex(e){const r=this.get("baseColorFactor").slice();return this.set("baseColorFactor",Be.hexToFactor(e,r))}getBaseColorTexture(){return this.getRef("baseColorTexture")}getBaseColorTextureInfo(){return this.getRef("baseColorTexture")?this.getRef("baseColorTextureInfo"):null}setBaseColorTexture(e){return this.setRef("baseColorTexture",e,{channels:Wr|Xr|Yr|Af,isColor:!0})}getEmissiveFactor(){return this.get("emissiveFactor")}setEmissiveFactor(e){return this.set("emissiveFactor",e)}getEmissiveHex(){return Be.factorToHex(this.get("emissiveFactor"))}setEmissiveHex(e){const r=this.get("emissiveFactor").slice();return this.set("emissiveFactor",Be.hexToFactor(e,r))}getEmissiveTexture(){return this.getRef("emissiveTexture")}getEmissiveTextureInfo(){return this.getRef("emissiveTexture")?this.getRef("emissiveTextureInfo"):null}setEmissiveTexture(e){return this.setRef("emissiveTexture",e,{channels:Wr|Xr|Yr,isColor:!0})}getNormalScale(){return this.get("normalScale")}setNormalScale(e){return this.set("normalScale",e)}getNormalTexture(){return this.getRef("normalTexture")}getNormalTextureInfo(){return this.getRef("normalTexture")?this.getRef("normalTextureInfo"):null}setNormalTexture(e){return this.setRef("normalTexture",e,{channels:Wr|Xr|Yr})}getOcclusionStrength(){return this.get("occlusionStrength")}setOcclusionStrength(e){return this.set("occlusionStrength",e)}getOcclusionTexture(){return this.getRef("occlusionTexture")}getOcclusionTextureInfo(){return this.getRef("occlusionTexture")?this.getRef("occlusionTextureInfo"):null}setOcclusionTexture(e){return this.setRef("occlusionTexture",e,{channels:Wr})}getRoughnessFactor(){return this.get("roughnessFactor")}setRoughnessFactor(e){return this.set("roughnessFactor",e)}getMetallicFactor(){return this.get("metallicFactor")}setMetallicFactor(e){return this.set("metallicFactor",e)}getMetallicRoughnessTexture(){return this.getRef("metallicRoughnessTexture")}getMetallicRoughnessTextureInfo(){return this.getRef("metallicRoughnessTexture")?this.getRef("metallicRoughnessTextureInfo"):null}setMetallicRoughnessTexture(e){return this.setRef("metallicRoughnessTexture",e,{channels:Xr|Yr})}};sr.AlphaMode={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};let Qi=class extends Le{init(){this.propertyType=q.MESH}getDefaults(){return Object.assign(super.getDefaults(),{weights:[],primitives:[]})}addPrimitive(e){return this.addRef("primitives",e)}removePrimitive(e){return this.removeRef("primitives",e)}listPrimitives(){return this.listRefs("primitives")}getWeights(){return this.get("weights")}setWeights(e){return this.set("weights",e)}},ea=class extends Le{constructor(...e){super(...e),this.u=null,this.h=new Set}init(){this.propertyType=q.NODE}getDefaults(){return Object.assign(super.getDefaults(),{translation:[0,0,0],rotation:[0,0,0,1],scale:[1,1,1],weights:[],camera:null,mesh:null,skin:null,children:[]})}copy(e,r=gt){if(r===gt)throw new Error("Node cannot be copied.");return super.copy(e,r)}getTranslation(){return this.get("translation")}getRotation(){return this.get("rotation")}getScale(){return this.get("scale")}setTranslation(e){return this.set("translation",e)}setRotation(e){return this.set("rotation",e)}setScale(e){return this.set("scale",e)}getMatrix(){return ve.compose(this.get("translation"),this.get("rotation"),this.get("scale"),[])}setMatrix(e){const r=this.get("translation").slice(),n=this.get("rotation").slice(),s=this.get("scale").slice();return ve.decompose(e,r,n,s),this.set("translation",r).set("rotation",n).set("scale",s)}getWorldTranslation(){const e=[0,0,0];return ve.decompose(this.getWorldMatrix(),e,[0,0,0,1],[1,1,1]),e}getWorldRotation(){const e=[0,0,0,1];return ve.decompose(this.getWorldMatrix(),[0,0,0],e,[1,1,1]),e}getWorldScale(){const e=[1,1,1];return ve.decompose(this.getWorldMatrix(),[0,0,0],[0,0,0,1],e),e}getWorldMatrix(){const e=[];for(let s=this;s!=null;s=s.u)e.push(s);let r;const n=e.pop().getMatrix();for(;r=e.pop();)yf(n,n,r.getMatrix());return n}addChild(e){if(e.u&&e.u.removeChild(e),e.h.size)for(const n of e.h)n.removeChild(e);this.addRef("children",e),e.u=this;const r=this[fe].children;return r[r.length-1].addEventListener("dispose",()=>e.u=null),this}removeChild(e){return this.removeRef("children",e)}listChildren(){return this.listRefs("children")}getParent(){return this.u?this.u:this.listParents().find(e=>e.propertyType===q.SCENE)||null}getParentNode(){return this.u}getMesh(){return this.getRef("mesh")}setMesh(e){return this.setRef("mesh",e)}getCamera(){return this.getRef("camera")}setCamera(e){return this.setRef("camera",e)}getSkin(){return this.getRef("skin")}setSkin(e){return this.setRef("skin",e)}getWeights(){return this.get("weights")}setWeights(e){return this.set("weights",e)}traverse(e){e(this);for(const r of this.listChildren())r.traverse(e);return this}},Sr=class ta extends Le{init(){this.propertyType=q.PRIMITIVE}getDefaults(){return Object.assign(super.getDefaults(),{mode:ta.Mode.TRIANGLES,material:null,indices:null,attributes:{},targets:[]})}getIndices(){return this.getRef("indices")}setIndices(e){return this.setRef("indices",e,{usage:ze.ELEMENT_ARRAY_BUFFER})}getAttribute(e){return this.getRefMap("attributes",e)}setAttribute(e,r){return this.setRefMap("attributes",e,r,{usage:ze.ARRAY_BUFFER})}listAttributes(){return this.listRefMapValues("attributes")}listSemantics(){return this.listRefMapKeys("attributes")}getMaterial(){return this.getRef("material")}setMaterial(e){return this.setRef("material",e)}getMode(){return this.get("mode")}setMode(e){return this.set("mode",e)}listTargets(){return this.listRefs("targets")}addTarget(e){return this.addRef("targets",e)}removeTarget(e){return this.removeRef("targets",e)}};Sr.Mode={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6};let bf=class extends fs{init(){this.propertyType=q.PRIMITIVE_TARGET}getDefaults(){return Object.assign(super.getDefaults(),{attributes:{}})}getAttribute(e){return this.getRefMap("attributes",e)}setAttribute(e,r){return this.setRefMap("attributes",e,r,{usage:ze.ARRAY_BUFFER})}listAttributes(){return this.listRefMapValues("attributes")}listSemantics(){return this.listRefMapKeys("attributes")}};function Ue(){return Ue=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},Ue.apply(this,arguments)}let ra=class extends Le{init(){this.propertyType=q.SCENE}getDefaults(){return Object.assign(super.getDefaults(),{children:[]})}copy(e,r=gt){if(r===gt)throw new Error("Scene cannot be copied.");return super.copy(e,r)}addChild(e){e.u&&e.u.removeChild(e),this.addRef("children",e),e.h.add(this);const r=this[fe].children;return r[r.length-1].addEventListener("dispose",()=>e.h.delete(this)),this}removeChild(e){return this.removeRef("children",e)}listChildren(){return this.listRefs("children")}traverse(e){for(const r of this.listChildren())r.traverse(e);return this}},na=class extends Le{init(){this.propertyType=q.SKIN}getDefaults(){return Object.assign(super.getDefaults(),{skeleton:null,inverseBindMatrices:null,joints:[]})}getSkeleton(){return this.getRef("skeleton")}setSkeleton(e){return this.setRef("skeleton",e)}getInverseBindMatrices(){return this.getRef("inverseBindMatrices")}setInverseBindMatrices(e){return this.setRef("inverseBindMatrices",e,{usage:ze.INVERSE_BIND_MATRICES})}addJoint(e){return this.addRef("joints",e)}removeJoint(e){return this.removeRef("joints",e)}listJoints(){return this.listRefs("joints")}},sa=class extends Le{init(){this.propertyType=q.TEXTURE}getDefaults(){return Object.assign(super.getDefaults(),{image:null,mimeType:"",uri:""})}getMimeType(){return this.get("mimeType")||ot.extensionToMimeType(nr.extension(this.get("uri")))}setMimeType(e){return this.set("mimeType",e)}getURI(){return this.get("uri")}setURI(e){this.set("uri",e);const r=ot.extensionToMimeType(nr.extension(e));return r&&this.set("mimeType",r),this}getImage(){return this.get("image")}setImage(e){return this.set("image",Q.assertView(e))}getSize(){const e=this.get("image");return e?ot.getSize(e,this.getMimeType()):null}},ia=class extends Le{init(){this.propertyType=q.ROOT}getDefaults(){return Object.assign(super.getDefaults(),{asset:{generator:`glTF-Transform ${ki}`,version:"2.0"},defaultScene:null,accessors:[],animations:[],buffers:[],cameras:[],materials:[],meshes:[],nodes:[],scenes:[],skins:[],textures:[]})}constructor(e){super(e),this.l=new Set,e.addEventListener("node:create",r=>{this.g(r.target)})}clone(){throw new Error("Root cannot be cloned.")}copy(e,r=gt){if(r===gt)throw new Error("Root cannot be copied.");this.set("asset",Ue({},e.get("asset"))),this.setName(e.getName()),this.setExtras(Ue({},e.getExtras())),this.setDefaultScene(e.getDefaultScene()?r(e.getDefaultScene()):null);for(const n of e.listRefMapKeys("extensions")){const s=e.getExtension(n);this.setExtension(n,r(s))}return this}g(e){return e instanceof ra?this.addRef("scenes",e):e instanceof ea?this.addRef("nodes",e):e instanceof $r?this.addRef("cameras",e):e instanceof na?this.addRef("skins",e):e instanceof Qi?this.addRef("meshes",e):e instanceof sr?this.addRef("materials",e):e instanceof sa?this.addRef("textures",e):e instanceof Xi?this.addRef("animations",e):e instanceof X?this.addRef("accessors",e):e instanceof Ki&&this.addRef("buffers",e),this}getAsset(){return this.get("asset")}listExtensionsUsed(){return Array.from(this.l)}listExtensionsRequired(){return this.listExtensionsUsed().filter(e=>e.isRequired())}p(e){return this.l.add(e),this}m(e){return this.l.delete(e),this}listScenes(){return this.listRefs("scenes")}setDefaultScene(e){return this.setRef("defaultScene",e)}getDefaultScene(){return this.getRef("defaultScene")}listNodes(){return this.listRefs("nodes")}listCameras(){return this.listRefs("cameras")}listSkins(){return this.listRefs("skins")}listMeshes(){return this.listRefs("meshes")}listMaterials(){return this.listRefs("materials")}listTextures(){return this.listRefs("textures")}listAnimations(){return this.listRefs("animations")}listAccessors(){return this.listRefs("accessors")}listBuffers(){return this.listRefs("buffers")}},hs=class Zr{static fromGraph(e){return Zr.v.get(e)||null}constructor(){this.T=new hf,this.S=new ia(this.T),this.M=Lt.DEFAULT_INSTANCE,Zr.v.set(this.T,this)}getRoot(){return this.S}getGraph(){return this.T}getLogger(){return this.M}setLogger(e){return this.M=e,this}clone(){return new Zr().setLogger(this.M).merge(this)}merge(e){for(const i of e.getRoot().listExtensionsUsed()){const a=this.createExtension(i.constructor);i.isRequired()&&a.setRequired(!0)}const r=new Set,n=new Map;r.add(e.S),n.set(e.S,this.S);for(const i of e.T.listEdges())for(const a of[i.getParent(),i.getChild()]){if(r.has(a))continue;let o;o=a.propertyType===q.TEXTURE_INFO?a:new a.constructor(this.T),n.set(a,o),r.add(a)}const s=i=>{const a=n.get(i);if(!a)throw new Error("Could resolve property.");return a};for(const i of r){const a=n.get(i);if(!a)throw new Error("Could resolve property.");a.propertyType!==q.TEXTURE_INFO&&a.copy(i,s)}return this}async transform(...e){const r=e.map(n=>n.name);for(const n of e)await n(this,{stack:r});return this}createExtension(e){const r=e.EXTENSION_NAME;return this.getRoot().listExtensionsUsed().find(n=>n.extensionName===r)||new e(this)}createScene(e=""){return new ra(this.T,e)}createNode(e=""){return new ea(this.T,e)}createCamera(e=""){return new $r(this.T,e)}createSkin(e=""){return new na(this.T,e)}createMesh(e=""){return new Qi(this.T,e)}createPrimitive(){return new Sr(this.T)}createPrimitiveTarget(e=""){return new bf(this.T,e)}createMaterial(e=""){return new sr(this.T,e)}createTexture(e=""){return new sa(this.T,e)}createAnimation(e=""){return new Xi(this.T,e)}createAnimationChannel(e=""){return new us(this.T,e)}createAnimationSampler(e=""){return new mn(this.T,e)}createAccessor(e="",r=null){return r||(r=this.getRoot().listBuffers()[0]),new X(this.T,e).setBuffer(r)}createBuffer(e=""){return new Ki(this.T,e)}};hs.v=new WeakMap;let me=class{constructor(e){this.extensionName="",this.prereadTypes=[],this.prewriteTypes=[],this.readDependencies=[],this.writeDependencies=[],this.document=void 0,this.required=!1,this.properties=new Set,this.I=void 0,this.document=e,e.getRoot().p(this),this.I=n=>{const s=n,i=s.target;i instanceof we&&i.extensionName===this.extensionName&&(s.type==="node:create"&&this.N(i),s.type==="node:dispose"&&this.O(i))};const r=e.getGraph();r.addEventListener("node:create",this.I),r.addEventListener("node:dispose",this.I)}dispose(){this.document.getRoot().m(this);const e=this.document.getGraph();e.removeEventListener("node:create",this.I),e.removeEventListener("node:dispose",this.I);for(const r of this.properties)r.dispose()}static register(){}isRequired(){return this.required}setRequired(e){return this.required=e,this}listProperties(){return Array.from(this.properties)}N(e){return this.properties.add(e),this}O(e){return this.properties.delete(e),this}install(e,r){return this}preread(e,r){return this}prewrite(e,r){return this}};me.EXTENSION_NAME=void 0;let _f=class{constructor(e){this.jsonDoc=void 0,this.buffers=[],this.bufferViews=[],this.bufferViewBuffers=[],this.accessors=[],this.textures=[],this.textureInfos=new Map,this.materials=[],this.meshes=[],this.cameras=[],this.nodes=[],this.skins=[],this.animations=[],this.scenes=[],this.jsonDoc=e}setTextureInfo(e,r){this.textureInfos.set(e,r),r.texCoord!==void 0&&e.setTexCoord(r.texCoord),r.extras!==void 0&&e.setExtras(r.extras);const n=this.jsonDoc.json.textures[r.index];if(n.sampler===void 0)return;const s=this.jsonDoc.json.samplers[n.sampler];s.magFilter!==void 0&&e.setMagFilter(s.magFilter),s.minFilter!==void 0&&e.setMinFilter(s.minFilter),s.wrapS!==void 0&&e.setWrapS(s.wrapS),s.wrapT!==void 0&&e.setWrapT(s.wrapT)}};const mi={logger:Lt.DEFAULT_INSTANCE,extensions:[],dependencies:{}};let Sf=class{static read(e,r=mi){const n=Ue({},mi,r),{json:s}=e,i=new hs().setLogger(n.logger);this.validate(e,n);const a=new _f(e),o=s.asset,c=i.getRoot().getAsset();o.copyright&&(c.copyright=o.copyright),o.extras&&(c.extras=o.extras),s.extras!==void 0&&i.getRoot().setExtras(Ue({},s.extras));const f=s.extensionsUsed||[],h=s.extensionsRequired||[];for(const g of n.extensions)if(f.includes(g.EXTENSION_NAME)){const x=i.createExtension(g).setRequired(h.includes(g.EXTENSION_NAME));for(const T of x.readDependencies)x.install(T,n.dependencies[T])}const d=s.buffers||[];i.getRoot().listExtensionsUsed().filter(g=>g.prereadTypes.includes(q.BUFFER)).forEach(g=>g.preread(a,q.BUFFER)),a.buffers=d.map(g=>{const x=i.createBuffer(g.name);return g.extras&&x.setExtras(g.extras),g.uri&&g.uri.indexOf("__")!==0&&x.setURI(g.uri),x}),a.bufferViewBuffers=(s.bufferViews||[]).map((g,x)=>{if(!a.bufferViews[x]){const T=e.json.buffers[g.buffer];a.bufferViews[x]=Q.toView(T.uri?e.resources[T.uri]:e.resources[rr],g.byteOffset||0,g.byteLength)}return a.buffers[g.buffer]});const m=s.accessors||[];a.accessors=m.map(g=>{const x=i.createAccessor(g.name,a.bufferViewBuffers[g.bufferView]).setType(g.type);return g.extras&&x.setExtras(g.extras),g.normalized!==void 0&&x.setNormalized(g.normalized),g.bufferView===void 0||x.setArray(Kr(g,a)),x});const y=s.images||[],M=s.textures||[];i.getRoot().listExtensionsUsed().filter(g=>g.prereadTypes.includes(q.TEXTURE)).forEach(g=>g.preread(a,q.TEXTURE)),a.textures=y.map(g=>{const x=i.createTexture(g.name);if(g.extras&&x.setExtras(g.extras),g.bufferView!==void 0){const T=s.bufferViews[g.bufferView],I=e.json.buffers[T.buffer],b=T.byteOffset||0,F=(I.uri?e.resources[I.uri]:e.resources[rr]).slice(b,b+T.byteLength);x.setImage(F)}else g.uri!==void 0&&(x.setImage(e.resources[g.uri]),g.uri.indexOf("__")!==0&&x.setURI(g.uri));if(g.mimeType!==void 0)x.setMimeType(g.mimeType);else if(g.uri){const T=nr.extension(g.uri);x.setMimeType(ot.extensionToMimeType(T))}return x}),a.materials=(s.materials||[]).map(g=>{const x=i.createMaterial(g.name);g.extras&&x.setExtras(g.extras),g.alphaMode!==void 0&&x.setAlphaMode(g.alphaMode),g.alphaCutoff!==void 0&&x.setAlphaCutoff(g.alphaCutoff),g.doubleSided!==void 0&&x.setDoubleSided(g.doubleSided);const T=g.pbrMetallicRoughness||{};if(T.baseColorFactor!==void 0&&x.setBaseColorFactor(T.baseColorFactor),g.emissiveFactor!==void 0&&x.setEmissiveFactor(g.emissiveFactor),T.metallicFactor!==void 0&&x.setMetallicFactor(T.metallicFactor),T.roughnessFactor!==void 0&&x.setRoughnessFactor(T.roughnessFactor),T.baseColorTexture!==void 0){const I=T.baseColorTexture;x.setBaseColorTexture(a.textures[M[I.index].source]),a.setTextureInfo(x.getBaseColorTextureInfo(),I)}if(g.emissiveTexture!==void 0){const I=g.emissiveTexture;x.setEmissiveTexture(a.textures[M[I.index].source]),a.setTextureInfo(x.getEmissiveTextureInfo(),I)}if(g.normalTexture!==void 0){const I=g.normalTexture;x.setNormalTexture(a.textures[M[I.index].source]),a.setTextureInfo(x.getNormalTextureInfo(),I),g.normalTexture.scale!==void 0&&x.setNormalScale(g.normalTexture.scale)}if(g.occlusionTexture!==void 0){const I=g.occlusionTexture;x.setOcclusionTexture(a.textures[M[I.index].source]),a.setTextureInfo(x.getOcclusionTextureInfo(),I),g.occlusionTexture.strength!==void 0&&x.setOcclusionStrength(g.occlusionTexture.strength)}if(T.metallicRoughnessTexture!==void 0){const I=T.metallicRoughnessTexture;x.setMetallicRoughnessTexture(a.textures[M[I.index].source]),a.setTextureInfo(x.getMetallicRoughnessTextureInfo(),I)}return x});const R=s.meshes||[];i.getRoot().listExtensionsUsed().filter(g=>g.prereadTypes.includes(q.PRIMITIVE)).forEach(g=>g.preread(a,q.PRIMITIVE)),a.meshes=R.map(g=>{const x=i.createMesh(g.name);return g.extras&&x.setExtras(g.extras),g.weights!==void 0&&x.setWeights(g.weights),(g.primitives||[]).forEach(T=>{const I=i.createPrimitive();T.extras&&I.setExtras(T.extras),T.material!==void 0&&I.setMaterial(a.materials[T.material]),T.mode!==void 0&&I.setMode(T.mode);for(const[F,O]of Object.entries(T.attributes||{}))I.setAttribute(F,a.accessors[O]);T.indices!==void 0&&I.setIndices(a.accessors[T.indices]);const b=g.extras&&g.extras.targetNames||[];(T.targets||[]).forEach((F,O)=>{const C=b[O]||O.toString(),V=i.createPrimitiveTarget(C);for(const[L,j]of Object.entries(F))V.setAttribute(L,a.accessors[j]);I.addTarget(V)}),x.addPrimitive(I)}),x}),a.cameras=(s.cameras||[]).map(g=>{const x=i.createCamera(g.name).setType(g.type);if(g.extras&&x.setExtras(g.extras),g.type===$r.Type.PERSPECTIVE){const T=g.perspective;x.setYFov(T.yfov),x.setZNear(T.znear),T.zfar!==void 0&&x.setZFar(T.zfar),T.aspectRatio!==void 0&&x.setAspectRatio(T.aspectRatio)}else{const T=g.orthographic;x.setZNear(T.znear).setZFar(T.zfar).setXMag(T.xmag).setYMag(T.ymag)}return x});const p=s.nodes||[];i.getRoot().listExtensionsUsed().filter(g=>g.prereadTypes.includes(q.NODE)).forEach(g=>g.preread(a,q.NODE)),a.nodes=p.map(g=>{const x=i.createNode(g.name);if(g.extras&&x.setExtras(g.extras),g.translation!==void 0&&x.setTranslation(g.translation),g.rotation!==void 0&&x.setRotation(g.rotation),g.scale!==void 0&&x.setScale(g.scale),g.matrix!==void 0){const T=[0,0,0],I=[0,0,0,1],b=[1,1,1];ve.decompose(g.matrix,T,I,b),x.setTranslation(T),x.setRotation(I),x.setScale(b)}return g.weights!==void 0&&x.setWeights(g.weights),x}),a.skins=(s.skins||[]).map(g=>{const x=i.createSkin(g.name);g.extras&&x.setExtras(g.extras),g.inverseBindMatrices!==void 0&&x.setInverseBindMatrices(a.accessors[g.inverseBindMatrices]),g.skeleton!==void 0&&x.setSkeleton(a.nodes[g.skeleton]);for(const T of g.joints)x.addJoint(a.nodes[T]);return x}),p.map((g,x)=>{const T=a.nodes[x];(g.children||[]).forEach(I=>T.addChild(a.nodes[I])),g.mesh!==void 0&&T.setMesh(a.meshes[g.mesh]),g.camera!==void 0&&T.setCamera(a.cameras[g.camera]),g.skin!==void 0&&T.setSkin(a.skins[g.skin])}),a.animations=(s.animations||[]).map(g=>{const x=i.createAnimation(g.name);g.extras&&x.setExtras(g.extras);const T=(g.samplers||[]).map(I=>{const b=i.createAnimationSampler().setInput(a.accessors[I.input]).setOutput(a.accessors[I.output]).setInterpolation(I.interpolation||mn.Interpolation.LINEAR);return I.extras&&b.setExtras(I.extras),x.addSampler(b),b});return(g.channels||[]).forEach(I=>{const b=i.createAnimationChannel().setSampler(T[I.sampler]).setTargetPath(I.target.path);I.target.node!==void 0&&b.setTargetNode(a.nodes[I.target.node]),I.extras&&b.setExtras(I.extras),x.addChannel(b)}),x});const w=s.scenes||[];return i.getRoot().listExtensionsUsed().filter(g=>g.prereadTypes.includes(q.SCENE)).forEach(g=>g.preread(a,q.SCENE)),a.scenes=w.map(g=>{const x=i.createScene(g.name);return g.extras&&x.setExtras(g.extras),(g.nodes||[]).map(T=>a.nodes[T]).forEach(T=>x.addChild(T)),x}),s.scene!==void 0&&i.getRoot().setDefaultScene(a.scenes[s.scene]),i.getRoot().listExtensionsUsed().forEach(g=>g.read(a)),m.forEach((g,x)=>{const T=a.accessors[x],I=!!g.sparse,b=!g.bufferView&&!T.getArray();(I||b)&&T.setSparse(!0).setArray(function(F,O){const C=sn[F.componentType],V=X.getElementSize(F.type);let L;L=F.bufferView!==void 0?Kr(F,O):new C(F.count*V);const j=F.sparse;if(!j)return L;const G=j.count,P=Ue({},F,j.indices,{count:G,type:"SCALAR"}),Y=Ue({},F,j.values,{count:G}),te=Kr(P,O),K=Kr(Y,O);for(let ie=0;ie<P.count;ie++)for(let se=0;se<V;se++)L[te[ie]*V+se]=K[ie*V+se];return L}(g,a))}),i}static validate(e,r){const n=e.json;if(n.asset.version!=="2.0")throw new Error(`Unsupported glTF version, "${n.asset.version}".`);if(n.extensionsRequired){for(const s of n.extensionsRequired)if(!r.extensions.find(i=>i.EXTENSION_NAME===s))throw new Error(`Missing required extension, "${s}".`)}if(n.extensionsUsed)for(const s of n.extensionsUsed)r.extensions.find(i=>i.EXTENSION_NAME===s)||r.logger.warn(`Missing optional extension, "${s}".`)}};function Kr(t,e){const r=e.bufferViews[t.bufferView],n=e.jsonDoc.json.bufferViews[t.bufferView],s=sn[t.componentType],i=X.getElementSize(t.type),a=s.BYTES_PER_ELEMENT;if(n.byteStride!==void 0&&n.byteStride!==i*a)return function(c,f){const h=f.bufferViews[c.bufferView],d=f.jsonDoc.json.bufferViews[c.bufferView],m=sn[c.componentType],y=X.getElementSize(c.type),M=m.BYTES_PER_ELEMENT,R=c.byteOffset||0,p=new m(c.count*y),w=new DataView(h.buffer,h.byteOffset,h.byteLength),g=d.byteStride;for(let x=0;x<c.count;x++)for(let T=0;T<y;T++){const I=R+x*g+T*M;let b;switch(c.componentType){case X.ComponentType.FLOAT:b=w.getFloat32(I,!0);break;case X.ComponentType.UNSIGNED_INT:b=w.getUint32(I,!0);break;case X.ComponentType.UNSIGNED_SHORT:b=w.getUint16(I,!0);break;case X.ComponentType.UNSIGNED_BYTE:b=w.getUint8(I);break;case X.ComponentType.SHORT:b=w.getInt16(I,!0);break;case X.ComponentType.BYTE:b=w.getInt8(I);break;default:throw new Error(`Unexpected componentType "${c.componentType}".`)}p[x*y+T]=b}return p}(t,e);const o=r.byteOffset+(t.byteOffset||0);return new s(r.buffer.slice(o,o+t.count*i*a))}var Ir;(function(t){t[t.ARRAY_BUFFER=34962]="ARRAY_BUFFER",t[t.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER"})(Ir||(Ir={}));let Qe=class{constructor(e,r,n){this.C=void 0,this.jsonDoc=void 0,this.options=void 0,this.accessorIndexMap=new Map,this.animationIndexMap=new Map,this.bufferIndexMap=new Map,this.cameraIndexMap=new Map,this.skinIndexMap=new Map,this.materialIndexMap=new Map,this.meshIndexMap=new Map,this.nodeIndexMap=new Map,this.imageIndexMap=new Map,this.textureDefIndexMap=new Map,this.textureInfoDefMap=new Map,this.samplerDefIndexMap=new Map,this.sceneIndexMap=new Map,this.imageBufferViews=[],this.otherBufferViews=new Map,this.otherBufferViewsIndexMap=new Map,this.extensionData={},this.bufferURIGenerator=void 0,this.imageURIGenerator=void 0,this.logger=void 0,this.F=new Map,this.accessorUsageGroupedByParent=new Set(["ARRAY_BUFFER"]),this.accessorParents=new Map,this.C=e,this.jsonDoc=r,this.options=n;const s=e.getRoot(),i=s.listBuffers().length,a=s.listTextures().length;this.bufferURIGenerator=new vi(i>1,()=>n.basename||"buffer"),this.imageURIGenerator=new vi(a>1,o=>function(c,f){const h=c.getGraph().listParentEdges(f).find(d=>d.getParent()!==c.getRoot());return h?h.getName().replace(/texture$/i,""):""}(e,o)||n.basename||"texture"),this.logger=e.getLogger()}createTextureInfoDef(e,r){const n={magFilter:r.getMagFilter()||void 0,minFilter:r.getMinFilter()||void 0,wrapS:r.getWrapS(),wrapT:r.getWrapT()},s=JSON.stringify(n);this.samplerDefIndexMap.has(s)||(this.samplerDefIndexMap.set(s,this.jsonDoc.json.samplers.length),this.jsonDoc.json.samplers.push(n));const i={source:this.imageIndexMap.get(e),sampler:this.samplerDefIndexMap.get(s)},a=JSON.stringify(i);this.textureDefIndexMap.has(a)||(this.textureDefIndexMap.set(a,this.jsonDoc.json.textures.length),this.jsonDoc.json.textures.push(i));const o={index:this.textureDefIndexMap.get(a)};return r.getTexCoord()!==0&&(o.texCoord=r.getTexCoord()),Object.keys(r.getExtras()).length>0&&(o.extras=r.getExtras()),this.textureInfoDefMap.set(r,o),o}createPropertyDef(e){const r={};return e.getName()&&(r.name=e.getName()),Object.keys(e.getExtras()).length>0&&(r.extras=e.getExtras()),r}createAccessorDef(e){const r=this.createPropertyDef(e);return r.type=e.getType(),r.componentType=e.getComponentType(),r.count=e.getCount(),this.C.getGraph().listParentEdges(e).some(n=>n.getName()==="attributes"&&n.getAttributes().key==="POSITION"||n.getName()==="input")&&(r.max=e.getMax([]).map(Math.fround),r.min=e.getMin([]).map(Math.fround)),e.getNormalized()&&(r.normalized=e.getNormalized()),r}createImageData(e,r,n){if(this.options.format===Ut.GLB)this.imageBufferViews.push(r),e.bufferView=this.jsonDoc.json.bufferViews.length,this.jsonDoc.json.bufferViews.push({buffer:0,byteOffset:-1,byteLength:r.byteLength});else{const s=ot.mimeTypeToExtension(n.getMimeType());e.uri=this.imageURIGenerator.createURI(n,s),this.jsonDoc.resources[e.uri]=r}}getAccessorUsage(e){const r=this.F.get(e);if(r)return r;if(e.getSparse())return ze.SPARSE;for(const n of this.C.getGraph().listParentEdges(e)){const{usage:s}=n.getAttributes();if(s)return s;n.getParent().propertyType!==q.ROOT&&this.logger.warn(`Missing attribute ".usage" on edge, "${n.getName()}".`)}return ze.OTHER}addAccessorToUsageGroup(e,r){const n=this.F.get(e);if(n&&n!==r)throw new Error(`Accessor with usage "${n}" cannot be reused as "${r}".`);return this.F.set(e,r),this}listAccessorUsageGroups(){const e={};for(const[r,n]of Array.from(this.F.entries()))e[n]=e[n]||[],e[n].push(r);return e}};Qe.BufferViewTarget=Ir,Qe.BufferViewUsage=ze,Qe.USAGE_TO_TARGET={[ze.ARRAY_BUFFER]:Ir.ARRAY_BUFFER,[ze.ELEMENT_ARRAY_BUFFER]:Ir.ELEMENT_ARRAY_BUFFER};let vi=class{constructor(e,r){this.multiple=void 0,this.basename=void 0,this.counter={},this.multiple=e,this.basename=r}createURI(e,r){if(e.getURI())return e.getURI();if(this.multiple){const n=this.basename(e);return this.counter[n]=this.counter[n]||1,`${n}_${this.counter[n]++}.${r}`}return`${this.basename(e)}.${r}`}};const{BufferViewUsage:Jr}=Qe,{UNSIGNED_INT:Cf,UNSIGNED_SHORT:Nf,UNSIGNED_BYTE:Of}=X.ComponentType;let $f=class{static write(e,r){const n=e.getRoot(),s={asset:Ue({generator:`glTF-Transform ${ki}`},n.getAsset()),extras:Ue({},n.getExtras())},i={json:s,resources:{}},a=new Qe(e,i,r),o=r.logger||Lt.DEFAULT_INSTANCE,c=new Set(r.extensions.map(p=>p.EXTENSION_NAME)),f=e.getRoot().listExtensionsUsed().filter(p=>c.has(p.extensionName)),h=e.getRoot().listExtensionsRequired().filter(p=>c.has(p.extensionName));f.length<e.getRoot().listExtensionsUsed().length&&o.warn("Some extensions were not registered for I/O, and will not be written.");for(const p of f)for(const w of p.writeDependencies)p.install(w,r.dependencies[w]);function d(p,w,g,x){const T=[];let I=0;for(const F of p){const O=a.createAccessorDef(F);O.bufferView=s.bufferViews.length;const C=F.getArray(),V=Q.pad(Q.toView(C));O.byteOffset=I,I+=V.byteLength,T.push(V),a.accessorIndexMap.set(F,s.accessors.length),s.accessors.push(O)}const b={buffer:w,byteOffset:g,byteLength:Q.concat(T).byteLength};return x&&(b.target=x),s.bufferViews.push(b),{buffers:T,byteLength:I}}function m(p,w,g){const x=p[0].getCount();let T=0;for(const O of p){const C=a.createAccessorDef(O);C.bufferView=s.bufferViews.length,C.byteOffset=T;const V=O.getElementSize(),L=O.getComponentSize();T+=Q.padNumber(V*L),a.accessorIndexMap.set(O,s.accessors.length),s.accessors.push(C)}const I=x*T,b=new ArrayBuffer(I),F=new DataView(b);for(let O=0;O<x;O++){let C=0;for(const V of p){const L=V.getElementSize(),j=V.getComponentSize(),G=V.getComponentType(),P=V.getArray();for(let Y=0;Y<L;Y++){const te=O*T+C+Y*j,K=P[O*L+Y];switch(G){case X.ComponentType.FLOAT:F.setFloat32(te,K,!0);break;case X.ComponentType.BYTE:F.setInt8(te,K);break;case X.ComponentType.SHORT:F.setInt16(te,K,!0);break;case X.ComponentType.UNSIGNED_BYTE:F.setUint8(te,K);break;case X.ComponentType.UNSIGNED_SHORT:F.setUint16(te,K,!0);break;case X.ComponentType.UNSIGNED_INT:F.setUint32(te,K,!0);break;default:throw new Error("Unexpected component type: "+G)}}C+=Q.padNumber(L*j)}}return s.bufferViews.push({buffer:w,byteOffset:g,byteLength:I,byteStride:T,target:Qe.BufferViewTarget.ARRAY_BUFFER}),{byteLength:I,buffers:[new Uint8Array(b)]}}function y(p,w,g){const x=[];let T=0;const I=new Map;let b=-1/0;for(const G of p){const P=a.createAccessorDef(G);s.accessors.push(P),a.accessorIndexMap.set(G,s.accessors.length-1);const Y=[],te=[],K=[],ie=new Array(G.getElementSize()).fill(0);for(let he=0,Ae=G.getCount();he<Ae;he++)if(G.getElement(he,K),!ve.eq(K,ie,0)){b=Math.max(he,b),Y.push(he);for(let ge=0;ge<K.length;ge++)te.push(K[ge])}const se=Y.length,ae={accessorDef:P,count:se};if(I.set(G,ae),se===0)continue;if(se>G.getCount()/3){const he=(100*Y.length/G.getCount()).toFixed(1);o.warn(`Sparse accessor with many non-zero elements (${he}%) may increase file size.`)}const oe=sn[G.getComponentType()];ae.indices=Y,ae.values=new oe(te)}if(!Number.isFinite(b))return{buffers:x,byteLength:T};const F=b<255?Uint8Array:b<65535?Uint16Array:Uint32Array,O=b<255?Of:b<65535?Nf:Cf,C={buffer:w,byteOffset:g+T,byteLength:0};for(const G of p){const P=I.get(G);if(P.count===0)continue;P.indicesByteOffset=C.byteLength;const Y=Q.pad(Q.toView(new F(P.indices)));x.push(Y),T+=Y.byteLength,C.byteLength+=Y.byteLength}s.bufferViews.push(C);const V=s.bufferViews.length-1,L={buffer:w,byteOffset:g+T,byteLength:0};for(const G of p){const P=I.get(G);if(P.count===0)continue;P.valuesByteOffset=L.byteLength;const Y=Q.pad(Q.toView(P.values));x.push(Y),T+=Y.byteLength,L.byteLength+=Y.byteLength}s.bufferViews.push(L);const j=s.bufferViews.length-1;for(const G of p){const P=I.get(G);P.count!==0&&(P.accessorDef.sparse={count:P.count,indices:{bufferView:V,byteOffset:P.indicesByteOffset,componentType:O},values:{bufferView:j,byteOffset:P.valuesByteOffset}})}return{buffers:x,byteLength:T}}const M=new Map;for(const p of e.getGraph().listEdges()){if(p.getParent()===n)continue;const w=p.getChild();if(w instanceof X){const g=M.get(w)||[];g.push(p),M.set(w,g)}}if(s.accessors=[],s.bufferViews=[],s.samplers=[],s.textures=[],s.images=n.listTextures().map((p,w)=>{const g=a.createPropertyDef(p);p.getMimeType()&&(g.mimeType=p.getMimeType());const x=p.getImage();return x&&a.createImageData(g,x,p),a.imageIndexMap.set(p,w),g}),f.filter(p=>p.prewriteTypes.includes(q.ACCESSOR)).forEach(p=>p.prewrite(a,q.ACCESSOR)),n.listAccessors().forEach(p=>{const w=a.accessorUsageGroupedByParent,g=a.accessorParents;if(a.accessorIndexMap.has(p))return;const x=M.get(p)||[],T=a.getAccessorUsage(p);if(a.addAccessorToUsageGroup(p,T),w.has(T)){const I=x[0].getParent(),b=g.get(I)||new Set;b.add(p),g.set(I,b)}}),f.filter(p=>p.prewriteTypes.includes(q.BUFFER)).forEach(p=>p.prewrite(a,q.BUFFER)),(n.listAccessors().length>0||n.listTextures().length>0||a.otherBufferViews.size>0)&&n.listBuffers().length===0)throw new Error("Buffer required for Document resources, but none was found.");s.buffers=[],n.listBuffers().forEach((p,w)=>{const g=a.createPropertyDef(p),x=a.accessorUsageGroupedByParent,T=a.accessorParents,I=p.listParents().filter(L=>L instanceof X),b=new Set(I),F=[],O=s.buffers.length;let C=0;const V=a.listAccessorUsageGroups();for(const L in V)if(x.has(L))for(const j of Array.from(T.values())){const G=Array.from(j).filter(P=>b.has(P)).filter(P=>a.getAccessorUsage(P)===L);if(G.length)if(L!==Jr.ARRAY_BUFFER||r.vertexLayout===nn.INTERLEAVED){const P=L===Jr.ARRAY_BUFFER?m(G,O,C):d(G,O,C);C+=P.byteLength,F.push(...P.buffers)}else for(const P of G){const Y=m([P],O,C);C+=Y.byteLength,F.push(...Y.buffers)}}else{const j=V[L].filter(Y=>b.has(Y));if(!j.length)continue;const G=L===Jr.ELEMENT_ARRAY_BUFFER?Qe.BufferViewTarget.ELEMENT_ARRAY_BUFFER:void 0,P=L===Jr.SPARSE?y(j,O,C):d(j,O,C,G);C+=P.byteLength,F.push(...P.buffers)}if(a.imageBufferViews.length&&w===0){for(let L=0;L<a.imageBufferViews.length;L++)if(s.bufferViews[s.images[L].bufferView].byteOffset=C,C+=a.imageBufferViews[L].byteLength,F.push(a.imageBufferViews[L]),C%8){const j=8-C%8;C+=j,F.push(new Uint8Array(j))}}if(a.otherBufferViews.has(p))for(const L of a.otherBufferViews.get(p))s.bufferViews.push({buffer:O,byteOffset:C,byteLength:L.byteLength}),a.otherBufferViewsIndexMap.set(L,s.bufferViews.length-1),C+=L.byteLength,F.push(L);if(C){let L;r.format===Ut.GLB?L=rr:(L=a.bufferURIGenerator.createURI(p,"bin"),g.uri=L),g.byteLength=C,i.resources[L]=Q.concat(F)}s.buffers.push(g),a.bufferIndexMap.set(p,w)}),n.listAccessors().find(p=>!p.getBuffer())&&o.warn("Skipped writing one or more Accessors: no Buffer assigned."),s.materials=n.listMaterials().map((p,w)=>{const g=a.createPropertyDef(p);if(p.getAlphaMode()!==sr.AlphaMode.OPAQUE&&(g.alphaMode=p.getAlphaMode()),p.getAlphaMode()===sr.AlphaMode.MASK&&(g.alphaCutoff=p.getAlphaCutoff()),p.getDoubleSided()&&(g.doubleSided=!0),g.pbrMetallicRoughness={},ve.eq(p.getBaseColorFactor(),[1,1,1,1])||(g.pbrMetallicRoughness.baseColorFactor=p.getBaseColorFactor()),ve.eq(p.getEmissiveFactor(),[0,0,0])||(g.emissiveFactor=p.getEmissiveFactor()),p.getRoughnessFactor()!==1&&(g.pbrMetallicRoughness.roughnessFactor=p.getRoughnessFactor()),p.getMetallicFactor()!==1&&(g.pbrMetallicRoughness.metallicFactor=p.getMetallicFactor()),p.getBaseColorTexture()){const x=p.getBaseColorTexture(),T=p.getBaseColorTextureInfo();g.pbrMetallicRoughness.baseColorTexture=a.createTextureInfoDef(x,T)}if(p.getEmissiveTexture()){const x=p.getEmissiveTexture(),T=p.getEmissiveTextureInfo();g.emissiveTexture=a.createTextureInfoDef(x,T)}if(p.getNormalTexture()){const x=p.getNormalTexture(),T=p.getNormalTextureInfo(),I=a.createTextureInfoDef(x,T);p.getNormalScale()!==1&&(I.scale=p.getNormalScale()),g.normalTexture=I}if(p.getOcclusionTexture()){const x=p.getOcclusionTexture(),T=p.getOcclusionTextureInfo(),I=a.createTextureInfoDef(x,T);p.getOcclusionStrength()!==1&&(I.strength=p.getOcclusionStrength()),g.occlusionTexture=I}if(p.getMetallicRoughnessTexture()){const x=p.getMetallicRoughnessTexture(),T=p.getMetallicRoughnessTextureInfo();g.pbrMetallicRoughness.metallicRoughnessTexture=a.createTextureInfoDef(x,T)}return a.materialIndexMap.set(p,w),g}),s.meshes=n.listMeshes().map((p,w)=>{const g=a.createPropertyDef(p);let x=null;return g.primitives=p.listPrimitives().map(T=>{const I={attributes:{}};I.mode=T.getMode();const b=T.getMaterial();b&&(I.material=a.materialIndexMap.get(b)),Object.keys(T.getExtras()).length&&(I.extras=T.getExtras());const F=T.getIndices();F&&(I.indices=a.accessorIndexMap.get(F));for(const O of T.listSemantics())I.attributes[O]=a.accessorIndexMap.get(T.getAttribute(O));for(const O of T.listTargets()){const C={};for(const V of O.listSemantics())C[V]=a.accessorIndexMap.get(O.getAttribute(V));I.targets=I.targets||[],I.targets.push(C)}return T.listTargets().length&&!x&&(x=T.listTargets().map(O=>O.getName())),I}),p.getWeights().length&&(g.weights=p.getWeights()),x&&(g.extras=g.extras||{},g.extras.targetNames=x),a.meshIndexMap.set(p,w),g}),s.cameras=n.listCameras().map((p,w)=>{const g=a.createPropertyDef(p);if(g.type=p.getType(),g.type===$r.Type.PERSPECTIVE){g.perspective={znear:p.getZNear(),zfar:p.getZFar(),yfov:p.getYFov()};const x=p.getAspectRatio();x!==null&&(g.perspective.aspectRatio=x)}else g.orthographic={znear:p.getZNear(),zfar:p.getZFar(),xmag:p.getXMag(),ymag:p.getYMag()};return a.cameraIndexMap.set(p,w),g}),s.nodes=n.listNodes().map((p,w)=>{const g=a.createPropertyDef(p);return ve.eq(p.getTranslation(),[0,0,0])||(g.translation=p.getTranslation()),ve.eq(p.getRotation(),[0,0,0,1])||(g.rotation=p.getRotation()),ve.eq(p.getScale(),[1,1,1])||(g.scale=p.getScale()),p.getWeights().length&&(g.weights=p.getWeights()),a.nodeIndexMap.set(p,w),g}),s.skins=n.listSkins().map((p,w)=>{const g=a.createPropertyDef(p),x=p.getInverseBindMatrices();x&&(g.inverseBindMatrices=a.accessorIndexMap.get(x));const T=p.getSkeleton();return T&&(g.skeleton=a.nodeIndexMap.get(T)),g.joints=p.listJoints().map(I=>a.nodeIndexMap.get(I)),a.skinIndexMap.set(p,w),g}),n.listNodes().forEach((p,w)=>{const g=s.nodes[w],x=p.getMesh();x&&(g.mesh=a.meshIndexMap.get(x));const T=p.getCamera();T&&(g.camera=a.cameraIndexMap.get(T));const I=p.getSkin();I&&(g.skin=a.skinIndexMap.get(I)),p.listChildren().length>0&&(g.children=p.listChildren().map(b=>a.nodeIndexMap.get(b)))}),s.animations=n.listAnimations().map((p,w)=>{const g=a.createPropertyDef(p),x=new Map;return g.samplers=p.listSamplers().map((T,I)=>{const b=a.createPropertyDef(T);return b.input=a.accessorIndexMap.get(T.getInput()),b.output=a.accessorIndexMap.get(T.getOutput()),b.interpolation=T.getInterpolation(),x.set(T,I),b}),g.channels=p.listChannels().map(T=>{const I=a.createPropertyDef(T);return I.sampler=x.get(T.getSampler()),I.target={node:a.nodeIndexMap.get(T.getTargetNode()),path:T.getTargetPath()},I}),a.animationIndexMap.set(p,w),g}),s.scenes=n.listScenes().map((p,w)=>{const g=a.createPropertyDef(p);return g.nodes=p.listChildren().map(x=>a.nodeIndexMap.get(x)),a.sceneIndexMap.set(p,w),g});const R=n.getDefaultScene();return R&&(s.scene=n.listScenes().indexOf(R)),s.extensionsUsed=f.map(p=>p.extensionName),s.extensionsRequired=h.map(p=>p.extensionName),f.forEach(p=>p.write(a)),function(p){const w=[];for(const g in p){const x=p[g];(Array.isArray(x)&&x.length===0||x===null||x===""||x&&typeof x=="object"&&Object.keys(x).length===0)&&w.push(g)}for(const g of w)delete p[g]}(s),i}};var on;(function(t){t[t.JSON=1313821514]="JSON",t[t.BIN=5130562]="BIN"})(on||(on={}));let Ff=class{constructor(){this.M=Lt.DEFAULT_INSTANCE,this.l=new Set,this.U={},this.P=nn.INTERLEAVED,this.lastReadBytes=0,this.lastWriteBytes=0}setLogger(e){return this.M=e,this}registerExtensions(e){for(const r of e)this.l.add(r),r.register();return this}registerDependencies(e){return Object.assign(this.U,e),this}setVertexLayout(e){return this.P=e,this}async read(e){return await this.readJSON(await this.readAsJSON(e))}async readAsJSON(e){const r=await this.readURI(e,"view");this.lastReadBytes=r.byteLength;const n=xi(r)?this.L(r):{json:JSON.parse(Q.decodeText(r)),resources:{}};return await this.j(n,this.dirname(e)),this.D(n),n}async readJSON(e){return e=this._(e),this.D(e),Sf.read(e,{extensions:Array.from(this.l),dependencies:this.U,logger:this.M})}async binaryToJSON(e){const r=this.L(Q.assertView(e));this.D(r);const n=r.json;if(n.buffers&&n.buffers.some(s=>function(i,a){return a.uri!==void 0&&!(a.uri in i.resources)}(r,s)))throw new Error("Cannot resolve external buffers with binaryToJSON().");if(n.images&&n.images.some(s=>function(i,a){return a.uri!==void 0&&!(a.uri in i.resources)&&a.bufferView===void 0}(r,s)))throw new Error("Cannot resolve external images with binaryToJSON().");return r}async readBinary(e){return this.readJSON(await this.binaryToJSON(Q.assertView(e)))}async writeJSON(e,r={}){if(r.format===Ut.GLB&&e.getRoot().listBuffers().length>1)throw new Error("GLB must have 0–1 buffers.");return $f.write(e,{format:r.format||Ut.GLTF,basename:r.basename||"",logger:this.M,vertexLayout:this.P,dependencies:Ue({},this.U),extensions:Array.from(this.l)})}async writeBinary(e){const{json:r,resources:n}=await this.writeJSON(e,{format:Ut.GLB}),s=new Uint32Array([1179937895,2,12]),i=JSON.stringify(r),a=Q.pad(Q.encodeText(i),32),o=Q.toView(new Uint32Array([a.byteLength,1313821514])),c=Q.concat([o,a]);s[s.length-1]+=c.byteLength;const f=Object.values(n)[0];if(!f||!f.byteLength)return Q.concat([Q.toView(s),c]);const h=Q.pad(f,0),d=Q.toView(new Uint32Array([h.byteLength,5130562])),m=Q.concat([d,h]);return s[s.length-1]+=m.byteLength,Q.concat([Q.toView(s),c,m])}async j(e,r){var n=this;const s=[...e.json.images||[],...e.json.buffers||[]].map(async function(i){const a=i.uri;if(!a||a.match(/data:/))return Promise.resolve();e.resources[a]=await n.readURI(n.resolve(r,a),"view"),n.lastReadBytes+=e.resources[a].byteLength});await Promise.all(s)}D(e){function r(n){if(n.uri){if(n.uri in e.resources)Q.assertView(e.resources[n.uri]);else if(n.uri.match(/data:/)){const s=`__${wf()}.${nr.extension(n.uri)}`;e.resources[s]=Q.createBufferFromDataURI(n.uri),n.uri=s}}}(e.json.images||[]).forEach(n=>{if(n.bufferView===void 0&&n.uri===void 0)throw new Error("Missing resource URI or buffer view.");r(n)}),(e.json.buffers||[]).forEach(r)}_(e){const{images:r,buffers:n}=e.json;return e={json:Ue({},e.json),resources:Ue({},e.resources)},r&&(e.json.images=r.map(s=>Ue({},s))),n&&(e.json.buffers=n.map(s=>Ue({},s))),e}L(e){if(!xi(e))throw new Error("Invalid glTF 2.0 binary.");const r=new Uint32Array(e.buffer,e.byteOffset+12,2);if(r[1]!==on.JSON)throw new Error("Missing required GLB JSON chunk.");const n=r[0],s=Q.decodeText(Q.toView(e,20,n)),i=JSON.parse(s),a=20+n;if(e.byteLength<=a)return{json:i,resources:{}};const o=new Uint32Array(e.buffer,e.byteOffset+a,2);if(o[1]!==on.BIN)throw new Error("Expected GLB BIN in second chunk.");const c=Q.toView(e,a+8,o[0]);return{json:i,resources:{[rr]:c}}}};function xi(t){if(t.byteLength<3*Uint32Array.BYTES_PER_ELEMENT)return!1;const e=new Uint32Array(t.buffer,t.byteOffset,3);return e[0]===1179937895&&e[1]===2}let Df=class extends Ff{constructor(e=wr.DEFAULT_INIT){super(),this.J=void 0,this.J=e}async readURI(e,r){const n=await fetch(e,this.J);switch(r){case"view":return new Uint8Array(await n.arrayBuffer());case"text":return n.text()}}resolve(e,r){return wr.resolve(e,r)}dirname(e){return wr.dirname(e)}};const Pf=0,Uf=0,Lf=0,Bf=2,Vf=0,jf=163,zf=166,kf=0,Gf=2,qf=1,Hf=64,Wf=0;class Xf{constructor(){this.vkFormat=Wf,this.typeSize=1,this.pixelWidth=0,this.pixelHeight=0,this.pixelDepth=0,this.layerCount=0,this.faceCount=1,this.supercompressionScheme=Pf,this.levels=[],this.dataFormatDescriptor=[{vendorId:Lf,descriptorType:Uf,descriptorBlockSize:0,versionNumber:Bf,colorModel:Vf,colorPrimaries:qf,transferFunction:Gf,flags:kf,texelBlockDimension:[0,0,0,0],bytesPlane:[0,0,0,0,0,0,0,0],samples:[]}],this.keyValue={},this.globalData=null}}class pr{constructor(e,r,n,s){this._dataView=void 0,this._littleEndian=void 0,this._offset=void 0,this._dataView=new DataView(e.buffer,e.byteOffset+r,n),this._littleEndian=s,this._offset=0}_nextUint8(){const e=this._dataView.getUint8(this._offset);return this._offset+=1,e}_nextUint16(){const e=this._dataView.getUint16(this._offset,this._littleEndian);return this._offset+=2,e}_nextUint32(){const e=this._dataView.getUint32(this._offset,this._littleEndian);return this._offset+=4,e}_nextUint64(){const e=this._dataView.getUint32(this._offset,this._littleEndian),r=this._dataView.getUint32(this._offset+4,this._littleEndian),n=e+2**32*r;return this._offset+=8,n}_nextInt32(){const e=this._dataView.getInt32(this._offset,this._littleEndian);return this._offset+=4,e}_nextUint8Array(e){const r=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._offset,e);return this._offset+=e,r}_skip(e){return this._offset+=e,this}_scan(e,r=0){const n=this._offset;let s=0;for(;this._dataView.getUint8(this._offset)!==r&&s<e;)s++,this._offset++;return s<e&&this._offset++,new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+n,s)}}const De=[171,75,84,88,32,50,48,187,13,10,26,10];function yi(t){return typeof TextDecoder<"u"?new TextDecoder().decode(t):Buffer.from(t).toString("utf8")}function Bn(t){const e=new Uint8Array(t.buffer,t.byteOffset,De.length);if(e[0]!==De[0]||e[1]!==De[1]||e[2]!==De[2]||e[3]!==De[3]||e[4]!==De[4]||e[5]!==De[5]||e[6]!==De[6]||e[7]!==De[7]||e[8]!==De[8]||e[9]!==De[9]||e[10]!==De[10]||e[11]!==De[11])throw new Error("Missing KTX 2.0 identifier.");const r=new Xf,n=17*Uint32Array.BYTES_PER_ELEMENT,s=new pr(t,De.length,n,!0);r.vkFormat=s._nextUint32(),r.typeSize=s._nextUint32(),r.pixelWidth=s._nextUint32(),r.pixelHeight=s._nextUint32(),r.pixelDepth=s._nextUint32(),r.layerCount=s._nextUint32(),r.faceCount=s._nextUint32();const i=s._nextUint32();r.supercompressionScheme=s._nextUint32();const a=s._nextUint32(),o=s._nextUint32(),c=s._nextUint32(),f=s._nextUint32(),h=s._nextUint64(),d=s._nextUint64(),m=i*3*8,y=new pr(t,De.length+n,m,!0);for(let ae=0;ae<i;ae++)r.levels.push({levelData:new Uint8Array(t.buffer,t.byteOffset+y._nextUint64(),y._nextUint64()),uncompressedByteLength:y._nextUint64()});const M=new pr(t,a,o,!0),R={vendorId:M._skip(4)._nextUint16(),descriptorType:M._nextUint16(),versionNumber:M._nextUint16(),descriptorBlockSize:M._nextUint16(),colorModel:M._nextUint8(),colorPrimaries:M._nextUint8(),transferFunction:M._nextUint8(),flags:M._nextUint8(),texelBlockDimension:[M._nextUint8(),M._nextUint8(),M._nextUint8(),M._nextUint8()],bytesPlane:[M._nextUint8(),M._nextUint8(),M._nextUint8(),M._nextUint8(),M._nextUint8(),M._nextUint8(),M._nextUint8(),M._nextUint8()],samples:[]},p=6,w=4,g=(R.descriptorBlockSize/4-p)/w;for(let ae=0;ae<g;ae++){const oe={bitOffset:M._nextUint16(),bitLength:M._nextUint8(),channelType:M._nextUint8(),samplePosition:[M._nextUint8(),M._nextUint8(),M._nextUint8(),M._nextUint8()],sampleLower:-1/0,sampleUpper:1/0};oe.channelType&Hf?(oe.sampleLower=M._nextInt32(),oe.sampleUpper=M._nextInt32()):(oe.sampleLower=M._nextUint32(),oe.sampleUpper=M._nextUint32()),R.samples[ae]=oe}r.dataFormatDescriptor.length=0,r.dataFormatDescriptor.push(R);const x=new pr(t,c,f,!0);for(;x._offset<f;){const ae=x._nextUint32(),oe=x._scan(ae),he=yi(oe);if(r.keyValue[he]=x._nextUint8Array(ae-oe.byteLength-1),he.match(/^ktx/i)){const ge=yi(r.keyValue[he]);r.keyValue[he]=ge.substring(0,ge.lastIndexOf("\0"))}const Ae=ae%4?4-ae%4:0;x._skip(Ae)}if(d<=0)return r;const T=new pr(t,h,d,!0),I=T._nextUint16(),b=T._nextUint16(),F=T._nextUint32(),O=T._nextUint32(),C=T._nextUint32(),V=T._nextUint32(),L=[];for(let ae=0;ae<i;ae++)L.push({imageFlags:T._nextUint32(),rgbSliceByteOffset:T._nextUint32(),rgbSliceByteLength:T._nextUint32(),alphaSliceByteOffset:T._nextUint32(),alphaSliceByteLength:T._nextUint32()});const j=h+T._offset,G=j+F,P=G+O,Y=P+C,te=new Uint8Array(t.buffer,t.byteOffset+j,F),K=new Uint8Array(t.buffer,t.byteOffset+G,O),ie=new Uint8Array(t.buffer,t.byteOffset+P,C),se=new Uint8Array(t.buffer,t.byteOffset+Y,V);return r.globalData={endpointCount:I,selectorCount:b,imageDescs:L,endpointsData:te,selectorsData:K,tablesData:ie,extendedData:se},r}const ps="EXT_mesh_gpu_instancing",Jn="EXT_meshopt_compression",aa="KHR_draco_mesh_compression",gs="KHR_lights_punctual",ds="KHR_materials_anisotropy",ms="KHR_materials_clearcoat",vs="KHR_materials_emissive_strength",xs="KHR_materials_ior",ys="KHR_materials_iridescence",Ts="KHR_materials_pbrSpecularGlossiness",Ms="KHR_materials_sheen",Es="KHR_materials_specular",Rs="KHR_materials_transmission",ws="KHR_materials_unlit",Is="KHR_materials_volume",zt="KHR_materials_variants",As="KHR_texture_transform",cn="KHR_xmp_json_ld",Zn="INSTANCE_ATTRIBUTE";class oa extends we{init(){this.extensionName=ps,this.propertyType="InstancedMesh",this.parentTypes=[q.NODE]}getDefaults(){return Object.assign(super.getDefaults(),{attributes:{}})}getAttribute(e){return this.getRefMap("attributes",e)}setAttribute(e,r){return this.setRefMap("attributes",e,r,{usage:Zn})}listAttributes(){return this.listRefMapValues("attributes")}listSemantics(){return this.listRefMapKeys("attributes")}}oa.EXTENSION_NAME=ps;const Et=ps;class ca extends me{constructor(...e){super(...e),this.extensionName=Et,this.provideTypes=[q.NODE],this.prewriteTypes=[q.ACCESSOR]}createInstancedMesh(){return new oa(this.document.getGraph())}read(e){return(e.jsonDoc.json.nodes||[]).forEach((r,n)=>{if(!r.extensions||!r.extensions[Et])return;const s=r.extensions[Et],i=this.createInstancedMesh();for(const a in s.attributes)i.setAttribute(a,e.accessors[s.attributes[a]]);e.nodes[n].setExtension(Et,i)}),this}prewrite(e){e.accessorUsageGroupedByParent.add(Zn);for(const r of this.properties)for(const n of r.listAttributes())e.addAccessorToUsageGroup(n,Zn);return this}write(e){const r=e.jsonDoc;return this.document.getRoot().listNodes().forEach(n=>{const s=n.getExtension(Et);if(s){const i=e.nodeIndexMap.get(n),a=r.json.nodes[i],o={attributes:{}};s.listSemantics().forEach(c=>{const f=s.getAttribute(c);o.attributes[c]=e.accessorIndexMap.get(f)}),a.extensions=a.extensions||{},a.extensions[Et]=o}}),this}}function pt(){return pt=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},pt.apply(this,arguments)}var Cr,Qt,Re;ca.EXTENSION_NAME=Et,function(t){t.QUANTIZE="quantize",t.FILTER="filter"}(Cr||(Cr={})),function(t){t.ATTRIBUTES="ATTRIBUTES",t.TRIANGLES="TRIANGLES",t.INDICES="INDICES"}(Qt||(Qt={})),function(t){t.NONE="NONE",t.OCTAHEDRAL="OCTAHEDRAL",t.QUATERNION="QUATERNION",t.EXPONENTIAL="EXPONENTIAL"}(Re||(Re={}));const{BYTE:Yf,SHORT:Ti,FLOAT:Kf}=X.ComponentType,{encodeNormalizedInt:Mi,decodeNormalizedInt:Vn}=ve;function Jf(t,e,r,n){const{filter:s,bits:i}=n,a={array:t.getArray(),byteStride:t.getElementSize()*t.getComponentSize(),componentType:t.getComponentType(),normalized:t.getNormalized()};if(r!==Qt.ATTRIBUTES)return a;if(s!==Re.NONE){let o=t.getNormalized()?function(c){const f=c.getComponentType(),h=c.getArray(),d=new Float32Array(h.length);for(let m=0;m<h.length;m++)d[m]=Vn(h[m],f);return d}(t):new Float32Array(a.array);switch(s){case Re.EXPONENTIAL:a.byteStride=4*t.getElementSize(),a.componentType=Kf,a.normalized=!1,a.array=e.encodeFilterExp(o,t.getCount(),a.byteStride,i);break;case Re.OCTAHEDRAL:a.byteStride=i>8?8:4,a.componentType=i>8?Ti:Yf,a.normalized=!0,o=t.getElementSize()===3?function(c){const f=new Float32Array(4*c.length/3);for(let h=0,d=c.length/3;h<d;h++)f[4*h]=c[3*h],f[4*h+1]=c[3*h+1],f[4*h+2]=c[3*h+2];return f}(o):o,a.array=e.encodeFilterOct(o,t.getCount(),a.byteStride,i);break;case Re.QUATERNION:a.byteStride=8,a.componentType=Ti,a.normalized=!0,a.array=e.encodeFilterQuat(o,t.getCount(),a.byteStride,i);break;default:throw new Error("Invalid filter.")}a.min=t.getMin([]),a.max=t.getMax([]),t.getNormalized()&&(a.min=a.min.map(c=>Vn(c,t.getComponentType())),a.max=a.max.map(c=>Vn(c,t.getComponentType()))),a.normalized&&(a.min=a.min.map(c=>Mi(c,a.componentType)),a.max=a.max.map(c=>Mi(c,a.componentType)))}else a.byteStride%4&&(a.array=function(o,c){const f=Q.padNumber(o.BYTES_PER_ELEMENT*c)/o.BYTES_PER_ELEMENT,h=new o.constructor(o.length/c*f);for(let d=0;d*c<o.length;d++)for(let m=0;m<c;m++)h[d*f+m]=o[d*c+m];return h}(a.array,t.getElementSize()),a.byteStride=a.array.byteLength/t.getCount());return a}function Zf(t,e){return e===Qe.BufferViewUsage.ELEMENT_ARRAY_BUFFER?t.listParents().some(r=>r instanceof Sr&&r.getMode()===Sr.Mode.TRIANGLES)?Qt.TRIANGLES:Qt.INDICES:Qt.ATTRIBUTES}function Qf(t,e){const r=e.getGraph().listParentEdges(t).filter(n=>!(n.getParent()instanceof ia));for(const n of r){const s=n.getName(),i=n.getAttributes().key||"",a=n.getParent().propertyType===q.PRIMITIVE_TARGET;if(s==="indices")return{filter:Re.NONE};if(s==="attributes"){if(i==="POSITION")return{filter:Re.NONE};if(i==="TEXCOORD_0")return{filter:Re.NONE};if(i.startsWith("JOINTS_"))return{filter:Re.NONE};if(i.startsWith("WEIGHTS_"))return{filter:Re.NONE};if(i==="NORMAL"||i==="TANGENT")return a?{filter:Re.NONE}:{filter:Re.OCTAHEDRAL,bits:8}}if(s==="output"){const o=la(t);return o==="rotation"?{filter:Re.QUATERNION,bits:16}:o==="translation"||o==="scale"?{filter:Re.EXPONENTIAL,bits:12}:{filter:Re.NONE}}if(s==="input")return{filter:Re.NONE};if(s==="inverseBindMatrices")return{filter:Re.NONE}}return{filter:Re.NONE}}function la(t){for(const e of t.listParents())if(e instanceof mn){for(const r of e.listParents())if(r instanceof us)return r.getTargetPath()}return null}const Pe=Jn,Ei={method:Cr.QUANTIZE};class Qn extends me{constructor(...e){super(...e),this.extensionName=Pe,this.prereadTypes=[q.BUFFER,q.PRIMITIVE],this.prewriteTypes=[q.BUFFER,q.ACCESSOR],this.readDependencies=["meshopt.decoder"],this.writeDependencies=["meshopt.encoder"],this._decoder=null,this._decoderFallbackBufferMap=new Map,this._encoder=null,this._encoderOptions=Ei,this._encoderFallbackBuffer=null,this._encoderBufferViews={},this._encoderBufferViewData={},this._encoderBufferViewAccessors={}}install(e,r){return e==="meshopt.decoder"&&(this._decoder=r),e==="meshopt.encoder"&&(this._encoder=r),this}setEncoderOptions(e){return this._encoderOptions=pt({},Ei,e),this}preread(e,r){if(!this._decoder){if(!this.isRequired())return this;throw new Error(`[${Pe}] Please install extension dependency, "meshopt.decoder".`)}if(!this._decoder.supported){if(!this.isRequired())return this;throw new Error(`[${Pe}]: Missing WASM support.`)}return r===q.BUFFER?this._prereadBuffers(e):r===q.PRIMITIVE&&this._prereadPrimitives(e),this}_prereadBuffers(e){const r=e.jsonDoc;(r.json.bufferViews||[]).forEach((n,s)=>{if(!n.extensions||!n.extensions[Pe])return;const i=n.extensions[Pe],a=i.byteOffset||0,o=i.byteLength||0,c=i.count,f=i.byteStride,h=new Uint8Array(c*f),d=r.json.buffers[i.buffer],m=Q.toView(d.uri?r.resources[d.uri]:r.resources[rr],a,o);this._decoder.decodeGltfBuffer(h,c,f,m,i.mode,i.filter),e.bufferViews[s]=h})}_prereadPrimitives(e){const r=e.jsonDoc;(r.json.bufferViews||[]).forEach(n=>{var s;n.extensions&&n.extensions[Pe]&&(s=r.json.buffers[n.buffer]).extensions&&s.extensions[Jn]&&s.extensions[Jn].fallback&&this._decoderFallbackBufferMap.set(e.buffers[n.buffer],e.buffers[n.extensions[Pe].buffer])})}read(e){if(!this.isRequired())return this;for(const[r,n]of this._decoderFallbackBufferMap){for(const s of r.listParents())s instanceof X&&s.swap(r,n);r.dispose()}return this}prewrite(e,r){return r===q.ACCESSOR?this._prewriteAccessors(e):r===q.BUFFER&&this._prewriteBuffers(e),this}_prewriteAccessors(e){const r=e.jsonDoc.json,n=this._encoder,s=this._encoderOptions,i=this.document.createBuffer(),a=this.document.getRoot().listBuffers().indexOf(i);this._encoderFallbackBuffer=i,this._encoderBufferViews={},this._encoderBufferViewData={},this._encoderBufferViewAccessors={};for(const o of this.document.getRoot().listAccessors()){if(la(o)==="weights"||o.getSparse())continue;const c=e.getAccessorUsage(o),f=Zf(o,c),h=s.method===Cr.FILTER?Qf(o,this.document):{filter:Re.NONE},d=Jf(o,n,f,h),{array:m,byteStride:y}=d,M=o.getBuffer();if(!M)throw new Error(`${Pe}: Missing buffer for accessor.`);const R=this.document.getRoot().listBuffers().indexOf(M),p=[c,f,h.filter,y,R].join(":");let w=this._encoderBufferViews[p],g=this._encoderBufferViewData[p],x=this._encoderBufferViewAccessors[p];w&&g||(x=this._encoderBufferViewAccessors[p]=[],g=this._encoderBufferViewData[p]=[],w=this._encoderBufferViews[p]={buffer:a,target:Qe.USAGE_TO_TARGET[c],byteOffset:0,byteLength:0,byteStride:c===Qe.BufferViewUsage.ARRAY_BUFFER?y:void 0,extensions:{[Pe]:{buffer:R,byteOffset:0,byteLength:0,mode:f,filter:h.filter!==Re.NONE?h.filter:void 0,byteStride:y,count:0}}});const T=e.createAccessorDef(o);T.componentType=d.componentType,T.normalized=d.normalized,T.byteOffset=w.byteLength,T.min&&d.min&&(T.min=d.min),T.max&&d.max&&(T.max=d.max),e.accessorIndexMap.set(o,r.accessors.length),r.accessors.push(T),x.push(T),g.push(new Uint8Array(m.buffer,m.byteOffset,m.byteLength)),w.byteLength+=m.byteLength,w.extensions.EXT_meshopt_compression.count+=o.getCount()}}_prewriteBuffers(e){const r=this._encoder;for(const n in this._encoderBufferViews){const s=this._encoderBufferViews[n],i=this._encoderBufferViewData[n],a=this.document.getRoot().listBuffers()[s.extensions[Pe].buffer],o=e.otherBufferViews.get(a)||[],{count:c,byteStride:f,mode:h}=s.extensions[Pe],d=Q.concat(i),m=r.encodeGltfBuffer(d,c,f,h),y=Q.pad(m);s.extensions[Pe].byteLength=m.byteLength,i.length=0,i.push(y),o.push(y),e.otherBufferViews.set(a,o)}}write(e){let r=0;for(const a in this._encoderBufferViews){const o=this._encoderBufferViews[a],c=e.otherBufferViewsIndexMap.get(this._encoderBufferViewData[a][0]),f=this._encoderBufferViewAccessors[a];for(const m of f)m.bufferView=c;const h=e.jsonDoc.json.bufferViews[c],d=h.byteOffset||0;Object.assign(h,o),h.byteOffset=r,h.extensions[Pe].byteOffset=d,r+=Q.padNumber(o.byteLength)}const n=this._encoderFallbackBuffer,s=e.bufferIndexMap.get(n),i=e.jsonDoc.json.buffers[s];return i.byteLength=r,i.extensions={[Pe]:{fallback:!0}},n.dispose(),this}}Qn.EXTENSION_NAME=Pe,Qn.EncoderMethod=Cr;const Tr="EXT_texture_avif";class eu{match(e){return e.length>=12&&Q.decodeText(e.slice(4,12))==="ftypavif"}getSize(e){if(!this.match(e))return null;const r=new DataView(e.buffer,e.byteOffset,e.byteLength);let n=Ri(r,0);if(!n)return null;let s=n.end;for(;n=Ri(r,s);)if(n.type==="meta")s=n.start+4;else if(n.type==="iprp"||n.type==="ipco")s=n.start;else{if(n.type==="ispe")return[r.getUint32(n.start+4),r.getUint32(n.start+8)];if(n.type==="mdat")break;s=n.end}return null}getChannels(e){return 4}}class fa extends me{constructor(...e){super(...e),this.extensionName=Tr,this.prereadTypes=[q.TEXTURE]}static register(){ot.registerFormat("image/avif",new eu)}preread(e){return(e.jsonDoc.json.textures||[]).forEach(r=>{r.extensions&&r.extensions[Tr]&&(r.source=r.extensions[Tr].source)}),this}read(e){return this}write(e){const r=e.jsonDoc;return this.document.getRoot().listTextures().forEach(n=>{if(n.getMimeType()==="image/avif"){const s=e.imageIndexMap.get(n);(r.json.textures||[]).forEach(i=>{i.source===s&&(i.extensions=i.extensions||{},i.extensions[Tr]={source:i.source},delete i.source)})}}),this}}function Ri(t,e){if(t.byteLength<4+e)return null;const r=t.getUint32(e);return t.byteLength<r+e||r<8?null:{type:Q.decodeText(new Uint8Array(t.buffer,t.byteOffset+e+4,4)),start:e+8,end:e+r}}fa.EXTENSION_NAME=Tr;const Mr="EXT_texture_webp";class tu{match(e){return e.length>=12&&e[8]===87&&e[9]===69&&e[10]===66&&e[11]===80}getSize(e){const r=Q.decodeText(e.slice(0,4)),n=Q.decodeText(e.slice(8,12));if(r!=="RIFF"||n!=="WEBP")return null;const s=new DataView(e.buffer,e.byteOffset);let i=12;for(;i<s.byteLength;){const a=Q.decodeText(new Uint8Array([s.getUint8(i),s.getUint8(i+1),s.getUint8(i+2),s.getUint8(i+3)])),o=s.getUint32(i+4,!0);if(a==="VP8 ")return[16383&s.getInt16(i+14,!0),16383&s.getInt16(i+16,!0)];if(a==="VP8L"){const c=s.getUint8(i+9),f=s.getUint8(i+10),h=s.getUint8(i+11);return[1+((63&f)<<8|c),1+((15&s.getUint8(i+12))<<10|h<<2|(192&f)>>6)]}i+=8+o+o%2}return null}getChannels(e){return 4}}class ua extends me{constructor(...e){super(...e),this.extensionName=Mr,this.prereadTypes=[q.TEXTURE]}static register(){ot.registerFormat("image/webp",new tu)}preread(e){return(e.jsonDoc.json.textures||[]).forEach(r=>{r.extensions&&r.extensions[Mr]&&(r.source=r.extensions[Mr].source)}),this}read(e){return this}write(e){const r=e.jsonDoc;return this.document.getRoot().listTextures().forEach(n=>{if(n.getMimeType()==="image/webp"){const s=e.imageIndexMap.get(n);(r.json.textures||[]).forEach(i=>{i.source===s&&(i.extensions=i.extensions||{},i.extensions[Mr]={source:i.source},delete i.source)})}}),this}}ua.EXTENSION_NAME=Mr;const wi=aa;let be,ha,pa,ke;function ru(t,e){const r=new be.DecoderBuffer;try{if(r.Init(e,e.length),t.GetEncodedGeometryType(r)!==be.TRIANGULAR_MESH)throw new Error(`[${wi}] Unknown geometry type.`);const n=new be.Mesh;if(!t.DecodeBufferToMesh(r,n).ok()||n.ptr===0)throw new Error(`[${wi}] Decoding failure.`);return n}finally{be.destroy(r)}}function nu(t,e){const r=3*e.num_faces();let n,s;if(e.num_points()<=65534){const i=r*Uint16Array.BYTES_PER_ELEMENT;n=be._malloc(i),t.GetTrianglesUInt16Array(e,i,n),s=new Uint16Array(be.HEAPU16.buffer,n,r).slice()}else{const i=r*Uint32Array.BYTES_PER_ELEMENT;n=be._malloc(i),t.GetTrianglesUInt32Array(e,i,n),s=new Uint32Array(be.HEAPU32.buffer,n,r).slice()}return be._free(n),s}function su(t,e,r,n){const s=pa[n.componentType],i=ha[n.componentType],a=r.num_components(),o=e.num_points()*a,c=o*i.BYTES_PER_ELEMENT,f=be._malloc(c);t.GetAttributeDataArrayForAllPoints(e,r,s,c,f);const h=new i(be.HEAPF32.buffer,f,o).slice();return be._free(f),h}var Nr,Ge;(function(t){t[t.EDGEBREAKER=1]="EDGEBREAKER",t[t.SEQUENTIAL=0]="SEQUENTIAL"})(Nr||(Nr={})),function(t){t.POSITION="POSITION",t.NORMAL="NORMAL",t.COLOR="COLOR",t.TEX_COORD="TEX_COORD",t.GENERIC="GENERIC"}(Ge||(Ge={}));const ga={[Ge.POSITION]:14,[Ge.NORMAL]:10,[Ge.COLOR]:8,[Ge.TEX_COORD]:12,[Ge.GENERIC]:12},Ii={decodeSpeed:5,encodeSpeed:5,method:Nr.EDGEBREAKER,quantizationBits:ga,quantizationVolume:"mesh"};function iu(t,e=Ii){const r=pt({},Ii,e);r.quantizationBits=pt({},ga,e.quantizationBits);const n=new ke.MeshBuilder,s=new ke.Mesh,i=new ke.ExpertEncoder(s),a={},o=new ke.DracoInt8Array,c=t.listTargets().length>0;let f=!1;for(const R of t.listSemantics()){const p=t.getAttribute(R);if(p.getSparse()){f=!0;continue}const w=au(R),g=ou(n,p.getComponentType(),s,ke[w],p.getCount(),p.getElementSize(),p.getArray());if(g===-1)throw new Error(`Error compressing "${R}" attribute.`);if(a[R]=g,r.quantizationVolume==="mesh"||R!=="POSITION")i.SetAttributeQuantization(g,r.quantizationBits[w]);else{if(typeof r.quantizationVolume!="object")throw new Error("Invalid quantization volume state.");{const{quantizationVolume:x}=r,T=Math.max(x.max[0]-x.min[0],x.max[1]-x.min[1],x.max[2]-x.min[2]);i.SetAttributeExplicitQuantization(g,r.quantizationBits[w],p.getElementSize(),x.min,T)}}}const h=t.getIndices();if(!h)throw new es("Primitive must have indices.");n.AddFacesToMesh(s,h.getCount()/3,h.getArray()),i.SetSpeedOptions(r.encodeSpeed,r.decodeSpeed),i.SetTrackEncodedProperties(!0),i.SetEncodingMethod(r.method===Nr.SEQUENTIAL||c||f?ke.MESH_SEQUENTIAL_ENCODING:ke.MESH_EDGEBREAKER_ENCODING);const d=i.EncodeToDracoBuffer(!(c||f),o);if(d<=0)throw new es("Error applying Draco compression.");const m=new Uint8Array(d);for(let R=0;R<d;++R)m[R]=o.GetValue(R);const y=i.GetNumberOfEncodedPoints(),M=3*i.GetNumberOfEncodedFaces();return ke.destroy(o),ke.destroy(s),ke.destroy(n),ke.destroy(i),{numVertices:y,numIndices:M,data:m,attributeIDs:a}}function au(t){return t==="POSITION"?Ge.POSITION:t==="NORMAL"?Ge.NORMAL:t.startsWith("COLOR_")?Ge.COLOR:t.startsWith("TEXCOORD_")?Ge.TEX_COORD:Ge.GENERIC}function ou(t,e,r,n,s,i,a){switch(e){case X.ComponentType.UNSIGNED_BYTE:return t.AddUInt8Attribute(r,n,s,i,a);case X.ComponentType.BYTE:return t.AddInt8Attribute(r,n,s,i,a);case X.ComponentType.UNSIGNED_SHORT:return t.AddUInt16Attribute(r,n,s,i,a);case X.ComponentType.SHORT:return t.AddInt16Attribute(r,n,s,i,a);case X.ComponentType.UNSIGNED_INT:return t.AddUInt32Attribute(r,n,s,i,a);case X.ComponentType.FLOAT:return t.AddFloatAttribute(r,n,s,i,a);default:throw new Error(`Unexpected component type, "${e}".`)}}class es extends Error{}const Ee=aa;class ts extends me{constructor(...e){super(...e),this.extensionName=Ee,this.prereadTypes=[q.PRIMITIVE],this.prewriteTypes=[q.ACCESSOR],this.readDependencies=["draco3d.decoder"],this.writeDependencies=["draco3d.encoder"],this._decoderModule=null,this._encoderModule=null,this._encoderOptions={}}install(e,r){return e==="draco3d.decoder"&&(this._decoderModule=r,be=this._decoderModule,ha={[X.ComponentType.FLOAT]:Float32Array,[X.ComponentType.UNSIGNED_INT]:Uint32Array,[X.ComponentType.UNSIGNED_SHORT]:Uint16Array,[X.ComponentType.UNSIGNED_BYTE]:Uint8Array,[X.ComponentType.SHORT]:Int16Array,[X.ComponentType.BYTE]:Int8Array},pa={[X.ComponentType.FLOAT]:be.DT_FLOAT32,[X.ComponentType.UNSIGNED_INT]:be.DT_UINT32,[X.ComponentType.UNSIGNED_SHORT]:be.DT_UINT16,[X.ComponentType.UNSIGNED_BYTE]:be.DT_UINT8,[X.ComponentType.SHORT]:be.DT_INT16,[X.ComponentType.BYTE]:be.DT_INT8}),e==="draco3d.encoder"&&(this._encoderModule=r,ke=this._encoderModule),this}setEncoderOptions(e){return this._encoderOptions=e,this}preread(e){if(!this._decoderModule)throw new Error(`[${Ee}] Please install extension dependency, "draco3d.decoder".`);const r=this.document.getLogger(),n=e.jsonDoc,s=new Map;try{const i=n.json.meshes||[];for(const a of i)for(const o of a.primitives){if(!o.extensions||!o.extensions[Ee])continue;const c=o.extensions[Ee];let[f,h]=s.get(c.bufferView)||[];if(!h||!f){const d=n.json.bufferViews[c.bufferView],m=n.json.buffers[d.buffer],y=Q.toView(m.uri?n.resources[m.uri]:n.resources[rr],d.byteOffset||0,d.byteLength);f=new this._decoderModule.Decoder,h=ru(f,y),s.set(c.bufferView,[f,h]),r.debug(`[${Ee}] Decompressed ${y.byteLength} bytes.`)}for(const d in o.attributes){const m=e.jsonDoc.json.accessors[o.attributes[d]],y=f.GetAttributeByUniqueId(h,c.attributes[d]),M=su(f,h,y,m);e.accessors[o.attributes[d]].setArray(M)}o.indices!==void 0&&e.accessors[o.indices].setArray(nu(f,h))}}finally{for(const[i,a]of Array.from(s.values()))this._decoderModule.destroy(i),this._decoderModule.destroy(a)}return this}read(e){return this}prewrite(e,r){if(!this._encoderModule)throw new Error(`[${Ee}] Please install extension dependency, "draco3d.encoder".`);const n=this.document.getLogger();n.debug(`[${Ee}] Compression options: ${JSON.stringify(this._encoderOptions)}`);const s=function(o){const c=o.getLogger(),f=new Set,h=new Set;for(const p of o.getRoot().listMeshes())for(const w of p.listPrimitives())w.getIndices()?w.getMode()!==Sr.Mode.TRIANGLES?(h.add(w),c.warn(`[${Ee}] Skipping Draco compression on non-TRIANGLES primitive.`)):f.add(w):(h.add(w),c.warn(`[${Ee}] Skipping Draco compression on non-indexed primitive.`));const d=o.getRoot().listAccessors(),m=new Map;for(let p=0;p<d.length;p++)m.set(d[p],p);const y=new Map,M=new Set,R=new Map;for(const p of Array.from(f)){let w=Ai(p,m);if(M.has(w))R.set(p,w);else{if(y.has(p.getIndices())){const g=p.getIndices(),x=g.clone();m.set(x,o.getRoot().listAccessors().length-1),p.swap(g,x)}for(const g of p.listAttributes())if(y.has(g)){const x=g.clone();m.set(x,o.getRoot().listAccessors().length-1),p.swap(g,x)}w=Ai(p,m),M.add(w),R.set(p,w),y.set(p.getIndices(),w);for(const g of p.listAttributes())y.set(g,w)}}for(const p of Array.from(y.keys())){const w=new Set(p.listParents().map(g=>g.propertyType));if(w.size!==2||!w.has(q.PRIMITIVE)||!w.has(q.ROOT))throw new Error(`[${Ee}] Compressed accessors must only be used as indices or vertex attributes.`)}for(const p of Array.from(f)){const w=R.get(p),g=p.getIndices();if(y.get(g)!==w||p.listAttributes().some(x=>y.get(x)!==w))throw new Error(`[${Ee}] Draco primitives must share all, or no, accessors.`)}for(const p of Array.from(h)){const w=p.getIndices();if(y.has(w)||p.listAttributes().some(g=>y.has(g)))throw new Error(`[${Ee}] Accessor cannot be shared by compressed and uncompressed primitives.`)}return R}(this.document),i=new Map;let a="mesh";this._encoderOptions.quantizationVolume==="scene"&&(this.document.getRoot().listScenes().length!==1?n.warn(`[${Ee}]: quantizationVolume=scene requires exactly 1 scene.`):a=mf(this.document.getRoot().listScenes().pop()));for(const o of Array.from(s.keys())){const c=s.get(o);if(!c)throw new Error("Unexpected primitive.");if(i.has(c)){i.set(c,i.get(c));continue}const f=o.getIndices(),h=e.jsonDoc.json.accessors;let d;try{d=iu(o,pt({},this._encoderOptions,{quantizationVolume:a}))}catch(M){if(M instanceof es){n.warn(`[${Ee}]: ${M.message} Skipping primitive compression.`);continue}throw M}i.set(c,d);const m=e.createAccessorDef(f);m.count=d.numIndices,e.accessorIndexMap.set(f,h.length),h.push(m);for(const M of o.listSemantics()){const R=o.getAttribute(M);if(d.attributeIDs[M]===void 0)continue;const p=e.createAccessorDef(R);p.count=d.numVertices,e.accessorIndexMap.set(R,h.length),h.push(p)}const y=o.getAttribute("POSITION").getBuffer()||this.document.getRoot().listBuffers()[0];e.otherBufferViews.has(y)||e.otherBufferViews.set(y,[]),e.otherBufferViews.get(y).push(d.data)}return n.debug(`[${Ee}] Compressed ${s.size} primitives.`),e.extensionData[Ee]={primitiveHashMap:s,primitiveEncodingMap:i},this}write(e){const r=e.extensionData[Ee];for(const n of this.document.getRoot().listMeshes()){const s=e.jsonDoc.json.meshes[e.meshIndexMap.get(n)];for(let i=0;i<n.listPrimitives().length;i++){const a=n.listPrimitives()[i],o=s.primitives[i],c=r.primitiveHashMap.get(a);if(!c)continue;const f=r.primitiveEncodingMap.get(c);f&&(o.extensions=o.extensions||{},o.extensions[Ee]={bufferView:e.otherBufferViewsIndexMap.get(f.data),attributes:f.attributeIDs})}}if(!r.primitiveHashMap.size){const n=e.jsonDoc.json;n.extensionsUsed=(n.extensionsUsed||[]).filter(s=>s!==Ee),n.extensionsRequired=(n.extensionsRequired||[]).filter(s=>s!==Ee)}return this}}function Ai(t,e){const r=[],n=t.getIndices();r.push(e.get(n));for(const s of t.listAttributes())r.push(e.get(s));return r.sort().join("|")}ts.EXTENSION_NAME=Ee,ts.EncoderMethod=Nr;class ir extends we{init(){this.extensionName=gs,this.propertyType="Light",this.parentTypes=[q.NODE]}getDefaults(){return Object.assign(super.getDefaults(),{color:[1,1,1],intensity:1,type:ir.Type.POINT,range:null,innerConeAngle:0,outerConeAngle:Math.PI/4})}getColor(){return this.get("color")}setColor(e){return this.set("color",e)}getColorHex(){return Be.factorToHex(this.getColor())}setColorHex(e){const r=this.getColor().slice();return Be.hexToFactor(e,r),this.setColor(r)}getIntensity(){return this.get("intensity")}setIntensity(e){return this.set("intensity",e)}getType(){return this.get("type")}setType(e){return this.set("type",e)}getRange(){return this.get("range")}setRange(e){return this.set("range",e)}getInnerConeAngle(){return this.get("innerConeAngle")}setInnerConeAngle(e){return this.set("innerConeAngle",e)}getOuterConeAngle(){return this.get("outerConeAngle")}setOuterConeAngle(e){return this.set("outerConeAngle",e)}}ir.EXTENSION_NAME=gs,ir.Type={POINT:"point",SPOT:"spot",DIRECTIONAL:"directional"};const st=gs;class da extends me{constructor(...e){super(...e),this.extensionName=st}createLight(e=""){return new ir(this.document.getGraph(),e)}read(e){const r=e.jsonDoc;if(!r.json.extensions||!r.json.extensions[st])return this;const n=(r.json.extensions[st].lights||[]).map(s=>{var i,a;const o=this.createLight().setName(s.name||"").setType(s.type);return s.color!==void 0&&o.setColor(s.color),s.intensity!==void 0&&o.setIntensity(s.intensity),s.range!==void 0&&o.setRange(s.range),((i=s.spot)==null?void 0:i.innerConeAngle)!==void 0&&o.setInnerConeAngle(s.spot.innerConeAngle),((a=s.spot)==null?void 0:a.outerConeAngle)!==void 0&&o.setOuterConeAngle(s.spot.outerConeAngle),o});return r.json.nodes.forEach((s,i)=>{s.extensions&&s.extensions[st]&&e.nodes[i].setExtension(st,n[s.extensions[st].light])}),this}write(e){const r=e.jsonDoc;if(this.properties.size===0)return this;const n=[],s=new Map;for(const i of this.properties){const a=i,o={type:a.getType()};ve.eq(a.getColor(),[1,1,1])||(o.color=a.getColor()),a.getIntensity()!==1&&(o.intensity=a.getIntensity()),a.getRange()!=null&&(o.range=a.getRange()),a.getName()&&(o.name=a.getName()),a.getType()===ir.Type.SPOT&&(o.spot={innerConeAngle:a.getInnerConeAngle(),outerConeAngle:a.getOuterConeAngle()}),n.push(o),s.set(a,n.length-1)}return this.document.getRoot().listNodes().forEach(i=>{const a=i.getExtension(st);if(a){const o=e.nodeIndexMap.get(i),c=r.json.nodes[o];c.extensions=c.extensions||{},c.extensions[st]={light:s.get(a)}}}),r.json.extensions=r.json.extensions||{},r.json.extensions[st]={lights:n},this}}da.EXTENSION_NAME=st;const{R:cu,G:lu,B:fu}=et;class ma extends we{init(){this.extensionName=ds,this.propertyType="Anisotropy",this.parentTypes=[q.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{anisotropyStrength:0,anisotropyRotation:0,anisotropyTexture:null,anisotropyTextureInfo:new ye(this.graph,"anisotropyTextureInfo")})}getAnisotropyStrength(){return this.get("anisotropyStrength")}setAnisotropyStrength(e){return this.set("anisotropyStrength",e)}getAnisotropyRotation(){return this.get("anisotropyRotation")}setAnisotropyRotation(e){return this.set("anisotropyRotation",e)}getAnisotropyTexture(){return this.getRef("anisotropyTexture")}getAnisotropyTextureInfo(){return this.getRef("anisotropyTexture")?this.getRef("anisotropyTextureInfo"):null}setAnisotropyTexture(e){return this.setRef("anisotropyTexture",e,{channels:cu|lu|fu})}}ma.EXTENSION_NAME=ds;const Rt=ds;class va extends me{constructor(...e){super(...e),this.extensionName=Rt}createAnisotropy(){return new ma(this.document.getGraph())}read(e){const r=e.jsonDoc,n=r.json.textures||[];return(r.json.materials||[]).forEach((s,i)=>{if(s.extensions&&s.extensions[Rt]){const a=this.createAnisotropy();e.materials[i].setExtension(Rt,a);const o=s.extensions[Rt];if(o.anisotropyStrength!==void 0&&a.setAnisotropyStrength(o.anisotropyStrength),o.anisotropyRotation!==void 0&&a.setAnisotropyRotation(o.anisotropyRotation),o.anisotropyTexture!==void 0){const c=o.anisotropyTexture;a.setAnisotropyTexture(e.textures[n[c.index].source]),e.setTextureInfo(a.getAnisotropyTextureInfo(),c)}}}),this}write(e){const r=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const s=n.getExtension(Rt);if(s){const i=e.materialIndexMap.get(n),a=r.json.materials[i];a.extensions=a.extensions||{};const o=a.extensions[Rt]={};if(s.getAnisotropyStrength()>0&&(o.anisotropyStrength=s.getAnisotropyStrength()),s.getAnisotropyRotation()!==0&&(o.anisotropyRotation=s.getAnisotropyRotation()),s.getAnisotropyTexture()){const c=s.getAnisotropyTexture(),f=s.getAnisotropyTextureInfo();o.anisotropyTexture=e.createTextureInfoDef(c,f)}}}),this}}va.EXTENSION_NAME=Rt;const{R:bi,G:_i,B:uu}=et;class xa extends we{init(){this.extensionName=ms,this.propertyType="Clearcoat",this.parentTypes=[q.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{clearcoatFactor:0,clearcoatTexture:null,clearcoatTextureInfo:new ye(this.graph,"clearcoatTextureInfo"),clearcoatRoughnessFactor:0,clearcoatRoughnessTexture:null,clearcoatRoughnessTextureInfo:new ye(this.graph,"clearcoatRoughnessTextureInfo"),clearcoatNormalScale:1,clearcoatNormalTexture:null,clearcoatNormalTextureInfo:new ye(this.graph,"clearcoatNormalTextureInfo")})}getClearcoatFactor(){return this.get("clearcoatFactor")}setClearcoatFactor(e){return this.set("clearcoatFactor",e)}getClearcoatTexture(){return this.getRef("clearcoatTexture")}getClearcoatTextureInfo(){return this.getRef("clearcoatTexture")?this.getRef("clearcoatTextureInfo"):null}setClearcoatTexture(e){return this.setRef("clearcoatTexture",e,{channels:bi})}getClearcoatRoughnessFactor(){return this.get("clearcoatRoughnessFactor")}setClearcoatRoughnessFactor(e){return this.set("clearcoatRoughnessFactor",e)}getClearcoatRoughnessTexture(){return this.getRef("clearcoatRoughnessTexture")}getClearcoatRoughnessTextureInfo(){return this.getRef("clearcoatRoughnessTexture")?this.getRef("clearcoatRoughnessTextureInfo"):null}setClearcoatRoughnessTexture(e){return this.setRef("clearcoatRoughnessTexture",e,{channels:_i})}getClearcoatNormalScale(){return this.get("clearcoatNormalScale")}setClearcoatNormalScale(e){return this.set("clearcoatNormalScale",e)}getClearcoatNormalTexture(){return this.getRef("clearcoatNormalTexture")}getClearcoatNormalTextureInfo(){return this.getRef("clearcoatNormalTexture")?this.getRef("clearcoatNormalTextureInfo"):null}setClearcoatNormalTexture(e){return this.setRef("clearcoatNormalTexture",e,{channels:bi|_i|uu})}}xa.EXTENSION_NAME=ms;const wt=ms;class ya extends me{constructor(...e){super(...e),this.extensionName=wt}createClearcoat(){return new xa(this.document.getGraph())}read(e){const r=e.jsonDoc,n=r.json.textures||[];return(r.json.materials||[]).forEach((s,i)=>{if(s.extensions&&s.extensions[wt]){const a=this.createClearcoat();e.materials[i].setExtension(wt,a);const o=s.extensions[wt];if(o.clearcoatFactor!==void 0&&a.setClearcoatFactor(o.clearcoatFactor),o.clearcoatRoughnessFactor!==void 0&&a.setClearcoatRoughnessFactor(o.clearcoatRoughnessFactor),o.clearcoatTexture!==void 0){const c=o.clearcoatTexture;a.setClearcoatTexture(e.textures[n[c.index].source]),e.setTextureInfo(a.getClearcoatTextureInfo(),c)}if(o.clearcoatRoughnessTexture!==void 0){const c=o.clearcoatRoughnessTexture;a.setClearcoatRoughnessTexture(e.textures[n[c.index].source]),e.setTextureInfo(a.getClearcoatRoughnessTextureInfo(),c)}if(o.clearcoatNormalTexture!==void 0){const c=o.clearcoatNormalTexture;a.setClearcoatNormalTexture(e.textures[n[c.index].source]),e.setTextureInfo(a.getClearcoatNormalTextureInfo(),c),c.scale!==void 0&&a.setClearcoatNormalScale(c.scale)}}}),this}write(e){const r=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const s=n.getExtension(wt);if(s){const i=e.materialIndexMap.get(n),a=r.json.materials[i];a.extensions=a.extensions||{};const o=a.extensions[wt]={clearcoatFactor:s.getClearcoatFactor(),clearcoatRoughnessFactor:s.getClearcoatRoughnessFactor()};if(s.getClearcoatTexture()){const c=s.getClearcoatTexture(),f=s.getClearcoatTextureInfo();o.clearcoatTexture=e.createTextureInfoDef(c,f)}if(s.getClearcoatRoughnessTexture()){const c=s.getClearcoatRoughnessTexture(),f=s.getClearcoatRoughnessTextureInfo();o.clearcoatRoughnessTexture=e.createTextureInfoDef(c,f)}if(s.getClearcoatNormalTexture()){const c=s.getClearcoatNormalTexture(),f=s.getClearcoatNormalTextureInfo();o.clearcoatNormalTexture=e.createTextureInfoDef(c,f),s.getClearcoatNormalScale()!==1&&(o.clearcoatNormalTexture.scale=s.getClearcoatNormalScale())}}}),this}}ya.EXTENSION_NAME=wt;class Ta extends we{init(){this.extensionName=vs,this.propertyType="EmissiveStrength",this.parentTypes=[q.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{emissiveStrength:1})}getEmissiveStrength(){return this.get("emissiveStrength")}setEmissiveStrength(e){return this.set("emissiveStrength",e)}}Ta.EXTENSION_NAME=vs;const It=vs;class Ma extends me{constructor(...e){super(...e),this.extensionName=It}createEmissiveStrength(){return new Ta(this.document.getGraph())}read(e){return(e.jsonDoc.json.materials||[]).forEach((r,n)=>{if(r.extensions&&r.extensions[It]){const s=this.createEmissiveStrength();e.materials[n].setExtension(It,s);const i=r.extensions[It];i.emissiveStrength!==void 0&&s.setEmissiveStrength(i.emissiveStrength)}}),this}write(e){const r=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const s=n.getExtension(It);if(s){const i=e.materialIndexMap.get(n),a=r.json.materials[i];a.extensions=a.extensions||{},a.extensions[It]={emissiveStrength:s.getEmissiveStrength()}}}),this}}Ma.EXTENSION_NAME=It;class Ea extends we{init(){this.extensionName=xs,this.propertyType="IOR",this.parentTypes=[q.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{ior:1.5})}getIOR(){return this.get("ior")}setIOR(e){return this.set("ior",e)}}Ea.EXTENSION_NAME=xs;const At=xs;class Ra extends me{constructor(...e){super(...e),this.extensionName=At}createIOR(){return new Ea(this.document.getGraph())}read(e){return(e.jsonDoc.json.materials||[]).forEach((r,n)=>{if(r.extensions&&r.extensions[At]){const s=this.createIOR();e.materials[n].setExtension(At,s);const i=r.extensions[At];i.ior!==void 0&&s.setIOR(i.ior)}}),this}write(e){const r=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const s=n.getExtension(At);if(s){const i=e.materialIndexMap.get(n),a=r.json.materials[i];a.extensions=a.extensions||{},a.extensions[At]={ior:s.getIOR()}}}),this}}Ra.EXTENSION_NAME=At;const{R:hu,G:pu}=et;class wa extends we{init(){this.extensionName=ys,this.propertyType="Iridescence",this.parentTypes=[q.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{iridescenceFactor:0,iridescenceTexture:null,iridescenceTextureInfo:new ye(this.graph,"iridescenceTextureInfo"),iridescenceIOR:1.3,iridescenceThicknessMinimum:100,iridescenceThicknessMaximum:400,iridescenceThicknessTexture:null,iridescenceThicknessTextureInfo:new ye(this.graph,"iridescenceThicknessTextureInfo")})}getIridescenceFactor(){return this.get("iridescenceFactor")}setIridescenceFactor(e){return this.set("iridescenceFactor",e)}getIridescenceTexture(){return this.getRef("iridescenceTexture")}getIridescenceTextureInfo(){return this.getRef("iridescenceTexture")?this.getRef("iridescenceTextureInfo"):null}setIridescenceTexture(e){return this.setRef("iridescenceTexture",e,{channels:hu})}getIridescenceIOR(){return this.get("iridescenceIOR")}setIridescenceIOR(e){return this.set("iridescenceIOR",e)}getIridescenceThicknessMinimum(){return this.get("iridescenceThicknessMinimum")}setIridescenceThicknessMinimum(e){return this.set("iridescenceThicknessMinimum",e)}getIridescenceThicknessMaximum(){return this.get("iridescenceThicknessMaximum")}setIridescenceThicknessMaximum(e){return this.set("iridescenceThicknessMaximum",e)}getIridescenceThicknessTexture(){return this.getRef("iridescenceThicknessTexture")}getIridescenceThicknessTextureInfo(){return this.getRef("iridescenceThicknessTexture")?this.getRef("iridescenceThicknessTextureInfo"):null}setIridescenceThicknessTexture(e){return this.setRef("iridescenceThicknessTexture",e,{channels:pu})}}wa.EXTENSION_NAME=ys;const bt=ys;class Ia extends me{constructor(...e){super(...e),this.extensionName=bt}createIridescence(){return new wa(this.document.getGraph())}read(e){const r=e.jsonDoc,n=r.json.textures||[];return(r.json.materials||[]).forEach((s,i)=>{if(s.extensions&&s.extensions[bt]){const a=this.createIridescence();e.materials[i].setExtension(bt,a);const o=s.extensions[bt];if(o.iridescenceFactor!==void 0&&a.setIridescenceFactor(o.iridescenceFactor),o.iridescenceIor!==void 0&&a.setIridescenceIOR(o.iridescenceIor),o.iridescenceThicknessMinimum!==void 0&&a.setIridescenceThicknessMinimum(o.iridescenceThicknessMinimum),o.iridescenceThicknessMaximum!==void 0&&a.setIridescenceThicknessMaximum(o.iridescenceThicknessMaximum),o.iridescenceTexture!==void 0){const c=o.iridescenceTexture;a.setIridescenceTexture(e.textures[n[c.index].source]),e.setTextureInfo(a.getIridescenceTextureInfo(),c)}if(o.iridescenceThicknessTexture!==void 0){const c=o.iridescenceThicknessTexture;a.setIridescenceThicknessTexture(e.textures[n[c.index].source]),e.setTextureInfo(a.getIridescenceThicknessTextureInfo(),c)}}}),this}write(e){const r=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const s=n.getExtension(bt);if(s){const i=e.materialIndexMap.get(n),a=r.json.materials[i];a.extensions=a.extensions||{};const o=a.extensions[bt]={};if(s.getIridescenceFactor()>0&&(o.iridescenceFactor=s.getIridescenceFactor()),s.getIridescenceIOR()!==1.3&&(o.iridescenceIor=s.getIridescenceIOR()),s.getIridescenceThicknessMinimum()!==100&&(o.iridescenceThicknessMinimum=s.getIridescenceThicknessMinimum()),s.getIridescenceThicknessMaximum()!==400&&(o.iridescenceThicknessMaximum=s.getIridescenceThicknessMaximum()),s.getIridescenceTexture()){const c=s.getIridescenceTexture(),f=s.getIridescenceTextureInfo();o.iridescenceTexture=e.createTextureInfoDef(c,f)}if(s.getIridescenceThicknessTexture()){const c=s.getIridescenceThicknessTexture(),f=s.getIridescenceThicknessTextureInfo();o.iridescenceThicknessTexture=e.createTextureInfoDef(c,f)}}}),this}}Ia.EXTENSION_NAME=bt;const{R:Si,G:Ci,B:Ni,A:Oi}=et;class Aa extends we{init(){this.extensionName=Ts,this.propertyType="PBRSpecularGlossiness",this.parentTypes=[q.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{diffuseFactor:[1,1,1,1],diffuseTexture:null,diffuseTextureInfo:new ye(this.graph,"diffuseTextureInfo"),specularFactor:[1,1,1],glossinessFactor:1,specularGlossinessTexture:null,specularGlossinessTextureInfo:new ye(this.graph,"specularGlossinessTextureInfo")})}getDiffuseFactor(){return this.get("diffuseFactor")}setDiffuseFactor(e){return this.set("diffuseFactor",e)}getDiffuseHex(){return Be.factorToHex(this.getDiffuseFactor())}setDiffuseHex(e){const r=this.getDiffuseFactor().slice();return this.setDiffuseFactor(Be.hexToFactor(e,r))}getDiffuseTexture(){return this.getRef("diffuseTexture")}getDiffuseTextureInfo(){return this.getRef("diffuseTexture")?this.getRef("diffuseTextureInfo"):null}setDiffuseTexture(e){return this.setRef("diffuseTexture",e,{channels:Si|Ci|Ni|Oi,isColor:!0})}getSpecularFactor(){return this.get("specularFactor")}setSpecularFactor(e){return this.set("specularFactor",e)}getGlossinessFactor(){return this.get("glossinessFactor")}setGlossinessFactor(e){return this.set("glossinessFactor",e)}getSpecularGlossinessTexture(){return this.getRef("specularGlossinessTexture")}getSpecularGlossinessTextureInfo(){return this.getRef("specularGlossinessTexture")?this.getRef("specularGlossinessTextureInfo"):null}setSpecularGlossinessTexture(e){return this.setRef("specularGlossinessTexture",e,{channels:Si|Ci|Ni|Oi})}}Aa.EXTENSION_NAME=Ts;const _t=Ts;class ba extends me{constructor(...e){super(...e),this.extensionName=_t}createPBRSpecularGlossiness(){return new Aa(this.document.getGraph())}read(e){const r=e.jsonDoc,n=r.json.textures||[];return(r.json.materials||[]).forEach((s,i)=>{if(s.extensions&&s.extensions[_t]){const a=this.createPBRSpecularGlossiness();e.materials[i].setExtension(_t,a);const o=s.extensions[_t];if(o.diffuseFactor!==void 0&&a.setDiffuseFactor(o.diffuseFactor),o.specularFactor!==void 0&&a.setSpecularFactor(o.specularFactor),o.glossinessFactor!==void 0&&a.setGlossinessFactor(o.glossinessFactor),o.diffuseTexture!==void 0){const c=o.diffuseTexture;a.setDiffuseTexture(e.textures[n[c.index].source]),e.setTextureInfo(a.getDiffuseTextureInfo(),c)}if(o.specularGlossinessTexture!==void 0){const c=o.specularGlossinessTexture;a.setSpecularGlossinessTexture(e.textures[n[c.index].source]),e.setTextureInfo(a.getSpecularGlossinessTextureInfo(),c)}}}),this}write(e){const r=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const s=n.getExtension(_t);if(s){const i=e.materialIndexMap.get(n),a=r.json.materials[i];a.extensions=a.extensions||{};const o=a.extensions[_t]={diffuseFactor:s.getDiffuseFactor(),specularFactor:s.getSpecularFactor(),glossinessFactor:s.getGlossinessFactor()};if(s.getDiffuseTexture()){const c=s.getDiffuseTexture(),f=s.getDiffuseTextureInfo();o.diffuseTexture=e.createTextureInfoDef(c,f)}if(s.getSpecularGlossinessTexture()){const c=s.getSpecularGlossinessTexture(),f=s.getSpecularGlossinessTextureInfo();o.specularGlossinessTexture=e.createTextureInfoDef(c,f)}}}),this}}ba.EXTENSION_NAME=_t;const{R:gu,G:du,B:mu,A:vu}=et;class _a extends we{init(){this.extensionName=Ms,this.propertyType="Sheen",this.parentTypes=[q.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{sheenColorFactor:[0,0,0],sheenColorTexture:null,sheenColorTextureInfo:new ye(this.graph,"sheenColorTextureInfo"),sheenRoughnessFactor:0,sheenRoughnessTexture:null,sheenRoughnessTextureInfo:new ye(this.graph,"sheenRoughnessTextureInfo")})}getSheenColorFactor(){return this.get("sheenColorFactor")}getSheenColorHex(){return Be.factorToHex(this.getSheenColorFactor())}setSheenColorFactor(e){return this.set("sheenColorFactor",e)}setSheenColorHex(e){const r=this.getSheenColorFactor().slice();return this.set("sheenColorFactor",Be.hexToFactor(e,r))}getSheenColorTexture(){return this.getRef("sheenColorTexture")}getSheenColorTextureInfo(){return this.getRef("sheenColorTexture")?this.getRef("sheenColorTextureInfo"):null}setSheenColorTexture(e){return this.setRef("sheenColorTexture",e,{channels:gu|du|mu,isColor:!0})}getSheenRoughnessFactor(){return this.get("sheenRoughnessFactor")}setSheenRoughnessFactor(e){return this.set("sheenRoughnessFactor",e)}getSheenRoughnessTexture(){return this.getRef("sheenRoughnessTexture")}getSheenRoughnessTextureInfo(){return this.getRef("sheenRoughnessTexture")?this.getRef("sheenRoughnessTextureInfo"):null}setSheenRoughnessTexture(e){return this.setRef("sheenRoughnessTexture",e,{channels:vu})}}_a.EXTENSION_NAME=Ms;const St=Ms;class Sa extends me{constructor(...e){super(...e),this.extensionName=St}createSheen(){return new _a(this.document.getGraph())}read(e){const r=e.jsonDoc,n=r.json.textures||[];return(r.json.materials||[]).forEach((s,i)=>{if(s.extensions&&s.extensions[St]){const a=this.createSheen();e.materials[i].setExtension(St,a);const o=s.extensions[St];if(o.sheenColorFactor!==void 0&&a.setSheenColorFactor(o.sheenColorFactor),o.sheenRoughnessFactor!==void 0&&a.setSheenRoughnessFactor(o.sheenRoughnessFactor),o.sheenColorTexture!==void 0){const c=o.sheenColorTexture;a.setSheenColorTexture(e.textures[n[c.index].source]),e.setTextureInfo(a.getSheenColorTextureInfo(),c)}if(o.sheenRoughnessTexture!==void 0){const c=o.sheenRoughnessTexture;a.setSheenRoughnessTexture(e.textures[n[c.index].source]),e.setTextureInfo(a.getSheenRoughnessTextureInfo(),c)}}}),this}write(e){const r=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const s=n.getExtension(St);if(s){const i=e.materialIndexMap.get(n),a=r.json.materials[i];a.extensions=a.extensions||{};const o=a.extensions[St]={sheenColorFactor:s.getSheenColorFactor(),sheenRoughnessFactor:s.getSheenRoughnessFactor()};if(s.getSheenColorTexture()){const c=s.getSheenColorTexture(),f=s.getSheenColorTextureInfo();o.sheenColorTexture=e.createTextureInfoDef(c,f)}if(s.getSheenRoughnessTexture()){const c=s.getSheenRoughnessTexture(),f=s.getSheenRoughnessTextureInfo();o.sheenRoughnessTexture=e.createTextureInfoDef(c,f)}}}),this}}Sa.EXTENSION_NAME=St;const{R:xu,G:yu,B:Tu,A:Mu}=et;class Ca extends we{init(){this.extensionName=Es,this.propertyType="Specular",this.parentTypes=[q.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{specularFactor:1,specularTexture:null,specularTextureInfo:new ye(this.graph,"specularTextureInfo"),specularColorFactor:[1,1,1],specularColorTexture:null,specularColorTextureInfo:new ye(this.graph,"specularColorTextureInfo")})}getSpecularFactor(){return this.get("specularFactor")}setSpecularFactor(e){return this.set("specularFactor",e)}getSpecularColorFactor(){return this.get("specularColorFactor")}setSpecularColorFactor(e){return this.set("specularColorFactor",e)}getSpecularColorHex(){return Be.factorToHex(this.getSpecularColorFactor())}setSpecularColorHex(e){const r=this.getSpecularColorFactor().slice();return this.set("specularColorFactor",Be.hexToFactor(e,r))}getSpecularTexture(){return this.getRef("specularTexture")}getSpecularTextureInfo(){return this.getRef("specularTexture")?this.getRef("specularTextureInfo"):null}setSpecularTexture(e){return this.setRef("specularTexture",e,{channels:Mu})}getSpecularColorTexture(){return this.getRef("specularColorTexture")}getSpecularColorTextureInfo(){return this.getRef("specularColorTexture")?this.getRef("specularColorTextureInfo"):null}setSpecularColorTexture(e){return this.setRef("specularColorTexture",e,{channels:xu|yu|Tu,isColor:!0})}}Ca.EXTENSION_NAME=Es;const Ct=Es;class Na extends me{constructor(...e){super(...e),this.extensionName=Ct}createSpecular(){return new Ca(this.document.getGraph())}read(e){const r=e.jsonDoc,n=r.json.textures||[];return(r.json.materials||[]).forEach((s,i)=>{if(s.extensions&&s.extensions[Ct]){const a=this.createSpecular();e.materials[i].setExtension(Ct,a);const o=s.extensions[Ct];if(o.specularFactor!==void 0&&a.setSpecularFactor(o.specularFactor),o.specularColorFactor!==void 0&&a.setSpecularColorFactor(o.specularColorFactor),o.specularTexture!==void 0){const c=o.specularTexture;a.setSpecularTexture(e.textures[n[c.index].source]),e.setTextureInfo(a.getSpecularTextureInfo(),c)}if(o.specularColorTexture!==void 0){const c=o.specularColorTexture;a.setSpecularColorTexture(e.textures[n[c.index].source]),e.setTextureInfo(a.getSpecularColorTextureInfo(),c)}}}),this}write(e){const r=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const s=n.getExtension(Ct);if(s){const i=e.materialIndexMap.get(n),a=r.json.materials[i];a.extensions=a.extensions||{};const o=a.extensions[Ct]={};if(s.getSpecularFactor()!==1&&(o.specularFactor=s.getSpecularFactor()),ve.eq(s.getSpecularColorFactor(),[1,1,1])||(o.specularColorFactor=s.getSpecularColorFactor()),s.getSpecularTexture()){const c=s.getSpecularTexture(),f=s.getSpecularTextureInfo();o.specularTexture=e.createTextureInfoDef(c,f)}if(s.getSpecularColorTexture()){const c=s.getSpecularColorTexture(),f=s.getSpecularColorTextureInfo();o.specularColorTexture=e.createTextureInfoDef(c,f)}}}),this}}Na.EXTENSION_NAME=Ct;const{R:Eu}=et;class Oa extends we{init(){this.extensionName=Rs,this.propertyType="Transmission",this.parentTypes=[q.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{transmissionFactor:0,transmissionTexture:null,transmissionTextureInfo:new ye(this.graph,"transmissionTextureInfo")})}getTransmissionFactor(){return this.get("transmissionFactor")}setTransmissionFactor(e){return this.set("transmissionFactor",e)}getTransmissionTexture(){return this.getRef("transmissionTexture")}getTransmissionTextureInfo(){return this.getRef("transmissionTexture")?this.getRef("transmissionTextureInfo"):null}setTransmissionTexture(e){return this.setRef("transmissionTexture",e,{channels:Eu})}}Oa.EXTENSION_NAME=Rs;const Nt=Rs;class $a extends me{constructor(...e){super(...e),this.extensionName=Nt}createTransmission(){return new Oa(this.document.getGraph())}read(e){const r=e.jsonDoc,n=r.json.textures||[];return(r.json.materials||[]).forEach((s,i)=>{if(s.extensions&&s.extensions[Nt]){const a=this.createTransmission();e.materials[i].setExtension(Nt,a);const o=s.extensions[Nt];if(o.transmissionFactor!==void 0&&a.setTransmissionFactor(o.transmissionFactor),o.transmissionTexture!==void 0){const c=o.transmissionTexture;a.setTransmissionTexture(e.textures[n[c.index].source]),e.setTextureInfo(a.getTransmissionTextureInfo(),c)}}}),this}write(e){const r=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const s=n.getExtension(Nt);if(s){const i=e.materialIndexMap.get(n),a=r.json.materials[i];a.extensions=a.extensions||{};const o=a.extensions[Nt]={transmissionFactor:s.getTransmissionFactor()};if(s.getTransmissionTexture()){const c=s.getTransmissionTexture(),f=s.getTransmissionTextureInfo();o.transmissionTexture=e.createTextureInfoDef(c,f)}}}),this}}$a.EXTENSION_NAME=Nt;class Fa extends we{init(){this.extensionName=ws,this.propertyType="Unlit",this.parentTypes=[q.MATERIAL]}}Fa.EXTENSION_NAME=ws;const Kt=ws;class bs extends me{constructor(...e){super(...e),this.extensionName=Kt}createUnlit(){return new Fa(this.document.getGraph())}read(e){return(e.jsonDoc.json.materials||[]).forEach((r,n)=>{r.extensions&&r.extensions[Kt]&&e.materials[n].setExtension(Kt,this.createUnlit())}),this}write(e){const r=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{if(n.getExtension(Kt)){const s=e.materialIndexMap.get(n),i=r.json.materials[s];i.extensions=i.extensions||{},i.extensions[Kt]={}}}),this}}bs.EXTENSION_NAME=Kt;class Da extends we{init(){this.extensionName=zt,this.propertyType="Mapping",this.parentTypes=["MappingList"]}getDefaults(){return Object.assign(super.getDefaults(),{material:null,variants:[]})}getMaterial(){return this.getRef("material")}setMaterial(e){return this.setRef("material",e)}addVariant(e){return this.addRef("variants",e)}removeVariant(e){return this.removeRef("variants",e)}listVariants(){return this.listRefs("variants")}}Da.EXTENSION_NAME=zt;class Pa extends we{init(){this.extensionName=zt,this.propertyType="MappingList",this.parentTypes=[q.PRIMITIVE]}getDefaults(){return Object.assign(super.getDefaults(),{mappings:[]})}addMapping(e){return this.addRef("mappings",e)}removeMapping(e){return this.removeRef("mappings",e)}listMappings(){return this.listRefs("mappings")}}Pa.EXTENSION_NAME=zt;class rs extends we{init(){this.extensionName=zt,this.propertyType="Variant",this.parentTypes=["MappingList"]}}rs.EXTENSION_NAME=zt;const it=zt;class Ua extends me{constructor(...e){super(...e),this.extensionName=it}createMappingList(){return new Pa(this.document.getGraph())}createVariant(e=""){return new rs(this.document.getGraph(),e)}createMapping(){return new Da(this.document.getGraph())}listVariants(){return Array.from(this.properties).filter(e=>e instanceof rs)}read(e){const r=e.jsonDoc;if(!r.json.extensions||!r.json.extensions[it])return this;const n=(r.json.extensions[it].variants||[]).map(s=>this.createVariant().setName(s.name||""));return(r.json.meshes||[]).forEach((s,i)=>{const a=e.meshes[i];(s.primitives||[]).forEach((o,c)=>{if(!o.extensions||!o.extensions[it])return;const f=this.createMappingList(),h=o.extensions[it];for(const d of h.mappings){const m=this.createMapping();d.material!==void 0&&m.setMaterial(e.materials[d.material]);for(const y of d.variants||[])m.addVariant(n[y]);f.addMapping(m)}a.listPrimitives()[c].setExtension(it,f)})}),this}write(e){const r=e.jsonDoc,n=this.listVariants();if(!n.length)return this;const s=[],i=new Map;for(const a of n)i.set(a,s.length),s.push(e.createPropertyDef(a));for(const a of this.document.getRoot().listMeshes()){const o=e.meshIndexMap.get(a);a.listPrimitives().forEach((c,f)=>{const h=c.getExtension(it);if(!h)return;const d=e.jsonDoc.json.meshes[o].primitives[f],m=h.listMappings().map(y=>{const M=e.createPropertyDef(y),R=y.getMaterial();return R&&(M.material=e.materialIndexMap.get(R)),M.variants=y.listVariants().map(p=>i.get(p)),M});d.extensions=d.extensions||{},d.extensions[it]={mappings:m}})}return r.json.extensions=r.json.extensions||{},r.json.extensions[it]={variants:s},this}}Ua.EXTENSION_NAME=it;const{G:Ru}=et;class La extends we{init(){this.extensionName=Is,this.propertyType="Volume",this.parentTypes=[q.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{thicknessFactor:0,thicknessTexture:null,thicknessTextureInfo:new ye(this.graph,"thicknessTexture"),attenuationDistance:1/0,attenuationColor:[1,1,1]})}getThicknessFactor(){return this.get("thicknessFactor")}setThicknessFactor(e){return this.set("thicknessFactor",e)}getThicknessTexture(){return this.getRef("thicknessTexture")}getThicknessTextureInfo(){return this.getRef("thicknessTexture")?this.getRef("thicknessTextureInfo"):null}setThicknessTexture(e){return this.setRef("thicknessTexture",e,{channels:Ru})}getAttenuationDistance(){return this.get("attenuationDistance")}setAttenuationDistance(e){return this.set("attenuationDistance",e)}getAttenuationColor(){return this.get("attenuationColor")}setAttenuationColor(e){return this.set("attenuationColor",e)}getAttenuationColorHex(){return Be.factorToHex(this.getAttenuationColor())}setAttenuationColorHex(e){const r=this.getAttenuationColor().slice();return this.set("attenuationColor",Be.hexToFactor(e,r))}}La.EXTENSION_NAME=Is;const Ot=Is;class Ba extends me{constructor(...e){super(...e),this.extensionName=Ot}createVolume(){return new La(this.document.getGraph())}read(e){const r=e.jsonDoc,n=r.json.textures||[];return(r.json.materials||[]).forEach((s,i)=>{if(s.extensions&&s.extensions[Ot]){const a=this.createVolume();e.materials[i].setExtension(Ot,a);const o=s.extensions[Ot];if(o.thicknessFactor!==void 0&&a.setThicknessFactor(o.thicknessFactor),o.attenuationDistance!==void 0&&a.setAttenuationDistance(o.attenuationDistance),o.attenuationColor!==void 0&&a.setAttenuationColor(o.attenuationColor),o.thicknessTexture!==void 0){const c=o.thicknessTexture;a.setThicknessTexture(e.textures[n[c.index].source]),e.setTextureInfo(a.getThicknessTextureInfo(),c)}}}),this}write(e){const r=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const s=n.getExtension(Ot);if(s){const i=e.materialIndexMap.get(n),a=r.json.materials[i];a.extensions=a.extensions||{};const o=a.extensions[Ot]={};if(s.getThicknessFactor()>0&&(o.thicknessFactor=s.getThicknessFactor()),Number.isFinite(s.getAttenuationDistance())&&(o.attenuationDistance=s.getAttenuationDistance()),ve.eq(s.getAttenuationColor(),[1,1,1])||(o.attenuationColor=s.getAttenuationColor()),s.getThicknessTexture()){const c=s.getThicknessTexture(),f=s.getThicknessTextureInfo();o.thicknessTexture=e.createTextureInfoDef(c,f)}}}),this}}Ba.EXTENSION_NAME=Ot;const Va="KHR_mesh_quantization";class ja extends me{constructor(...e){super(...e),this.extensionName=Va}read(e){return this}write(e){return this}}ja.EXTENSION_NAME=Va;const Er="KHR_texture_basisu";class wu{match(e){return e[0]===171&&e[1]===75&&e[2]===84&&e[3]===88&&e[4]===32&&e[5]===50&&e[6]===48&&e[7]===187&&e[8]===13&&e[9]===10&&e[10]===26&&e[11]===10}getSize(e){const r=Bn(e);return[r.pixelWidth,r.pixelHeight]}getChannels(e){const r=Bn(e).dataFormatDescriptor[0];if(r.colorModel===jf)return r.samples.length===2&&(15&r.samples[1].channelType)==15?4:3;if(r.colorModel===zf)return(15&r.samples[0].channelType)==3?4:3;throw new Error(`Unexpected KTX2 colorModel, "${r.colorModel}".`)}getVRAMByteLength(e){const r=Bn(e),n=this.getChannels(e)>3;let s=0;for(let i=0;i<r.levels.length;i++){const a=r.levels[i];s+=a.uncompressedByteLength?a.uncompressedByteLength:Math.max(1,Math.floor(r.pixelWidth/Math.pow(2,i)))/4*(Math.max(1,Math.floor(r.pixelHeight/Math.pow(2,i)))/4)*(n?16:8)}return s}}class za extends me{constructor(...e){super(...e),this.extensionName=Er,this.prereadTypes=[q.TEXTURE]}static register(){ot.registerFormat("image/ktx2",new wu)}preread(e){return e.jsonDoc.json.textures.forEach(r=>{r.extensions&&r.extensions[Er]&&(r.source=r.extensions[Er].source)}),this}read(e){return this}write(e){const r=e.jsonDoc;return this.document.getRoot().listTextures().forEach(n=>{if(n.getMimeType()==="image/ktx2"){const s=e.imageIndexMap.get(n);r.json.textures.forEach(i=>{i.source===s&&(i.extensions=i.extensions||{},i.extensions[Er]={source:i.source},delete i.source)})}}),this}}za.EXTENSION_NAME=Er;class ka extends we{init(){this.extensionName=As,this.propertyType="Transform",this.parentTypes=[q.TEXTURE_INFO]}getDefaults(){return Object.assign(super.getDefaults(),{offset:[0,0],rotation:0,scale:[1,1],texCoord:null})}getOffset(){return this.get("offset")}setOffset(e){return this.set("offset",e)}getRotation(){return this.get("rotation")}setRotation(e){return this.set("rotation",e)}getScale(){return this.get("scale")}setScale(e){return this.set("scale",e)}getTexCoord(){return this.get("texCoord")}setTexCoord(e){return this.set("texCoord",e)}}ka.EXTENSION_NAME=As;const $t=As;class Ga extends me{constructor(...e){super(...e),this.extensionName=$t}createTransform(){return new ka(this.document.getGraph())}read(e){for(const[r,n]of Array.from(e.textureInfos.entries())){if(!n.extensions||!n.extensions[$t])continue;const s=this.createTransform(),i=n.extensions[$t];i.offset!==void 0&&s.setOffset(i.offset),i.rotation!==void 0&&s.setRotation(i.rotation),i.scale!==void 0&&s.setScale(i.scale),i.texCoord!==void 0&&s.setTexCoord(i.texCoord),r.setExtension($t,s)}return this}write(e){const r=Array.from(e.textureInfoDefMap.entries());for(const[n,s]of r){const i=n.getExtension($t);if(!i)continue;s.extensions=s.extensions||{};const a={},o=ve.eq;o(i.getOffset(),[0,0])||(a.offset=i.getOffset()),i.getRotation()!==0&&(a.rotation=i.getRotation()),o(i.getScale(),[1,1])||(a.scale=i.getScale()),i.getTexCoord()!=null&&(a.texCoord=i.getTexCoord()),s.extensions[$t]=a}return this}}Ga.EXTENSION_NAME=$t;const Iu=[q.ROOT,q.SCENE,q.NODE,q.MESH,q.MATERIAL,q.TEXTURE,q.ANIMATION];class qa extends we{init(){this.extensionName=cn,this.propertyType="Packet",this.parentTypes=Iu}getDefaults(){return Object.assign(super.getDefaults(),{context:{},properties:{}})}getContext(){return this.get("context")}setContext(e){return this.set("context",pt({},e))}listProperties(){return Object.keys(this.get("properties"))}getProperty(e){const r=this.get("properties");return e in r?r[e]:null}setProperty(e,r){this._assertContext(e);const n=pt({},this.get("properties"));return r?n[e]=r:delete n[e],this.set("properties",n)}toJSONLD(){return pt({"@context":jn(this.get("context"))},jn(this.get("properties")))}fromJSONLD(e){const r=(e=jn(e))["@context"];return r&&this.set("context",r),delete e["@context"],this.set("properties",e)}_assertContext(e){if(!(e.split(":")[0]in this.get("context")))throw new Error(`${cn}: Missing context for term, "${e}".`)}}function jn(t){return JSON.parse(JSON.stringify(t))}qa.EXTENSION_NAME=cn;const ht=cn;class Ha extends me{constructor(...e){super(...e),this.extensionName=ht}createPacket(){return new qa(this.document.getGraph())}listPackets(){return Array.from(this.properties)}read(e){var r;const n=(r=e.jsonDoc.json.extensions)==null?void 0:r[ht];if(!n||!n.packets)return this;const s=e.jsonDoc.json,i=this.document.getRoot(),a=n.packets.map(f=>this.createPacket().fromJSONLD(f)),o=[[s.asset],s.scenes,s.nodes,s.meshes,s.materials,s.images,s.animations],c=[[i],i.listScenes(),i.listNodes(),i.listMeshes(),i.listMaterials(),i.listTextures(),i.listAnimations()];for(let f=0;f<o.length;f++){const h=o[f]||[];for(let d=0;d<h.length;d++){const m=h[d];m.extensions&&m.extensions[ht]&&c[f][d].setExtension(ht,a[m.extensions[ht].packet])}}return this}write(e){const{json:r}=e.jsonDoc,n=[];for(const s of this.properties){n.push(s.toJSONLD());for(const i of s.listParents()){let a;switch(i.propertyType){case q.ROOT:a=r.asset;break;case q.SCENE:a=r.scenes[e.sceneIndexMap.get(i)];break;case q.NODE:a=r.nodes[e.nodeIndexMap.get(i)];break;case q.MESH:a=r.meshes[e.meshIndexMap.get(i)];break;case q.MATERIAL:a=r.materials[e.materialIndexMap.get(i)];break;case q.TEXTURE:a=r.images[e.imageIndexMap.get(i)];break;case q.ANIMATION:a=r.animations[e.animationIndexMap.get(i)];break;default:a=null,this.document.getLogger().warn(`[${ht}]: Unsupported parent property, "${i.propertyType}"`)}a&&(a.extensions=a.extensions||{},a.extensions[ht]={packet:n.length-1})}}return n.length>0&&(r.extensions=r.extensions||{},r.extensions[ht]={packets:n}),this}}Ha.EXTENSION_NAME=ht;const Wa=[ts,da,va,ya,Ma,Ra,Ia,ba,Na,Sa,$a,bs,Ua,Ba,ja,za,Ga,Ha];[...Wa];const Xa=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],Ya=t=>{let e="";for(let r=0;r<16;r++)r%4!=3&&(r>0&&(e+=" "),e+=t[r]||0);return e},Au=(t=1,e=Xa)=>`    <item objectid="${t}" transform="${Ya(e)}" />
`,$i=t=>t?t.toISOString().substring(0,10):"";function bu(t,{unit:e="millimeter",title:r="jscad model",author:n="",description:s="",application:i="jscad",creationDate:a=new Date,license:o="",modificationDate:c}={}){t.push(`<?xml version="1.0" encoding="UTF-8"?>
<model unit="${e}" xml:lang="en-US" xmlns="http://schemas.microsoft.com/3dmanufacturing/core/2015/02" xmlns:slic3rpe="http://schemas.slic3r.org/3mf/2017/06">
  <metadata name="slic3rpe:Version3mf">1</metadata>
  <metadata name="Title">${r}</metadata>
  <metadata name="Designer">${n}</metadata>
  <metadata name="Description">${s||r}</metadata>
  <metadata name="Copyright"></metadata>
  <metadata name="LicenseTerms">${o}</metadata>
  <metadata name="Rating"></metadata>
  <metadata name="CreationDate">${$i(a)}</metadata>
  <metadata name="ModificationDate">${$i(c||a)}</metadata>
  <metadata name="Application">${i}</metadata>
   `)}function _u(t,e,r,n){t.push(`<object id="${e}" type="model"${n==null?"":' name="'+n+'"'}>
`),t.push(` <components>
`),r.forEach(({objectID:s,transform:i})=>{Su(t,s,i)}),t.push(` </components>
`),t.push(`</object>
`)}const Su=(t,e=1,r=Xa)=>{t.push(`    <component objectid="${e}" transform="${Ya(r)}" />
`)};function Cu(t,e,r,n,s,i){t.push(`  <object id="${e}" type="model"${i?' name="'+i+'"':""}>
   <mesh>
    <vertices>
`);for(let a=0;a<r.length;a+=3)t.push(`     <vertex x="${r[a].toPrecision(s)}" y="${r[a+1].toPrecision(s)}" z="${r[a+2].toPrecision(s)}" />
`);t.push(`    </vertices>
    <triangles>
`);for(let a=0;a<n.length;a+=3)t.push(`     <triangle v1="${n[a]}" v2="${n[a+1]}" v3="${n[a+2]}" />
`);return t.push(`    </triangles>
   </mesh>
  </object>
`),t}const Fi={name:"[Content_Types].xml",content:`<?xml version="1.0" encoding="UTF-8"?>
<Types xmlns="http://schemas.openxmlformats.org/package/2006/content-types">
<Default Extension="rels" ContentType="application/vnd.openxmlformats-package.relationships+xml" />
<Default Extension="model" ContentType="application/vnd.ms-package.3dmanufacturing-3dmodel+xml" />
<Default Extension="png" ContentType="image/png" />
</Types>`};function Nu({meshes:t=[],components:e=[],items:r=[],precision:n=17,header:s}){const i=[];return bu(i,s),i.push(`  <resources>
`),r.length==0&&console.error("3MF empty build! Include items or simple."),t.forEach(({id:a,vertices:o,indices:c,name:f})=>Cu(i,a,o,c,n,f)),e.forEach(({id:a,children:o,name:c})=>{_u(i,a,o,c)}),i.push(`  </resources>
`),i.push(`<build>
`),r.forEach(({objectID:a,transform:o})=>{i.push(Au(a,o))}),i.push(`</build>
`),i.push(`</model>
`),i.join("")}class Ou{constructor(){this.idSeq=0,this.lines=['<?xml version="1.0" encoding="UTF-8"?>','<Relationships xmlns="http://schemas.openxmlformats.org/package/2006/relationships">']}get name(){return"_rels/.rels"}addRel(e,r){this.lines.push(`  <Relationship Target="${e}" Id="rel-${++this.idSeq}" Type="${r}" />`)}add3dModel(e){this.addRel(e,"http://schemas.microsoft.com/3dmanufacturing/2013/01/3dmodel")}addThumbnail(e){this.addRel(e,"http://schemas.openxmlformats.org/package/2006/relationships/metadata/thumbnail")}get content(){return this.lines.join(`
`)+`
</Relationships>`}}var $e=Uint8Array,je=Uint16Array,_s=Int32Array,Ss=new $e([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Cs=new $e([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Di=new $e([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Ka=function(t,e){for(var r=new je(31),n=0;n<31;++n)r[n]=e+=1<<t[n-1];for(var s=new _s(r[30]),n=1;n<30;++n)for(var i=r[n];i<r[n+1];++i)s[i]=i-r[n]<<5|n;return{b:r,r:s}},Ja=Ka(Ss,2),$u=Ja.b,ns=Ja.r;$u[28]=258,ns[258]=28;var Fu=Ka(Cs,0),Pi=Fu.r,ss=new je(32768);for(var pe=0;pe<32768;++pe){var vt=(pe&43690)>>1|(pe&21845)<<1;vt=(vt&52428)>>2|(vt&13107)<<2,vt=(vt&61680)>>4|(vt&3855)<<4,ss[pe]=((vt&65280)>>8|(vt&255)<<8)>>1}var Ar=function(t,e,r){for(var n=t.length,s=0,i=new je(e);s<n;++s)t[s]&&++i[t[s]-1];var a=new je(e);for(s=1;s<e;++s)a[s]=a[s-1]+i[s-1]<<1;var o;if(r){o=new je(1<<e);var c=15-e;for(s=0;s<n;++s)if(t[s])for(var f=s<<4|t[s],h=e-t[s],d=a[t[s]-1]++<<h,m=d|(1<<h)-1;d<=m;++d)o[ss[d]>>c]=f}else for(o=new je(n),s=0;s<n;++s)t[s]&&(o[s]=ss[a[t[s]-1]++]>>15-t[s]);return o},Vt=new $e(288);for(var pe=0;pe<144;++pe)Vt[pe]=8;for(var pe=144;pe<256;++pe)Vt[pe]=9;for(var pe=256;pe<280;++pe)Vt[pe]=7;for(var pe=280;pe<288;++pe)Vt[pe]=8;var ln=new $e(32);for(var pe=0;pe<32;++pe)ln[pe]=5;var Du=Ar(Vt,9,0),Pu=Ar(ln,5,0),Za=function(t){return(t+7)/8|0},Qa=function(t,e,r){return(e==null||e<0)&&(e=0),(r==null||r>t.length)&&(r=t.length),new $e(t.subarray(e,r))},Uu=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],vn=function(t,e,r){var n=new Error(e||Uu[t]);if(n.code=t,Error.captureStackTrace&&Error.captureStackTrace(n,vn),!r)throw n;return n},ut=function(t,e,r){r<<=e&7;var n=e/8|0;t[n]|=r,t[n+1]|=r>>8},gr=function(t,e,r){r<<=e&7;var n=e/8|0;t[n]|=r,t[n+1]|=r>>8,t[n+2]|=r>>16},zn=function(t,e){for(var r=[],n=0;n<t.length;++n)t[n]&&r.push({s:n,f:t[n]});var s=r.length,i=r.slice();if(!s)return{t:to,l:0};if(s==1){var a=new $e(r[0].s+1);return a[r[0].s]=1,{t:a,l:1}}r.sort(function(I,b){return I.f-b.f}),r.push({s:-1,f:25001});var o=r[0],c=r[1],f=0,h=1,d=2;for(r[0]={s:-1,f:o.f+c.f,l:o,r:c};h!=s-1;)o=r[r[f].f<r[d].f?f++:d++],c=r[f!=h&&r[f].f<r[d].f?f++:d++],r[h++]={s:-1,f:o.f+c.f,l:o,r:c};for(var m=i[0].s,n=1;n<s;++n)i[n].s>m&&(m=i[n].s);var y=new je(m+1),M=is(r[h-1],y,0);if(M>e){var n=0,R=0,p=M-e,w=1<<p;for(i.sort(function(b,F){return y[F.s]-y[b.s]||b.f-F.f});n<s;++n){var g=i[n].s;if(y[g]>e)R+=w-(1<<M-y[g]),y[g]=e;else break}for(R>>=p;R>0;){var x=i[n].s;y[x]<e?R-=1<<e-y[x]++-1:++n}for(;n>=0&&R;--n){var T=i[n].s;y[T]==e&&(--y[T],++R)}M=e}return{t:new $e(y),l:M}},is=function(t,e,r){return t.s==-1?Math.max(is(t.l,e,r+1),is(t.r,e,r+1)):e[t.s]=r},Ui=function(t){for(var e=t.length;e&&!t[--e];);for(var r=new je(++e),n=0,s=t[0],i=1,a=function(c){r[n++]=c},o=1;o<=e;++o)if(t[o]==s&&o!=e)++i;else{if(!s&&i>2){for(;i>138;i-=138)a(32754);i>2&&(a(i>10?i-11<<5|28690:i-3<<5|12305),i=0)}else if(i>3){for(a(s),--i;i>6;i-=6)a(8304);i>2&&(a(i-3<<5|8208),i=0)}for(;i--;)a(s);i=1,s=t[o]}return{c:r.subarray(0,n),n:e}},dr=function(t,e){for(var r=0,n=0;n<e.length;++n)r+=t[n]*e[n];return r},eo=function(t,e,r){var n=r.length,s=Za(e+2);t[s]=n&255,t[s+1]=n>>8,t[s+2]=t[s]^255,t[s+3]=t[s+1]^255;for(var i=0;i<n;++i)t[s+i+4]=r[i];return(s+4+n)*8},Li=function(t,e,r,n,s,i,a,o,c,f,h){ut(e,h++,r),++s[256];for(var d=zn(s,15),m=d.t,y=d.l,M=zn(i,15),R=M.t,p=M.l,w=Ui(m),g=w.c,x=w.n,T=Ui(R),I=T.c,b=T.n,F=new je(19),O=0;O<g.length;++O)++F[g[O]&31];for(var O=0;O<I.length;++O)++F[I[O]&31];for(var C=zn(F,7),V=C.t,L=C.l,j=19;j>4&&!V[Di[j-1]];--j);var G=f+5<<3,P=dr(s,Vt)+dr(i,ln)+a,Y=dr(s,m)+dr(i,R)+a+14+3*j+dr(F,V)+2*F[16]+3*F[17]+7*F[18];if(c>=0&&G<=P&&G<=Y)return eo(e,h,t.subarray(c,c+f));var te,K,ie,se;if(ut(e,h,1+(Y<P)),h+=2,Y<P){te=Ar(m,y,0),K=m,ie=Ar(R,p,0),se=R;var ae=Ar(V,L,0);ut(e,h,x-257),ut(e,h+5,b-1),ut(e,h+10,j-4),h+=14;for(var O=0;O<j;++O)ut(e,h+3*O,V[Di[O]]);h+=3*j;for(var oe=[g,I],he=0;he<2;++he)for(var Ae=oe[he],O=0;O<Ae.length;++O){var ge=Ae[O]&31;ut(e,h,ae[ge]),h+=V[ge],ge>15&&(ut(e,h,Ae[O]>>5&127),h+=Ae[O]>>12)}}else te=Du,K=Vt,ie=Pu,se=ln;for(var O=0;O<o;++O){var ce=n[O];if(ce>255){var ge=ce>>18&31;gr(e,h,te[ge+257]),h+=K[ge+257],ge>7&&(ut(e,h,ce>>23&31),h+=Ss[ge]);var Ce=ce&31;gr(e,h,ie[Ce]),h+=se[Ce],Ce>3&&(gr(e,h,ce>>5&8191),h+=Cs[Ce])}else gr(e,h,te[ce]),h+=K[ce]}return gr(e,h,te[256]),h+K[256]},Lu=new _s([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),to=new $e(0),Bu=function(t,e,r,n,s,i){var a=i.z||t.length,o=new $e(n+a+5*(1+Math.ceil(a/7e3))+s),c=o.subarray(n,o.length-s),f=i.l,h=(i.r||0)&7;if(e){h&&(c[0]=i.r>>3);for(var d=Lu[e-1],m=d>>13,y=d&8191,M=(1<<r)-1,R=i.p||new je(32768),p=i.h||new je(M+1),w=Math.ceil(r/3),g=2*w,x=function(tt){return(t[tt]^t[tt+1]<<w^t[tt+2]<<g)&M},T=new _s(25e3),I=new je(288),b=new je(32),F=0,O=0,C=i.i||0,V=0,L=i.w||0,j=0;C+2<a;++C){var G=x(C),P=C&32767,Y=p[G];if(R[P]=Y,p[G]=P,L<=C){var te=a-C;if((F>7e3||V>24576)&&(te>423||!f)){h=Li(t,c,0,T,I,b,O,V,j,C-j,h),V=F=O=0,j=C;for(var K=0;K<286;++K)I[K]=0;for(var K=0;K<30;++K)b[K]=0}var ie=2,se=0,ae=y,oe=P-Y&32767;if(te>2&&G==x(C-oe))for(var he=Math.min(m,te)-1,Ae=Math.min(32767,C),ge=Math.min(258,te);oe<=Ae&&--ae&&P!=Y;){if(t[C+ie]==t[C+ie-oe]){for(var ce=0;ce<ge&&t[C+ce]==t[C+ce-oe];++ce);if(ce>ie){if(ie=ce,se=oe,ce>he)break;for(var Ce=Math.min(oe,ce-2),He=0,K=0;K<Ce;++K){var dt=C-oe+K&32767,le=R[dt],mt=dt-le&32767;mt>He&&(He=mt,Y=dt)}}}P=Y,Y=R[P],oe+=P-Y&32767}if(se){T[V++]=268435456|ns[ie]<<18|Pi[se];var Fe=ns[ie]&31,ct=Pi[se]&31;O+=Ss[Fe]+Cs[ct],++I[257+Fe],++b[ct],L=C+ie,++F}else T[V++]=t[C],++I[t[C]]}}for(C=Math.max(C,L);C<a;++C)T[V++]=t[C],++I[t[C]];h=Li(t,c,f,T,I,b,O,V,j,C-j,h),f||(i.r=h&7|c[h/8|0]<<3,h-=7,i.h=p,i.p=R,i.i=C,i.w=L)}else{for(var C=i.w||0;C<a+f;C+=65535){var xt=C+65535;xt>=a&&(c[h/8|0]=f,xt=a),h=eo(c,h+1,t.subarray(C,xt))}i.i=a}return Qa(o,0,n+Za(h)+s)},Vu=function(){for(var t=new Int32Array(256),e=0;e<256;++e){for(var r=e,n=9;--n;)r=(r&1&&-306674912)^r>>>1;t[e]=r}return t}(),ju=function(){var t=-1;return{p:function(e){for(var r=t,n=0;n<e.length;++n)r=Vu[r&255^e[n]]^r>>>8;t=r},d:function(){return~t}}},zu=function(t,e,r,n,s){if(!s&&(s={l:1},e.dictionary)){var i=e.dictionary.subarray(-32768),a=new $e(i.length+t.length);a.set(i),a.set(t,i.length),t=a,s.w=i.length}return Bu(t,e.level==null?6:e.level,e.mem==null?s.l?Math.ceil(Math.max(8,Math.min(13,Math.log(t.length)))*1.5):20:12+e.mem,r,n,s)},ro=function(t,e){var r={};for(var n in t)r[n]=t[n];for(var n in e)r[n]=e[n];return r},Oe=function(t,e,r){for(;r;++e)t[e]=r,r>>>=8};function ku(t,e){return zu(t,e||{},0,0)}var no=function(t,e,r,n){for(var s in t){var i=t[s],a=e+s,o=n;Array.isArray(i)&&(o=ro(n,i[1]),i=i[0]),i instanceof $e?r[a]=[i,o]:(r[a+="/"]=[new $e(0),o],no(i,a,r,n))}},Bi=typeof TextEncoder<"u"&&new TextEncoder,Gu=typeof TextDecoder<"u"&&new TextDecoder,qu=0;try{Gu.decode(to,{stream:!0}),qu=1}catch{}function br(t,e){if(e){for(var r=new $e(t.length),n=0;n<t.length;++n)r[n]=t.charCodeAt(n);return r}if(Bi)return Bi.encode(t);for(var s=t.length,i=new $e(t.length+(t.length>>1)),a=0,o=function(h){i[a++]=h},n=0;n<s;++n){if(a+5>i.length){var c=new $e(a+8+(s-n<<1));c.set(i),i=c}var f=t.charCodeAt(n);f<128||e?o(f):f<2048?(o(192|f>>6),o(128|f&63)):f>55295&&f<57344?(f=65536+(f&1047552)|t.charCodeAt(++n)&1023,o(240|f>>18),o(128|f>>12&63),o(128|f>>6&63),o(128|f&63)):(o(224|f>>12),o(128|f>>6&63),o(128|f&63))}return Qa(i,0,a)}var as=function(t){var e=0;if(t)for(var r in t){var n=t[r].length;n>65535&&vn(9),e+=n+4}return e},Vi=function(t,e,r,n,s,i,a,o){var c=n.length,f=r.extra,h=o&&o.length,d=as(f);Oe(t,e,a!=null?33639248:67324752),e+=4,a!=null&&(t[e++]=20,t[e++]=r.os),t[e]=20,e+=2,t[e++]=r.flag<<1|(i<0&&8),t[e++]=s&&8,t[e++]=r.compression&255,t[e++]=r.compression>>8;var m=new Date(r.mtime==null?Date.now():r.mtime),y=m.getFullYear()-1980;if((y<0||y>119)&&vn(10),Oe(t,e,y<<25|m.getMonth()+1<<21|m.getDate()<<16|m.getHours()<<11|m.getMinutes()<<5|m.getSeconds()>>1),e+=4,i!=-1&&(Oe(t,e,r.crc),Oe(t,e+4,i<0?-i-2:i),Oe(t,e+8,r.size)),Oe(t,e+12,c),Oe(t,e+14,d),e+=16,a!=null&&(Oe(t,e,h),Oe(t,e+6,r.attrs),Oe(t,e+10,a),e+=14),t.set(n,e),e+=c,d)for(var M in f){var R=f[M],p=R.length;Oe(t,e,+M),Oe(t,e+2,p),t.set(R,e+4),e+=4+p}return h&&(t.set(o,e),e+=h),e},Hu=function(t,e,r,n,s){Oe(t,e,101010256),Oe(t,e+8,r),Oe(t,e+10,r),Oe(t,e+12,n),Oe(t,e+16,s)};function Wu(t,e){e||(e={});var r={},n=[];no(t,"",r,e);var s=0,i=0;for(var a in r){var o=r[a],c=o[0],f=o[1],h=f.level==0?0:8,d=br(a),m=d.length,y=f.comment,M=y&&br(y),R=M&&M.length,p=as(f.extra);m>65535&&vn(11);var w=h?ku(c,f):c,g=w.length,x=ju();x.p(c),n.push(ro(f,{size:c.length,crc:x.d(),c:w,f:d,m:M,u:m!=a.length||M&&y.length!=R,o:s,compression:h})),s+=30+m+p+g,i+=76+2*(m+p)+(R||0)+g}for(var T=new $e(i+22),I=s,b=i-s,F=0;F<n.length;++F){var d=n[F];Vi(T,d.o,d,d.f,d.u,d.c.length);var O=30+d.f.length+as(d.extra);T.set(d.c,d.o+O),Vi(T,s,d,d.f,d.u,d.c.length,d.o,d.m),s+=16+O+(d.m?d.m.length:0)}return Hu(T,s,n.length,b,I),T}var W=1e-6,ee=typeof Float32Array<"u"?Float32Array:Array,Ze=Math.random;function so(t){ee=t}var Xu=Math.PI/180;function Yu(t){return t*Xu}function Ku(t,e){return Math.abs(t-e)<=W*Math.max(1,Math.abs(t),Math.abs(e))}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var Ju=Object.freeze({__proto__:null,get ARRAY_TYPE(){return ee},EPSILON:W,RANDOM:Ze,equals:Ku,setMatrixArrayType:so,toRadian:Yu});function Zu(){var t=new ee(4);return ee!=Float32Array&&(t[1]=0,t[2]=0),t[0]=1,t[3]=1,t}function Qu(t){var e=new ee(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function eh(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function th(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t}function rh(t,e,r,n){var s=new ee(4);return s[0]=t,s[1]=e,s[2]=r,s[3]=n,s}function nh(t,e,r,n,s){return t[0]=e,t[1]=r,t[2]=n,t[3]=s,t}function sh(t,e){if(t===e){var r=e[1];t[1]=e[2],t[2]=r}else t[0]=e[0],t[1]=e[2],t[2]=e[1],t[3]=e[3];return t}function ih(t,e){var r=e[0],n=e[1],s=e[2],i=e[3],a=r*i-s*n;return a?(a=1/a,t[0]=i*a,t[1]=-n*a,t[2]=-s*a,t[3]=r*a,t):null}function ah(t,e){var r=e[0];return t[0]=e[3],t[1]=-e[1],t[2]=-e[2],t[3]=r,t}function oh(t){return t[0]*t[3]-t[2]*t[1]}function io(t,e,r){var n=e[0],s=e[1],i=e[2],a=e[3],o=r[0],c=r[1],f=r[2],h=r[3];return t[0]=n*o+i*c,t[1]=s*o+a*c,t[2]=n*f+i*h,t[3]=s*f+a*h,t}function ch(t,e,r){var n=e[0],s=e[1],i=e[2],a=e[3],o=Math.sin(r),c=Math.cos(r);return t[0]=n*c+i*o,t[1]=s*c+a*o,t[2]=n*-o+i*c,t[3]=s*-o+a*c,t}function lh(t,e,r){var n=e[0],s=e[1],i=e[2],a=e[3],o=r[0],c=r[1];return t[0]=n*o,t[1]=s*o,t[2]=i*c,t[3]=a*c,t}function fh(t,e){var r=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=r,t[2]=-r,t[3]=n,t}function uh(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t}function hh(t){return"mat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}function ph(t){return Math.hypot(t[0],t[1],t[2],t[3])}function gh(t,e,r,n){return t[2]=n[2]/n[0],r[0]=n[0],r[1]=n[1],r[3]=n[3]-t[2]*r[1],[t,e,r]}function dh(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t}function ao(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t}function mh(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]}function vh(t,e){var r=t[0],n=t[1],s=t[2],i=t[3],a=e[0],o=e[1],c=e[2],f=e[3];return Math.abs(r-a)<=W*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(n-o)<=W*Math.max(1,Math.abs(n),Math.abs(o))&&Math.abs(s-c)<=W*Math.max(1,Math.abs(s),Math.abs(c))&&Math.abs(i-f)<=W*Math.max(1,Math.abs(i),Math.abs(f))}function xh(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t}function yh(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t[2]=e[2]+r[2]*n,t[3]=e[3]+r[3]*n,t}var Th=io,Mh=ao,Eh=Object.freeze({__proto__:null,LDU:gh,add:dh,adjoint:ah,clone:Qu,copy:eh,create:Zu,determinant:oh,equals:vh,exactEquals:mh,frob:ph,fromRotation:fh,fromScaling:uh,fromValues:rh,identity:th,invert:ih,mul:Th,multiply:io,multiplyScalar:xh,multiplyScalarAndAdd:yh,rotate:ch,scale:lh,set:nh,str:hh,sub:Mh,subtract:ao,transpose:sh});function Rh(){var t=new ee(6);return ee!=Float32Array&&(t[1]=0,t[2]=0,t[4]=0,t[5]=0),t[0]=1,t[3]=1,t}function wh(t){var e=new ee(6);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e}function Ih(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t}function Ah(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t}function bh(t,e,r,n,s,i){var a=new ee(6);return a[0]=t,a[1]=e,a[2]=r,a[3]=n,a[4]=s,a[5]=i,a}function _h(t,e,r,n,s,i,a){return t[0]=e,t[1]=r,t[2]=n,t[3]=s,t[4]=i,t[5]=a,t}function Sh(t,e){var r=e[0],n=e[1],s=e[2],i=e[3],a=e[4],o=e[5],c=r*i-n*s;return c?(c=1/c,t[0]=i*c,t[1]=-n*c,t[2]=-s*c,t[3]=r*c,t[4]=(s*o-i*a)*c,t[5]=(n*a-r*o)*c,t):null}function Ch(t){return t[0]*t[3]-t[1]*t[2]}function oo(t,e,r){var n=e[0],s=e[1],i=e[2],a=e[3],o=e[4],c=e[5],f=r[0],h=r[1],d=r[2],m=r[3],y=r[4],M=r[5];return t[0]=n*f+i*h,t[1]=s*f+a*h,t[2]=n*d+i*m,t[3]=s*d+a*m,t[4]=n*y+i*M+o,t[5]=s*y+a*M+c,t}function Nh(t,e,r){var n=e[0],s=e[1],i=e[2],a=e[3],o=e[4],c=e[5],f=Math.sin(r),h=Math.cos(r);return t[0]=n*h+i*f,t[1]=s*h+a*f,t[2]=n*-f+i*h,t[3]=s*-f+a*h,t[4]=o,t[5]=c,t}function Oh(t,e,r){var n=e[0],s=e[1],i=e[2],a=e[3],o=e[4],c=e[5],f=r[0],h=r[1];return t[0]=n*f,t[1]=s*f,t[2]=i*h,t[3]=a*h,t[4]=o,t[5]=c,t}function $h(t,e,r){var n=e[0],s=e[1],i=e[2],a=e[3],o=e[4],c=e[5],f=r[0],h=r[1];return t[0]=n,t[1]=s,t[2]=i,t[3]=a,t[4]=n*f+i*h+o,t[5]=s*f+a*h+c,t}function Fh(t,e){var r=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=r,t[2]=-r,t[3]=n,t[4]=0,t[5]=0,t}function Dh(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t[4]=0,t[5]=0,t}function Ph(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=e[0],t[5]=e[1],t}function Uh(t){return"mat2d("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+")"}function Lh(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],1)}function Bh(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t}function co(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t[4]=e[4]-r[4],t[5]=e[5]-r[5],t}function Vh(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t}function jh(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t[2]=e[2]+r[2]*n,t[3]=e[3]+r[3]*n,t[4]=e[4]+r[4]*n,t[5]=e[5]+r[5]*n,t}function zh(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]}function kh(t,e){var r=t[0],n=t[1],s=t[2],i=t[3],a=t[4],o=t[5],c=e[0],f=e[1],h=e[2],d=e[3],m=e[4],y=e[5];return Math.abs(r-c)<=W*Math.max(1,Math.abs(r),Math.abs(c))&&Math.abs(n-f)<=W*Math.max(1,Math.abs(n),Math.abs(f))&&Math.abs(s-h)<=W*Math.max(1,Math.abs(s),Math.abs(h))&&Math.abs(i-d)<=W*Math.max(1,Math.abs(i),Math.abs(d))&&Math.abs(a-m)<=W*Math.max(1,Math.abs(a),Math.abs(m))&&Math.abs(o-y)<=W*Math.max(1,Math.abs(o),Math.abs(y))}var Gh=oo,qh=co,Hh=Object.freeze({__proto__:null,add:Bh,clone:wh,copy:Ih,create:Rh,determinant:Ch,equals:kh,exactEquals:zh,frob:Lh,fromRotation:Fh,fromScaling:Dh,fromTranslation:Ph,fromValues:bh,identity:Ah,invert:Sh,mul:Gh,multiply:oo,multiplyScalar:Vh,multiplyScalarAndAdd:jh,rotate:Nh,scale:Oh,set:_h,str:Uh,sub:qh,subtract:co,translate:$h});function lo(){var t=new ee(9);return ee!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function Wh(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t}function Xh(t){var e=new ee(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function Yh(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function Kh(t,e,r,n,s,i,a,o,c){var f=new ee(9);return f[0]=t,f[1]=e,f[2]=r,f[3]=n,f[4]=s,f[5]=i,f[6]=a,f[7]=o,f[8]=c,f}function Jh(t,e,r,n,s,i,a,o,c,f){return t[0]=e,t[1]=r,t[2]=n,t[3]=s,t[4]=i,t[5]=a,t[6]=o,t[7]=c,t[8]=f,t}function Zh(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function Qh(t,e){if(t===e){var r=e[1],n=e[2],s=e[5];t[1]=e[3],t[2]=e[6],t[3]=r,t[5]=e[7],t[6]=n,t[7]=s}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t}function ep(t,e){var r=e[0],n=e[1],s=e[2],i=e[3],a=e[4],o=e[5],c=e[6],f=e[7],h=e[8],d=h*a-o*f,m=-h*i+o*c,y=f*i-a*c,M=r*d+n*m+s*y;return M?(M=1/M,t[0]=d*M,t[1]=(-h*n+s*f)*M,t[2]=(o*n-s*a)*M,t[3]=m*M,t[4]=(h*r-s*c)*M,t[5]=(-o*r+s*i)*M,t[6]=y*M,t[7]=(-f*r+n*c)*M,t[8]=(a*r-n*i)*M,t):null}function tp(t,e){var r=e[0],n=e[1],s=e[2],i=e[3],a=e[4],o=e[5],c=e[6],f=e[7],h=e[8];return t[0]=a*h-o*f,t[1]=s*f-n*h,t[2]=n*o-s*a,t[3]=o*c-i*h,t[4]=r*h-s*c,t[5]=s*i-r*o,t[6]=i*f-a*c,t[7]=n*c-r*f,t[8]=r*a-n*i,t}function rp(t){var e=t[0],r=t[1],n=t[2],s=t[3],i=t[4],a=t[5],o=t[6],c=t[7],f=t[8];return e*(f*i-a*c)+r*(-f*s+a*o)+n*(c*s-i*o)}function fo(t,e,r){var n=e[0],s=e[1],i=e[2],a=e[3],o=e[4],c=e[5],f=e[6],h=e[7],d=e[8],m=r[0],y=r[1],M=r[2],R=r[3],p=r[4],w=r[5],g=r[6],x=r[7],T=r[8];return t[0]=m*n+y*a+M*f,t[1]=m*s+y*o+M*h,t[2]=m*i+y*c+M*d,t[3]=R*n+p*a+w*f,t[4]=R*s+p*o+w*h,t[5]=R*i+p*c+w*d,t[6]=g*n+x*a+T*f,t[7]=g*s+x*o+T*h,t[8]=g*i+x*c+T*d,t}function np(t,e,r){var n=e[0],s=e[1],i=e[2],a=e[3],o=e[4],c=e[5],f=e[6],h=e[7],d=e[8],m=r[0],y=r[1];return t[0]=n,t[1]=s,t[2]=i,t[3]=a,t[4]=o,t[5]=c,t[6]=m*n+y*a+f,t[7]=m*s+y*o+h,t[8]=m*i+y*c+d,t}function sp(t,e,r){var n=e[0],s=e[1],i=e[2],a=e[3],o=e[4],c=e[5],f=e[6],h=e[7],d=e[8],m=Math.sin(r),y=Math.cos(r);return t[0]=y*n+m*a,t[1]=y*s+m*o,t[2]=y*i+m*c,t[3]=y*a-m*n,t[4]=y*o-m*s,t[5]=y*c-m*i,t[6]=f,t[7]=h,t[8]=d,t}function ip(t,e,r){var n=r[0],s=r[1];return t[0]=n*e[0],t[1]=n*e[1],t[2]=n*e[2],t[3]=s*e[3],t[4]=s*e[4],t[5]=s*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function ap(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=e[0],t[7]=e[1],t[8]=1,t}function op(t,e){var r=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=r,t[2]=0,t[3]=-r,t[4]=n,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function cp(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=e[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function lp(t,e){return t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=0,t[6]=e[4],t[7]=e[5],t[8]=1,t}function fp(t,e){var r=e[0],n=e[1],s=e[2],i=e[3],a=r+r,o=n+n,c=s+s,f=r*a,h=n*a,d=n*o,m=s*a,y=s*o,M=s*c,R=i*a,p=i*o,w=i*c;return t[0]=1-d-M,t[3]=h-w,t[6]=m+p,t[1]=h+w,t[4]=1-f-M,t[7]=y-R,t[2]=m-p,t[5]=y+R,t[8]=1-f-d,t}function up(t,e){var r=e[0],n=e[1],s=e[2],i=e[3],a=e[4],o=e[5],c=e[6],f=e[7],h=e[8],d=e[9],m=e[10],y=e[11],M=e[12],R=e[13],p=e[14],w=e[15],g=r*o-n*a,x=r*c-s*a,T=r*f-i*a,I=n*c-s*o,b=n*f-i*o,F=s*f-i*c,O=h*R-d*M,C=h*p-m*M,V=h*w-y*M,L=d*p-m*R,j=d*w-y*R,G=m*w-y*p,P=g*G-x*j+T*L+I*V-b*C+F*O;return P?(P=1/P,t[0]=(o*G-c*j+f*L)*P,t[1]=(c*V-a*G-f*C)*P,t[2]=(a*j-o*V+f*O)*P,t[3]=(s*j-n*G-i*L)*P,t[4]=(r*G-s*V+i*C)*P,t[5]=(n*V-r*j-i*O)*P,t[6]=(R*F-p*b+w*I)*P,t[7]=(p*T-M*F-w*x)*P,t[8]=(M*b-R*T+w*g)*P,t):null}function hp(t,e,r){return t[0]=2/e,t[1]=0,t[2]=0,t[3]=0,t[4]=-2/r,t[5]=0,t[6]=-1,t[7]=1,t[8]=1,t}function pp(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"}function gp(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8])}function dp(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t[6]=e[6]+r[6],t[7]=e[7]+r[7],t[8]=e[8]+r[8],t}function uo(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t[4]=e[4]-r[4],t[5]=e[5]-r[5],t[6]=e[6]-r[6],t[7]=e[7]-r[7],t[8]=e[8]-r[8],t}function mp(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*r,t}function vp(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t[2]=e[2]+r[2]*n,t[3]=e[3]+r[3]*n,t[4]=e[4]+r[4]*n,t[5]=e[5]+r[5]*n,t[6]=e[6]+r[6]*n,t[7]=e[7]+r[7]*n,t[8]=e[8]+r[8]*n,t}function xp(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]}function yp(t,e){var r=t[0],n=t[1],s=t[2],i=t[3],a=t[4],o=t[5],c=t[6],f=t[7],h=t[8],d=e[0],m=e[1],y=e[2],M=e[3],R=e[4],p=e[5],w=e[6],g=e[7],x=e[8];return Math.abs(r-d)<=W*Math.max(1,Math.abs(r),Math.abs(d))&&Math.abs(n-m)<=W*Math.max(1,Math.abs(n),Math.abs(m))&&Math.abs(s-y)<=W*Math.max(1,Math.abs(s),Math.abs(y))&&Math.abs(i-M)<=W*Math.max(1,Math.abs(i),Math.abs(M))&&Math.abs(a-R)<=W*Math.max(1,Math.abs(a),Math.abs(R))&&Math.abs(o-p)<=W*Math.max(1,Math.abs(o),Math.abs(p))&&Math.abs(c-w)<=W*Math.max(1,Math.abs(c),Math.abs(w))&&Math.abs(f-g)<=W*Math.max(1,Math.abs(f),Math.abs(g))&&Math.abs(h-x)<=W*Math.max(1,Math.abs(h),Math.abs(x))}var Tp=fo,Mp=uo,Ep=Object.freeze({__proto__:null,add:dp,adjoint:tp,clone:Xh,copy:Yh,create:lo,determinant:rp,equals:yp,exactEquals:xp,frob:gp,fromMat2d:lp,fromMat4:Wh,fromQuat:fp,fromRotation:op,fromScaling:cp,fromTranslation:ap,fromValues:Kh,identity:Zh,invert:ep,mul:Tp,multiply:fo,multiplyScalar:mp,multiplyScalarAndAdd:vp,normalFromMat4:up,projection:hp,rotate:sp,scale:ip,set:Jh,str:pp,sub:Mp,subtract:uo,translate:np,transpose:Qh});function Rp(){var t=new ee(16);return ee!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function wp(t){var e=new ee(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function Ip(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function Ap(t,e,r,n,s,i,a,o,c,f,h,d,m,y,M,R){var p=new ee(16);return p[0]=t,p[1]=e,p[2]=r,p[3]=n,p[4]=s,p[5]=i,p[6]=a,p[7]=o,p[8]=c,p[9]=f,p[10]=h,p[11]=d,p[12]=m,p[13]=y,p[14]=M,p[15]=R,p}function bp(t,e,r,n,s,i,a,o,c,f,h,d,m,y,M,R,p){return t[0]=e,t[1]=r,t[2]=n,t[3]=s,t[4]=i,t[5]=a,t[6]=o,t[7]=c,t[8]=f,t[9]=h,t[10]=d,t[11]=m,t[12]=y,t[13]=M,t[14]=R,t[15]=p,t}function ho(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function _p(t,e){if(t===e){var r=e[1],n=e[2],s=e[3],i=e[6],a=e[7],o=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=r,t[6]=e[9],t[7]=e[13],t[8]=n,t[9]=i,t[11]=e[14],t[12]=s,t[13]=a,t[14]=o}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function Sp(t,e){var r=e[0],n=e[1],s=e[2],i=e[3],a=e[4],o=e[5],c=e[6],f=e[7],h=e[8],d=e[9],m=e[10],y=e[11],M=e[12],R=e[13],p=e[14],w=e[15],g=r*o-n*a,x=r*c-s*a,T=r*f-i*a,I=n*c-s*o,b=n*f-i*o,F=s*f-i*c,O=h*R-d*M,C=h*p-m*M,V=h*w-y*M,L=d*p-m*R,j=d*w-y*R,G=m*w-y*p,P=g*G-x*j+T*L+I*V-b*C+F*O;return P?(P=1/P,t[0]=(o*G-c*j+f*L)*P,t[1]=(s*j-n*G-i*L)*P,t[2]=(R*F-p*b+w*I)*P,t[3]=(m*b-d*F-y*I)*P,t[4]=(c*V-a*G-f*C)*P,t[5]=(r*G-s*V+i*C)*P,t[6]=(p*T-M*F-w*x)*P,t[7]=(h*F-m*T+y*x)*P,t[8]=(a*j-o*V+f*O)*P,t[9]=(n*V-r*j-i*O)*P,t[10]=(M*b-R*T+w*g)*P,t[11]=(d*T-h*b-y*g)*P,t[12]=(o*C-a*L-c*O)*P,t[13]=(r*L-n*C+s*O)*P,t[14]=(R*x-M*I-p*g)*P,t[15]=(h*I-d*x+m*g)*P,t):null}function Cp(t,e){var r=e[0],n=e[1],s=e[2],i=e[3],a=e[4],o=e[5],c=e[6],f=e[7],h=e[8],d=e[9],m=e[10],y=e[11],M=e[12],R=e[13],p=e[14],w=e[15];return t[0]=o*(m*w-y*p)-d*(c*w-f*p)+R*(c*y-f*m),t[1]=-(n*(m*w-y*p)-d*(s*w-i*p)+R*(s*y-i*m)),t[2]=n*(c*w-f*p)-o*(s*w-i*p)+R*(s*f-i*c),t[3]=-(n*(c*y-f*m)-o*(s*y-i*m)+d*(s*f-i*c)),t[4]=-(a*(m*w-y*p)-h*(c*w-f*p)+M*(c*y-f*m)),t[5]=r*(m*w-y*p)-h*(s*w-i*p)+M*(s*y-i*m),t[6]=-(r*(c*w-f*p)-a*(s*w-i*p)+M*(s*f-i*c)),t[7]=r*(c*y-f*m)-a*(s*y-i*m)+h*(s*f-i*c),t[8]=a*(d*w-y*R)-h*(o*w-f*R)+M*(o*y-f*d),t[9]=-(r*(d*w-y*R)-h*(n*w-i*R)+M*(n*y-i*d)),t[10]=r*(o*w-f*R)-a*(n*w-i*R)+M*(n*f-i*o),t[11]=-(r*(o*y-f*d)-a*(n*y-i*d)+h*(n*f-i*o)),t[12]=-(a*(d*p-m*R)-h*(o*p-c*R)+M*(o*m-c*d)),t[13]=r*(d*p-m*R)-h*(n*p-s*R)+M*(n*m-s*d),t[14]=-(r*(o*p-c*R)-a*(n*p-s*R)+M*(n*c-s*o)),t[15]=r*(o*m-c*d)-a*(n*m-s*d)+h*(n*c-s*o),t}function Np(t){var e=t[0],r=t[1],n=t[2],s=t[3],i=t[4],a=t[5],o=t[6],c=t[7],f=t[8],h=t[9],d=t[10],m=t[11],y=t[12],M=t[13],R=t[14],p=t[15],w=e*a-r*i,g=e*o-n*i,x=e*c-s*i,T=r*o-n*a,I=r*c-s*a,b=n*c-s*o,F=f*M-h*y,O=f*R-d*y,C=f*p-m*y,V=h*R-d*M,L=h*p-m*M,j=d*p-m*R;return w*j-g*L+x*V+T*C-I*O+b*F}function po(t,e,r){var n=e[0],s=e[1],i=e[2],a=e[3],o=e[4],c=e[5],f=e[6],h=e[7],d=e[8],m=e[9],y=e[10],M=e[11],R=e[12],p=e[13],w=e[14],g=e[15],x=r[0],T=r[1],I=r[2],b=r[3];return t[0]=x*n+T*o+I*d+b*R,t[1]=x*s+T*c+I*m+b*p,t[2]=x*i+T*f+I*y+b*w,t[3]=x*a+T*h+I*M+b*g,x=r[4],T=r[5],I=r[6],b=r[7],t[4]=x*n+T*o+I*d+b*R,t[5]=x*s+T*c+I*m+b*p,t[6]=x*i+T*f+I*y+b*w,t[7]=x*a+T*h+I*M+b*g,x=r[8],T=r[9],I=r[10],b=r[11],t[8]=x*n+T*o+I*d+b*R,t[9]=x*s+T*c+I*m+b*p,t[10]=x*i+T*f+I*y+b*w,t[11]=x*a+T*h+I*M+b*g,x=r[12],T=r[13],I=r[14],b=r[15],t[12]=x*n+T*o+I*d+b*R,t[13]=x*s+T*c+I*m+b*p,t[14]=x*i+T*f+I*y+b*w,t[15]=x*a+T*h+I*M+b*g,t}function Op(t,e,r){var n=r[0],s=r[1],i=r[2],a,o,c,f,h,d,m,y,M,R,p,w;return e===t?(t[12]=e[0]*n+e[4]*s+e[8]*i+e[12],t[13]=e[1]*n+e[5]*s+e[9]*i+e[13],t[14]=e[2]*n+e[6]*s+e[10]*i+e[14],t[15]=e[3]*n+e[7]*s+e[11]*i+e[15]):(a=e[0],o=e[1],c=e[2],f=e[3],h=e[4],d=e[5],m=e[6],y=e[7],M=e[8],R=e[9],p=e[10],w=e[11],t[0]=a,t[1]=o,t[2]=c,t[3]=f,t[4]=h,t[5]=d,t[6]=m,t[7]=y,t[8]=M,t[9]=R,t[10]=p,t[11]=w,t[12]=a*n+h*s+M*i+e[12],t[13]=o*n+d*s+R*i+e[13],t[14]=c*n+m*s+p*i+e[14],t[15]=f*n+y*s+w*i+e[15]),t}function $p(t,e,r){var n=r[0],s=r[1],i=r[2];return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*s,t[5]=e[5]*s,t[6]=e[6]*s,t[7]=e[7]*s,t[8]=e[8]*i,t[9]=e[9]*i,t[10]=e[10]*i,t[11]=e[11]*i,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function Fp(t,e,r,n){var s=n[0],i=n[1],a=n[2],o=Math.hypot(s,i,a),c,f,h,d,m,y,M,R,p,w,g,x,T,I,b,F,O,C,V,L,j,G,P,Y;return o<W?null:(o=1/o,s*=o,i*=o,a*=o,c=Math.sin(r),f=Math.cos(r),h=1-f,d=e[0],m=e[1],y=e[2],M=e[3],R=e[4],p=e[5],w=e[6],g=e[7],x=e[8],T=e[9],I=e[10],b=e[11],F=s*s*h+f,O=i*s*h+a*c,C=a*s*h-i*c,V=s*i*h-a*c,L=i*i*h+f,j=a*i*h+s*c,G=s*a*h+i*c,P=i*a*h-s*c,Y=a*a*h+f,t[0]=d*F+R*O+x*C,t[1]=m*F+p*O+T*C,t[2]=y*F+w*O+I*C,t[3]=M*F+g*O+b*C,t[4]=d*V+R*L+x*j,t[5]=m*V+p*L+T*j,t[6]=y*V+w*L+I*j,t[7]=M*V+g*L+b*j,t[8]=d*G+R*P+x*Y,t[9]=m*G+p*P+T*Y,t[10]=y*G+w*P+I*Y,t[11]=M*G+g*P+b*Y,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function Dp(t,e,r){var n=Math.sin(r),s=Math.cos(r),i=e[4],a=e[5],o=e[6],c=e[7],f=e[8],h=e[9],d=e[10],m=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=i*s+f*n,t[5]=a*s+h*n,t[6]=o*s+d*n,t[7]=c*s+m*n,t[8]=f*s-i*n,t[9]=h*s-a*n,t[10]=d*s-o*n,t[11]=m*s-c*n,t}function Pp(t,e,r){var n=Math.sin(r),s=Math.cos(r),i=e[0],a=e[1],o=e[2],c=e[3],f=e[8],h=e[9],d=e[10],m=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=i*s-f*n,t[1]=a*s-h*n,t[2]=o*s-d*n,t[3]=c*s-m*n,t[8]=i*n+f*s,t[9]=a*n+h*s,t[10]=o*n+d*s,t[11]=c*n+m*s,t}function Up(t,e,r){var n=Math.sin(r),s=Math.cos(r),i=e[0],a=e[1],o=e[2],c=e[3],f=e[4],h=e[5],d=e[6],m=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=i*s+f*n,t[1]=a*s+h*n,t[2]=o*s+d*n,t[3]=c*s+m*n,t[4]=f*s-i*n,t[5]=h*s-a*n,t[6]=d*s-o*n,t[7]=m*s-c*n,t}function Lp(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t}function Bp(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Vp(t,e,r){var n=r[0],s=r[1],i=r[2],a=Math.hypot(n,s,i),o,c,f;return a<W?null:(a=1/a,n*=a,s*=a,i*=a,o=Math.sin(e),c=Math.cos(e),f=1-c,t[0]=n*n*f+c,t[1]=s*n*f+i*o,t[2]=i*n*f-s*o,t[3]=0,t[4]=n*s*f-i*o,t[5]=s*s*f+c,t[6]=i*s*f+n*o,t[7]=0,t[8]=n*i*f+s*o,t[9]=s*i*f-n*o,t[10]=i*i*f+c,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)}function jp(t,e){var r=Math.sin(e),n=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=n,t[6]=r,t[7]=0,t[8]=0,t[9]=-r,t[10]=n,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function zp(t,e){var r=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=0,t[2]=-r,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=r,t[9]=0,t[10]=n,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function kp(t,e){var r=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=r,t[2]=0,t[3]=0,t[4]=-r,t[5]=n,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function go(t,e,r){var n=e[0],s=e[1],i=e[2],a=e[3],o=n+n,c=s+s,f=i+i,h=n*o,d=n*c,m=n*f,y=s*c,M=s*f,R=i*f,p=a*o,w=a*c,g=a*f;return t[0]=1-(y+R),t[1]=d+g,t[2]=m-w,t[3]=0,t[4]=d-g,t[5]=1-(h+R),t[6]=M+p,t[7]=0,t[8]=m+w,t[9]=M-p,t[10]=1-(h+y),t[11]=0,t[12]=r[0],t[13]=r[1],t[14]=r[2],t[15]=1,t}function Gp(t,e){var r=new ee(3),n=-e[0],s=-e[1],i=-e[2],a=e[3],o=e[4],c=e[5],f=e[6],h=e[7],d=n*n+s*s+i*i+a*a;return d>0?(r[0]=(o*a+h*n+c*i-f*s)*2/d,r[1]=(c*a+h*s+f*n-o*i)*2/d,r[2]=(f*a+h*i+o*s-c*n)*2/d):(r[0]=(o*a+h*n+c*i-f*s)*2,r[1]=(c*a+h*s+f*n-o*i)*2,r[2]=(f*a+h*i+o*s-c*n)*2),go(t,e,r),t}function mo(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t}function vo(t,e){var r=e[0],n=e[1],s=e[2],i=e[4],a=e[5],o=e[6],c=e[8],f=e[9],h=e[10];return t[0]=Math.hypot(r,n,s),t[1]=Math.hypot(i,a,o),t[2]=Math.hypot(c,f,h),t}function xo(t,e){var r=new ee(3);vo(r,e);var n=1/r[0],s=1/r[1],i=1/r[2],a=e[0]*n,o=e[1]*s,c=e[2]*i,f=e[4]*n,h=e[5]*s,d=e[6]*i,m=e[8]*n,y=e[9]*s,M=e[10]*i,R=a+h+M,p=0;return R>0?(p=Math.sqrt(R+1)*2,t[3]=.25*p,t[0]=(d-y)/p,t[1]=(m-c)/p,t[2]=(o-f)/p):a>h&&a>M?(p=Math.sqrt(1+a-h-M)*2,t[3]=(d-y)/p,t[0]=.25*p,t[1]=(o+f)/p,t[2]=(m+c)/p):h>M?(p=Math.sqrt(1+h-a-M)*2,t[3]=(m-c)/p,t[0]=(o+f)/p,t[1]=.25*p,t[2]=(d+y)/p):(p=Math.sqrt(1+M-a-h)*2,t[3]=(o-f)/p,t[0]=(m+c)/p,t[1]=(d+y)/p,t[2]=.25*p),t}function qp(t,e,r,n){var s=e[0],i=e[1],a=e[2],o=e[3],c=s+s,f=i+i,h=a+a,d=s*c,m=s*f,y=s*h,M=i*f,R=i*h,p=a*h,w=o*c,g=o*f,x=o*h,T=n[0],I=n[1],b=n[2];return t[0]=(1-(M+p))*T,t[1]=(m+x)*T,t[2]=(y-g)*T,t[3]=0,t[4]=(m-x)*I,t[5]=(1-(d+p))*I,t[6]=(R+w)*I,t[7]=0,t[8]=(y+g)*b,t[9]=(R-w)*b,t[10]=(1-(d+M))*b,t[11]=0,t[12]=r[0],t[13]=r[1],t[14]=r[2],t[15]=1,t}function Hp(t,e,r,n,s){var i=e[0],a=e[1],o=e[2],c=e[3],f=i+i,h=a+a,d=o+o,m=i*f,y=i*h,M=i*d,R=a*h,p=a*d,w=o*d,g=c*f,x=c*h,T=c*d,I=n[0],b=n[1],F=n[2],O=s[0],C=s[1],V=s[2],L=(1-(R+w))*I,j=(y+T)*I,G=(M-x)*I,P=(y-T)*b,Y=(1-(m+w))*b,te=(p+g)*b,K=(M+x)*F,ie=(p-g)*F,se=(1-(m+R))*F;return t[0]=L,t[1]=j,t[2]=G,t[3]=0,t[4]=P,t[5]=Y,t[6]=te,t[7]=0,t[8]=K,t[9]=ie,t[10]=se,t[11]=0,t[12]=r[0]+O-(L*O+P*C+K*V),t[13]=r[1]+C-(j*O+Y*C+ie*V),t[14]=r[2]+V-(G*O+te*C+se*V),t[15]=1,t}function Wp(t,e){var r=e[0],n=e[1],s=e[2],i=e[3],a=r+r,o=n+n,c=s+s,f=r*a,h=n*a,d=n*o,m=s*a,y=s*o,M=s*c,R=i*a,p=i*o,w=i*c;return t[0]=1-d-M,t[1]=h+w,t[2]=m-p,t[3]=0,t[4]=h-w,t[5]=1-f-M,t[6]=y+R,t[7]=0,t[8]=m+p,t[9]=y-R,t[10]=1-f-d,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Xp(t,e,r,n,s,i,a){var o=1/(r-e),c=1/(s-n),f=1/(i-a);return t[0]=i*2*o,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=i*2*c,t[6]=0,t[7]=0,t[8]=(r+e)*o,t[9]=(s+n)*c,t[10]=(a+i)*f,t[11]=-1,t[12]=0,t[13]=0,t[14]=a*i*2*f,t[15]=0,t}function yo(t,e,r,n,s){var i=1/Math.tan(e/2),a;return t[0]=i/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=i,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,s!=null&&s!==1/0?(a=1/(n-s),t[10]=(s+n)*a,t[14]=2*s*n*a):(t[10]=-1,t[14]=-2*n),t}var Yp=yo;function Kp(t,e,r,n,s){var i=1/Math.tan(e/2),a;return t[0]=i/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=i,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,s!=null&&s!==1/0?(a=1/(n-s),t[10]=s*a,t[14]=s*n*a):(t[10]=-1,t[14]=-n),t}function Jp(t,e,r,n){var s=Math.tan(e.upDegrees*Math.PI/180),i=Math.tan(e.downDegrees*Math.PI/180),a=Math.tan(e.leftDegrees*Math.PI/180),o=Math.tan(e.rightDegrees*Math.PI/180),c=2/(a+o),f=2/(s+i);return t[0]=c,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=f,t[6]=0,t[7]=0,t[8]=-((a-o)*c*.5),t[9]=(s-i)*f*.5,t[10]=n/(r-n),t[11]=-1,t[12]=0,t[13]=0,t[14]=n*r/(r-n),t[15]=0,t}function To(t,e,r,n,s,i,a){var o=1/(e-r),c=1/(n-s),f=1/(i-a);return t[0]=-2*o,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*c,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*f,t[11]=0,t[12]=(e+r)*o,t[13]=(s+n)*c,t[14]=(a+i)*f,t[15]=1,t}var Zp=To;function Qp(t,e,r,n,s,i,a){var o=1/(e-r),c=1/(n-s),f=1/(i-a);return t[0]=-2*o,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*c,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=f,t[11]=0,t[12]=(e+r)*o,t[13]=(s+n)*c,t[14]=i*f,t[15]=1,t}function e1(t,e,r,n){var s,i,a,o,c,f,h,d,m,y,M=e[0],R=e[1],p=e[2],w=n[0],g=n[1],x=n[2],T=r[0],I=r[1],b=r[2];return Math.abs(M-T)<W&&Math.abs(R-I)<W&&Math.abs(p-b)<W?ho(t):(h=M-T,d=R-I,m=p-b,y=1/Math.hypot(h,d,m),h*=y,d*=y,m*=y,s=g*m-x*d,i=x*h-w*m,a=w*d-g*h,y=Math.hypot(s,i,a),y?(y=1/y,s*=y,i*=y,a*=y):(s=0,i=0,a=0),o=d*a-m*i,c=m*s-h*a,f=h*i-d*s,y=Math.hypot(o,c,f),y?(y=1/y,o*=y,c*=y,f*=y):(o=0,c=0,f=0),t[0]=s,t[1]=o,t[2]=h,t[3]=0,t[4]=i,t[5]=c,t[6]=d,t[7]=0,t[8]=a,t[9]=f,t[10]=m,t[11]=0,t[12]=-(s*M+i*R+a*p),t[13]=-(o*M+c*R+f*p),t[14]=-(h*M+d*R+m*p),t[15]=1,t)}function t1(t,e,r,n){var s=e[0],i=e[1],a=e[2],o=n[0],c=n[1],f=n[2],h=s-r[0],d=i-r[1],m=a-r[2],y=h*h+d*d+m*m;y>0&&(y=1/Math.sqrt(y),h*=y,d*=y,m*=y);var M=c*m-f*d,R=f*h-o*m,p=o*d-c*h;return y=M*M+R*R+p*p,y>0&&(y=1/Math.sqrt(y),M*=y,R*=y,p*=y),t[0]=M,t[1]=R,t[2]=p,t[3]=0,t[4]=d*p-m*R,t[5]=m*M-h*p,t[6]=h*R-d*M,t[7]=0,t[8]=h,t[9]=d,t[10]=m,t[11]=0,t[12]=s,t[13]=i,t[14]=a,t[15]=1,t}function r1(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"}function n1(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15])}function s1(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t[6]=e[6]+r[6],t[7]=e[7]+r[7],t[8]=e[8]+r[8],t[9]=e[9]+r[9],t[10]=e[10]+r[10],t[11]=e[11]+r[11],t[12]=e[12]+r[12],t[13]=e[13]+r[13],t[14]=e[14]+r[14],t[15]=e[15]+r[15],t}function Mo(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t[4]=e[4]-r[4],t[5]=e[5]-r[5],t[6]=e[6]-r[6],t[7]=e[7]-r[7],t[8]=e[8]-r[8],t[9]=e[9]-r[9],t[10]=e[10]-r[10],t[11]=e[11]-r[11],t[12]=e[12]-r[12],t[13]=e[13]-r[13],t[14]=e[14]-r[14],t[15]=e[15]-r[15],t}function i1(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*r,t[9]=e[9]*r,t[10]=e[10]*r,t[11]=e[11]*r,t[12]=e[12]*r,t[13]=e[13]*r,t[14]=e[14]*r,t[15]=e[15]*r,t}function a1(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t[2]=e[2]+r[2]*n,t[3]=e[3]+r[3]*n,t[4]=e[4]+r[4]*n,t[5]=e[5]+r[5]*n,t[6]=e[6]+r[6]*n,t[7]=e[7]+r[7]*n,t[8]=e[8]+r[8]*n,t[9]=e[9]+r[9]*n,t[10]=e[10]+r[10]*n,t[11]=e[11]+r[11]*n,t[12]=e[12]+r[12]*n,t[13]=e[13]+r[13]*n,t[14]=e[14]+r[14]*n,t[15]=e[15]+r[15]*n,t}function o1(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]}function c1(t,e){var r=t[0],n=t[1],s=t[2],i=t[3],a=t[4],o=t[5],c=t[6],f=t[7],h=t[8],d=t[9],m=t[10],y=t[11],M=t[12],R=t[13],p=t[14],w=t[15],g=e[0],x=e[1],T=e[2],I=e[3],b=e[4],F=e[5],O=e[6],C=e[7],V=e[8],L=e[9],j=e[10],G=e[11],P=e[12],Y=e[13],te=e[14],K=e[15];return Math.abs(r-g)<=W*Math.max(1,Math.abs(r),Math.abs(g))&&Math.abs(n-x)<=W*Math.max(1,Math.abs(n),Math.abs(x))&&Math.abs(s-T)<=W*Math.max(1,Math.abs(s),Math.abs(T))&&Math.abs(i-I)<=W*Math.max(1,Math.abs(i),Math.abs(I))&&Math.abs(a-b)<=W*Math.max(1,Math.abs(a),Math.abs(b))&&Math.abs(o-F)<=W*Math.max(1,Math.abs(o),Math.abs(F))&&Math.abs(c-O)<=W*Math.max(1,Math.abs(c),Math.abs(O))&&Math.abs(f-C)<=W*Math.max(1,Math.abs(f),Math.abs(C))&&Math.abs(h-V)<=W*Math.max(1,Math.abs(h),Math.abs(V))&&Math.abs(d-L)<=W*Math.max(1,Math.abs(d),Math.abs(L))&&Math.abs(m-j)<=W*Math.max(1,Math.abs(m),Math.abs(j))&&Math.abs(y-G)<=W*Math.max(1,Math.abs(y),Math.abs(G))&&Math.abs(M-P)<=W*Math.max(1,Math.abs(M),Math.abs(P))&&Math.abs(R-Y)<=W*Math.max(1,Math.abs(R),Math.abs(Y))&&Math.abs(p-te)<=W*Math.max(1,Math.abs(p),Math.abs(te))&&Math.abs(w-K)<=W*Math.max(1,Math.abs(w),Math.abs(K))}var l1=po,f1=Mo,u1=Object.freeze({__proto__:null,add:s1,adjoint:Cp,clone:wp,copy:Ip,create:Rp,determinant:Np,equals:c1,exactEquals:o1,frob:n1,fromQuat:Wp,fromQuat2:Gp,fromRotation:Vp,fromRotationTranslation:go,fromRotationTranslationScale:qp,fromRotationTranslationScaleOrigin:Hp,fromScaling:Bp,fromTranslation:Lp,fromValues:Ap,fromXRotation:jp,fromYRotation:zp,fromZRotation:kp,frustum:Xp,getRotation:xo,getScaling:vo,getTranslation:mo,identity:ho,invert:Sp,lookAt:e1,mul:l1,multiply:po,multiplyScalar:i1,multiplyScalarAndAdd:a1,ortho:Zp,orthoNO:To,orthoZO:Qp,perspective:Yp,perspectiveFromFieldOfView:Jp,perspectiveNO:yo,perspectiveZO:Kp,rotate:Fp,rotateX:Dp,rotateY:Pp,rotateZ:Up,scale:$p,set:bp,str:r1,sub:f1,subtract:Mo,targetTo:t1,translate:Op,transpose:_p});function Ns(){var t=new ee(3);return ee!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function h1(t){var e=new ee(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function Eo(t){var e=t[0],r=t[1],n=t[2];return Math.hypot(e,r,n)}function os(t,e,r){var n=new ee(3);return n[0]=t,n[1]=e,n[2]=r,n}function p1(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function g1(t,e,r,n){return t[0]=e,t[1]=r,t[2]=n,t}function d1(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t}function Ro(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t}function wo(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t[2]=e[2]*r[2],t}function Io(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t[2]=e[2]/r[2],t}function m1(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t}function v1(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t}function x1(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t[2]=Math.min(e[2],r[2]),t}function y1(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t[2]=Math.max(e[2],r[2]),t}function T1(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t}function M1(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t}function E1(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t[2]=e[2]+r[2]*n,t}function Ao(t,e){var r=e[0]-t[0],n=e[1]-t[1],s=e[2]-t[2];return Math.hypot(r,n,s)}function bo(t,e){var r=e[0]-t[0],n=e[1]-t[1],s=e[2]-t[2];return r*r+n*n+s*s}function _o(t){var e=t[0],r=t[1],n=t[2];return e*e+r*r+n*n}function R1(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function w1(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t}function So(t,e){var r=e[0],n=e[1],s=e[2],i=r*r+n*n+s*s;return i>0&&(i=1/Math.sqrt(i)),t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t}function Os(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function Qr(t,e,r){var n=e[0],s=e[1],i=e[2],a=r[0],o=r[1],c=r[2];return t[0]=s*c-i*o,t[1]=i*a-n*c,t[2]=n*o-s*a,t}function I1(t,e,r,n){var s=e[0],i=e[1],a=e[2];return t[0]=s+n*(r[0]-s),t[1]=i+n*(r[1]-i),t[2]=a+n*(r[2]-a),t}function A1(t,e,r,n,s,i){var a=i*i,o=a*(2*i-3)+1,c=a*(i-2)+i,f=a*(i-1),h=a*(3-2*i);return t[0]=e[0]*o+r[0]*c+n[0]*f+s[0]*h,t[1]=e[1]*o+r[1]*c+n[1]*f+s[1]*h,t[2]=e[2]*o+r[2]*c+n[2]*f+s[2]*h,t}function b1(t,e,r,n,s,i){var a=1-i,o=a*a,c=i*i,f=o*a,h=3*i*o,d=3*c*a,m=c*i;return t[0]=e[0]*f+r[0]*h+n[0]*d+s[0]*m,t[1]=e[1]*f+r[1]*h+n[1]*d+s[1]*m,t[2]=e[2]*f+r[2]*h+n[2]*d+s[2]*m,t}function _1(t,e){e=e||1;var r=Ze()*2*Math.PI,n=Ze()*2-1,s=Math.sqrt(1-n*n)*e;return t[0]=Math.cos(r)*s,t[1]=Math.sin(r)*s,t[2]=n*e,t}function S1(t,e,r){var n=e[0],s=e[1],i=e[2],a=r[3]*n+r[7]*s+r[11]*i+r[15];return a=a||1,t[0]=(r[0]*n+r[4]*s+r[8]*i+r[12])/a,t[1]=(r[1]*n+r[5]*s+r[9]*i+r[13])/a,t[2]=(r[2]*n+r[6]*s+r[10]*i+r[14])/a,t}function C1(t,e,r){var n=e[0],s=e[1],i=e[2];return t[0]=n*r[0]+s*r[3]+i*r[6],t[1]=n*r[1]+s*r[4]+i*r[7],t[2]=n*r[2]+s*r[5]+i*r[8],t}function N1(t,e,r){var n=r[0],s=r[1],i=r[2],a=r[3],o=e[0],c=e[1],f=e[2],h=s*f-i*c,d=i*o-n*f,m=n*c-s*o,y=s*m-i*d,M=i*h-n*m,R=n*d-s*h,p=a*2;return h*=p,d*=p,m*=p,y*=2,M*=2,R*=2,t[0]=o+h+y,t[1]=c+d+M,t[2]=f+m+R,t}function O1(t,e,r,n){var s=[],i=[];return s[0]=e[0]-r[0],s[1]=e[1]-r[1],s[2]=e[2]-r[2],i[0]=s[0],i[1]=s[1]*Math.cos(n)-s[2]*Math.sin(n),i[2]=s[1]*Math.sin(n)+s[2]*Math.cos(n),t[0]=i[0]+r[0],t[1]=i[1]+r[1],t[2]=i[2]+r[2],t}function $1(t,e,r,n){var s=[],i=[];return s[0]=e[0]-r[0],s[1]=e[1]-r[1],s[2]=e[2]-r[2],i[0]=s[2]*Math.sin(n)+s[0]*Math.cos(n),i[1]=s[1],i[2]=s[2]*Math.cos(n)-s[0]*Math.sin(n),t[0]=i[0]+r[0],t[1]=i[1]+r[1],t[2]=i[2]+r[2],t}function F1(t,e,r,n){var s=[],i=[];return s[0]=e[0]-r[0],s[1]=e[1]-r[1],s[2]=e[2]-r[2],i[0]=s[0]*Math.cos(n)-s[1]*Math.sin(n),i[1]=s[0]*Math.sin(n)+s[1]*Math.cos(n),i[2]=s[2],t[0]=i[0]+r[0],t[1]=i[1]+r[1],t[2]=i[2]+r[2],t}function D1(t,e){var r=t[0],n=t[1],s=t[2],i=e[0],a=e[1],o=e[2],c=Math.sqrt(r*r+n*n+s*s),f=Math.sqrt(i*i+a*a+o*o),h=c*f,d=h&&Os(t,e)/h;return Math.acos(Math.min(Math.max(d,-1),1))}function P1(t){return t[0]=0,t[1]=0,t[2]=0,t}function U1(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"}function L1(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}function B1(t,e){var r=t[0],n=t[1],s=t[2],i=e[0],a=e[1],o=e[2];return Math.abs(r-i)<=W*Math.max(1,Math.abs(r),Math.abs(i))&&Math.abs(n-a)<=W*Math.max(1,Math.abs(n),Math.abs(a))&&Math.abs(s-o)<=W*Math.max(1,Math.abs(s),Math.abs(o))}var V1=Ro,j1=wo,z1=Io,k1=Ao,G1=bo,Co=Eo,q1=_o,H1=function(){var t=Ns();return function(e,r,n,s,i,a){var o,c;for(r||(r=3),n||(n=0),s?c=Math.min(s*r+n,e.length):c=e.length,o=n;o<c;o+=r)t[0]=e[o],t[1]=e[o+1],t[2]=e[o+2],i(t,t,a),e[o]=t[0],e[o+1]=t[1],e[o+2]=t[2];return e}}(),W1=Object.freeze({__proto__:null,add:d1,angle:D1,bezier:b1,ceil:m1,clone:h1,copy:p1,create:Ns,cross:Qr,dist:k1,distance:Ao,div:z1,divide:Io,dot:Os,equals:B1,exactEquals:L1,floor:v1,forEach:H1,fromValues:os,hermite:A1,inverse:w1,len:Co,length:Eo,lerp:I1,max:y1,min:x1,mul:j1,multiply:wo,negate:R1,normalize:So,random:_1,rotateX:O1,rotateY:$1,rotateZ:F1,round:T1,scale:M1,scaleAndAdd:E1,set:g1,sqrDist:G1,sqrLen:q1,squaredDistance:bo,squaredLength:_o,str:U1,sub:V1,subtract:Ro,transformMat3:C1,transformMat4:S1,transformQuat:N1,zero:P1});function No(){var t=new ee(4);return ee!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function Oo(t){var e=new ee(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function $o(t,e,r,n){var s=new ee(4);return s[0]=t,s[1]=e,s[2]=r,s[3]=n,s}function Fo(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function Do(t,e,r,n,s){return t[0]=e,t[1]=r,t[2]=n,t[3]=s,t}function Po(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t}function Uo(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t}function Lo(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t[2]=e[2]*r[2],t[3]=e[3]*r[3],t}function Bo(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t[2]=e[2]/r[2],t[3]=e[3]/r[3],t}function X1(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t[3]=Math.ceil(e[3]),t}function Y1(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t[3]=Math.floor(e[3]),t}function K1(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t[2]=Math.min(e[2],r[2]),t[3]=Math.min(e[3],r[3]),t}function J1(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t[2]=Math.max(e[2],r[2]),t[3]=Math.max(e[3],r[3]),t}function Z1(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t[3]=Math.round(e[3]),t}function Vo(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t}function Q1(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t[2]=e[2]+r[2]*n,t[3]=e[3]+r[3]*n,t}function jo(t,e){var r=e[0]-t[0],n=e[1]-t[1],s=e[2]-t[2],i=e[3]-t[3];return Math.hypot(r,n,s,i)}function zo(t,e){var r=e[0]-t[0],n=e[1]-t[1],s=e[2]-t[2],i=e[3]-t[3];return r*r+n*n+s*s+i*i}function $s(t){var e=t[0],r=t[1],n=t[2],s=t[3];return Math.hypot(e,r,n,s)}function Fs(t){var e=t[0],r=t[1],n=t[2],s=t[3];return e*e+r*r+n*n+s*s}function eg(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t}function tg(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t[3]=1/e[3],t}function ko(t,e){var r=e[0],n=e[1],s=e[2],i=e[3],a=r*r+n*n+s*s+i*i;return a>0&&(a=1/Math.sqrt(a)),t[0]=r*a,t[1]=n*a,t[2]=s*a,t[3]=i*a,t}function Go(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]}function rg(t,e,r,n){var s=r[0]*n[1]-r[1]*n[0],i=r[0]*n[2]-r[2]*n[0],a=r[0]*n[3]-r[3]*n[0],o=r[1]*n[2]-r[2]*n[1],c=r[1]*n[3]-r[3]*n[1],f=r[2]*n[3]-r[3]*n[2],h=e[0],d=e[1],m=e[2],y=e[3];return t[0]=d*f-m*c+y*o,t[1]=-(h*f)+m*a-y*i,t[2]=h*c-d*a+y*s,t[3]=-(h*o)+d*i-m*s,t}function qo(t,e,r,n){var s=e[0],i=e[1],a=e[2],o=e[3];return t[0]=s+n*(r[0]-s),t[1]=i+n*(r[1]-i),t[2]=a+n*(r[2]-a),t[3]=o+n*(r[3]-o),t}function ng(t,e){e=e||1;var r,n,s,i,a,o;do r=Ze()*2-1,n=Ze()*2-1,a=r*r+n*n;while(a>=1);do s=Ze()*2-1,i=Ze()*2-1,o=s*s+i*i;while(o>=1);var c=Math.sqrt((1-a)/o);return t[0]=e*r,t[1]=e*n,t[2]=e*s*c,t[3]=e*i*c,t}function sg(t,e,r){var n=e[0],s=e[1],i=e[2],a=e[3];return t[0]=r[0]*n+r[4]*s+r[8]*i+r[12]*a,t[1]=r[1]*n+r[5]*s+r[9]*i+r[13]*a,t[2]=r[2]*n+r[6]*s+r[10]*i+r[14]*a,t[3]=r[3]*n+r[7]*s+r[11]*i+r[15]*a,t}function ig(t,e,r){var n=e[0],s=e[1],i=e[2],a=r[0],o=r[1],c=r[2],f=r[3],h=f*n+o*i-c*s,d=f*s+c*n-a*i,m=f*i+a*s-o*n,y=-a*n-o*s-c*i;return t[0]=h*f+y*-a+d*-c-m*-o,t[1]=d*f+y*-o+m*-a-h*-c,t[2]=m*f+y*-c+h*-o-d*-a,t[3]=e[3],t}function ag(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t}function og(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}function Ho(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]}function Wo(t,e){var r=t[0],n=t[1],s=t[2],i=t[3],a=e[0],o=e[1],c=e[2],f=e[3];return Math.abs(r-a)<=W*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(n-o)<=W*Math.max(1,Math.abs(n),Math.abs(o))&&Math.abs(s-c)<=W*Math.max(1,Math.abs(s),Math.abs(c))&&Math.abs(i-f)<=W*Math.max(1,Math.abs(i),Math.abs(f))}var cg=Uo,lg=Lo,fg=Bo,ug=jo,hg=zo,pg=$s,gg=Fs,dg=function(){var t=No();return function(e,r,n,s,i,a){var o,c;for(r||(r=4),n||(n=0),s?c=Math.min(s*r+n,e.length):c=e.length,o=n;o<c;o+=r)t[0]=e[o],t[1]=e[o+1],t[2]=e[o+2],t[3]=e[o+3],i(t,t,a),e[o]=t[0],e[o+1]=t[1],e[o+2]=t[2],e[o+3]=t[3];return e}}(),mg=Object.freeze({__proto__:null,add:Po,ceil:X1,clone:Oo,copy:Fo,create:No,cross:rg,dist:ug,distance:jo,div:fg,divide:Bo,dot:Go,equals:Wo,exactEquals:Ho,floor:Y1,forEach:dg,fromValues:$o,inverse:tg,len:pg,length:$s,lerp:qo,max:J1,min:K1,mul:lg,multiply:Lo,negate:eg,normalize:ko,random:ng,round:Z1,scale:Vo,scaleAndAdd:Q1,set:Do,sqrDist:hg,sqrLen:gg,squaredDistance:zo,squaredLength:Fs,str:og,sub:cg,subtract:Uo,transformMat4:sg,transformQuat:ig,zero:ag});function fn(){var t=new ee(4);return ee!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function vg(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}function Xo(t,e,r){r=r*.5;var n=Math.sin(r);return t[0]=n*e[0],t[1]=n*e[1],t[2]=n*e[2],t[3]=Math.cos(r),t}function xg(t,e){var r=Math.acos(e[3])*2,n=Math.sin(r/2);return n>W?(t[0]=e[0]/n,t[1]=e[1]/n,t[2]=e[2]/n):(t[0]=1,t[1]=0,t[2]=0),r}function yg(t,e){var r=Ps(t,e);return Math.acos(2*r*r-1)}function Yo(t,e,r){var n=e[0],s=e[1],i=e[2],a=e[3],o=r[0],c=r[1],f=r[2],h=r[3];return t[0]=n*h+a*o+s*f-i*c,t[1]=s*h+a*c+i*o-n*f,t[2]=i*h+a*f+n*c-s*o,t[3]=a*h-n*o-s*c-i*f,t}function Ko(t,e,r){r*=.5;var n=e[0],s=e[1],i=e[2],a=e[3],o=Math.sin(r),c=Math.cos(r);return t[0]=n*c+a*o,t[1]=s*c+i*o,t[2]=i*c-s*o,t[3]=a*c-n*o,t}function Jo(t,e,r){r*=.5;var n=e[0],s=e[1],i=e[2],a=e[3],o=Math.sin(r),c=Math.cos(r);return t[0]=n*c-i*o,t[1]=s*c+a*o,t[2]=i*c+n*o,t[3]=a*c-s*o,t}function Zo(t,e,r){r*=.5;var n=e[0],s=e[1],i=e[2],a=e[3],o=Math.sin(r),c=Math.cos(r);return t[0]=n*c+s*o,t[1]=s*c-n*o,t[2]=i*c+a*o,t[3]=a*c-i*o,t}function Tg(t,e){var r=e[0],n=e[1],s=e[2];return t[0]=r,t[1]=n,t[2]=s,t[3]=Math.sqrt(Math.abs(1-r*r-n*n-s*s)),t}function Qo(t,e){var r=e[0],n=e[1],s=e[2],i=e[3],a=Math.sqrt(r*r+n*n+s*s),o=Math.exp(i),c=a>0?o*Math.sin(a)/a:0;return t[0]=r*c,t[1]=n*c,t[2]=s*c,t[3]=o*Math.cos(a),t}function ec(t,e){var r=e[0],n=e[1],s=e[2],i=e[3],a=Math.sqrt(r*r+n*n+s*s),o=a>0?Math.atan2(a,i)/a:0;return t[0]=r*o,t[1]=n*o,t[2]=s*o,t[3]=.5*Math.log(r*r+n*n+s*s+i*i),t}function Mg(t,e,r){return ec(t,e),rc(t,t,r),Qo(t,t),t}function en(t,e,r,n){var s=e[0],i=e[1],a=e[2],o=e[3],c=r[0],f=r[1],h=r[2],d=r[3],m,y,M,R,p;return y=s*c+i*f+a*h+o*d,y<0&&(y=-y,c=-c,f=-f,h=-h,d=-d),1-y>W?(m=Math.acos(y),M=Math.sin(m),R=Math.sin((1-n)*m)/M,p=Math.sin(n*m)/M):(R=1-n,p=n),t[0]=R*s+p*c,t[1]=R*i+p*f,t[2]=R*a+p*h,t[3]=R*o+p*d,t}function Eg(t){var e=Ze(),r=Ze(),n=Ze(),s=Math.sqrt(1-e),i=Math.sqrt(e);return t[0]=s*Math.sin(2*Math.PI*r),t[1]=s*Math.cos(2*Math.PI*r),t[2]=i*Math.sin(2*Math.PI*n),t[3]=i*Math.cos(2*Math.PI*n),t}function Rg(t,e){var r=e[0],n=e[1],s=e[2],i=e[3],a=r*r+n*n+s*s+i*i,o=a?1/a:0;return t[0]=-r*o,t[1]=-n*o,t[2]=-s*o,t[3]=i*o,t}function wg(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t}function tc(t,e){var r=e[0]+e[4]+e[8],n;if(r>0)n=Math.sqrt(r+1),t[3]=.5*n,n=.5/n,t[0]=(e[5]-e[7])*n,t[1]=(e[6]-e[2])*n,t[2]=(e[1]-e[3])*n;else{var s=0;e[4]>e[0]&&(s=1),e[8]>e[s*3+s]&&(s=2);var i=(s+1)%3,a=(s+2)%3;n=Math.sqrt(e[s*3+s]-e[i*3+i]-e[a*3+a]+1),t[s]=.5*n,n=.5/n,t[3]=(e[i*3+a]-e[a*3+i])*n,t[i]=(e[i*3+s]+e[s*3+i])*n,t[a]=(e[a*3+s]+e[s*3+a])*n}return t}function Ig(t,e,r,n){var s=.5*Math.PI/180;e*=s,r*=s,n*=s;var i=Math.sin(e),a=Math.cos(e),o=Math.sin(r),c=Math.cos(r),f=Math.sin(n),h=Math.cos(n);return t[0]=i*c*h-a*o*f,t[1]=a*o*h+i*c*f,t[2]=a*c*f-i*o*h,t[3]=a*c*h+i*o*f,t}function Ag(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}var bg=Oo,_g=$o,Ds=Fo,Sg=Do,Cg=Po,Ng=Yo,rc=Vo,Ps=Go,Og=qo,Us=$s,$g=Us,Ls=Fs,Fg=Ls,Bs=ko,Dg=Ho,Pg=Wo,Ug=function(){var t=Ns(),e=os(1,0,0),r=os(0,1,0);return function(n,s,i){var a=Os(s,i);return a<-.999999?(Qr(t,e,s),Co(t)<1e-6&&Qr(t,r,s),So(t,t),Xo(n,t,Math.PI),n):a>.999999?(n[0]=0,n[1]=0,n[2]=0,n[3]=1,n):(Qr(t,s,i),n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=1+a,Bs(n,n))}}(),Lg=function(){var t=fn(),e=fn();return function(r,n,s,i,a,o){return en(t,n,a,o),en(e,s,i,o),en(r,t,e,2*o*(1-o)),r}}(),Bg=function(){var t=lo();return function(e,r,n,s){return t[0]=n[0],t[3]=n[1],t[6]=n[2],t[1]=s[0],t[4]=s[1],t[7]=s[2],t[2]=-r[0],t[5]=-r[1],t[8]=-r[2],Bs(e,tc(e,t))}}(),Vg=Object.freeze({__proto__:null,add:Cg,calculateW:Tg,clone:bg,conjugate:wg,copy:Ds,create:fn,dot:Ps,equals:Pg,exactEquals:Dg,exp:Qo,fromEuler:Ig,fromMat3:tc,fromValues:_g,getAngle:yg,getAxisAngle:xg,identity:vg,invert:Rg,len:$g,length:Us,lerp:Og,ln:ec,mul:Ng,multiply:Yo,normalize:Bs,pow:Mg,random:Eg,rotateX:Ko,rotateY:Jo,rotateZ:Zo,rotationTo:Ug,scale:rc,set:Sg,setAxes:Bg,setAxisAngle:Xo,slerp:en,sqlerp:Lg,sqrLen:Fg,squaredLength:Ls,str:Ag});function jg(){var t=new ee(8);return ee!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[4]=0,t[5]=0,t[6]=0,t[7]=0),t[3]=1,t}function zg(t){var e=new ee(8);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e}function kg(t,e,r,n,s,i,a,o){var c=new ee(8);return c[0]=t,c[1]=e,c[2]=r,c[3]=n,c[4]=s,c[5]=i,c[6]=a,c[7]=o,c}function Gg(t,e,r,n,s,i,a){var o=new ee(8);o[0]=t,o[1]=e,o[2]=r,o[3]=n;var c=s*.5,f=i*.5,h=a*.5;return o[4]=c*n+f*r-h*e,o[5]=f*n+h*t-c*r,o[6]=h*n+c*e-f*t,o[7]=-c*t-f*e-h*r,o}function nc(t,e,r){var n=r[0]*.5,s=r[1]*.5,i=r[2]*.5,a=e[0],o=e[1],c=e[2],f=e[3];return t[0]=a,t[1]=o,t[2]=c,t[3]=f,t[4]=n*f+s*c-i*o,t[5]=s*f+i*a-n*c,t[6]=i*f+n*o-s*a,t[7]=-n*a-s*o-i*c,t}function qg(t,e){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=e[0]*.5,t[5]=e[1]*.5,t[6]=e[2]*.5,t[7]=0,t}function Hg(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=0,t[5]=0,t[6]=0,t[7]=0,t}function Wg(t,e){var r=fn();xo(r,e);var n=new ee(3);return mo(n,e),nc(t,r,n),t}function sc(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t}function Xg(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t[6]=0,t[7]=0,t}function Yg(t,e,r,n,s,i,a,o,c){return t[0]=e,t[1]=r,t[2]=n,t[3]=s,t[4]=i,t[5]=a,t[6]=o,t[7]=c,t}var Kg=Ds;function Jg(t,e){return t[0]=e[4],t[1]=e[5],t[2]=e[6],t[3]=e[7],t}var Zg=Ds;function Qg(t,e){return t[4]=e[0],t[5]=e[1],t[6]=e[2],t[7]=e[3],t}function ed(t,e){var r=e[4],n=e[5],s=e[6],i=e[7],a=-e[0],o=-e[1],c=-e[2],f=e[3];return t[0]=(r*f+i*a+n*c-s*o)*2,t[1]=(n*f+i*o+s*a-r*c)*2,t[2]=(s*f+i*c+r*o-n*a)*2,t}function td(t,e,r){var n=e[0],s=e[1],i=e[2],a=e[3],o=r[0]*.5,c=r[1]*.5,f=r[2]*.5,h=e[4],d=e[5],m=e[6],y=e[7];return t[0]=n,t[1]=s,t[2]=i,t[3]=a,t[4]=a*o+s*f-i*c+h,t[5]=a*c+i*o-n*f+d,t[6]=a*f+n*c-s*o+m,t[7]=-n*o-s*c-i*f+y,t}function rd(t,e,r){var n=-e[0],s=-e[1],i=-e[2],a=e[3],o=e[4],c=e[5],f=e[6],h=e[7],d=o*a+h*n+c*i-f*s,m=c*a+h*s+f*n-o*i,y=f*a+h*i+o*s-c*n,M=h*a-o*n-c*s-f*i;return Ko(t,e,r),n=t[0],s=t[1],i=t[2],a=t[3],t[4]=d*a+M*n+m*i-y*s,t[5]=m*a+M*s+y*n-d*i,t[6]=y*a+M*i+d*s-m*n,t[7]=M*a-d*n-m*s-y*i,t}function nd(t,e,r){var n=-e[0],s=-e[1],i=-e[2],a=e[3],o=e[4],c=e[5],f=e[6],h=e[7],d=o*a+h*n+c*i-f*s,m=c*a+h*s+f*n-o*i,y=f*a+h*i+o*s-c*n,M=h*a-o*n-c*s-f*i;return Jo(t,e,r),n=t[0],s=t[1],i=t[2],a=t[3],t[4]=d*a+M*n+m*i-y*s,t[5]=m*a+M*s+y*n-d*i,t[6]=y*a+M*i+d*s-m*n,t[7]=M*a-d*n-m*s-y*i,t}function sd(t,e,r){var n=-e[0],s=-e[1],i=-e[2],a=e[3],o=e[4],c=e[5],f=e[6],h=e[7],d=o*a+h*n+c*i-f*s,m=c*a+h*s+f*n-o*i,y=f*a+h*i+o*s-c*n,M=h*a-o*n-c*s-f*i;return Zo(t,e,r),n=t[0],s=t[1],i=t[2],a=t[3],t[4]=d*a+M*n+m*i-y*s,t[5]=m*a+M*s+y*n-d*i,t[6]=y*a+M*i+d*s-m*n,t[7]=M*a-d*n-m*s-y*i,t}function id(t,e,r){var n=r[0],s=r[1],i=r[2],a=r[3],o=e[0],c=e[1],f=e[2],h=e[3];return t[0]=o*a+h*n+c*i-f*s,t[1]=c*a+h*s+f*n-o*i,t[2]=f*a+h*i+o*s-c*n,t[3]=h*a-o*n-c*s-f*i,o=e[4],c=e[5],f=e[6],h=e[7],t[4]=o*a+h*n+c*i-f*s,t[5]=c*a+h*s+f*n-o*i,t[6]=f*a+h*i+o*s-c*n,t[7]=h*a-o*n-c*s-f*i,t}function ad(t,e,r){var n=e[0],s=e[1],i=e[2],a=e[3],o=r[0],c=r[1],f=r[2],h=r[3];return t[0]=n*h+a*o+s*f-i*c,t[1]=s*h+a*c+i*o-n*f,t[2]=i*h+a*f+n*c-s*o,t[3]=a*h-n*o-s*c-i*f,o=r[4],c=r[5],f=r[6],h=r[7],t[4]=n*h+a*o+s*f-i*c,t[5]=s*h+a*c+i*o-n*f,t[6]=i*h+a*f+n*c-s*o,t[7]=a*h-n*o-s*c-i*f,t}function od(t,e,r,n){if(Math.abs(n)<W)return sc(t,e);var s=Math.hypot(r[0],r[1],r[2]);n=n*.5;var i=Math.sin(n),a=i*r[0]/s,o=i*r[1]/s,c=i*r[2]/s,f=Math.cos(n),h=e[0],d=e[1],m=e[2],y=e[3];t[0]=h*f+y*a+d*c-m*o,t[1]=d*f+y*o+m*a-h*c,t[2]=m*f+y*c+h*o-d*a,t[3]=y*f-h*a-d*o-m*c;var M=e[4],R=e[5],p=e[6],w=e[7];return t[4]=M*f+w*a+R*c-p*o,t[5]=R*f+w*o+p*a-M*c,t[6]=p*f+w*c+M*o-R*a,t[7]=w*f-M*a-R*o-p*c,t}function cd(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t[6]=e[6]+r[6],t[7]=e[7]+r[7],t}function ic(t,e,r){var n=e[0],s=e[1],i=e[2],a=e[3],o=r[4],c=r[5],f=r[6],h=r[7],d=e[4],m=e[5],y=e[6],M=e[7],R=r[0],p=r[1],w=r[2],g=r[3];return t[0]=n*g+a*R+s*w-i*p,t[1]=s*g+a*p+i*R-n*w,t[2]=i*g+a*w+n*p-s*R,t[3]=a*g-n*R-s*p-i*w,t[4]=n*h+a*o+s*f-i*c+d*g+M*R+m*w-y*p,t[5]=s*h+a*c+i*o-n*f+m*g+M*p+y*R-d*w,t[6]=i*h+a*f+n*c-s*o+y*g+M*w+d*p-m*R,t[7]=a*h-n*o-s*c-i*f+M*g-d*R-m*p-y*w,t}var ld=ic;function fd(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t}var ac=Ps;function ud(t,e,r,n){var s=1-n;return ac(e,r)<0&&(n=-n),t[0]=e[0]*s+r[0]*n,t[1]=e[1]*s+r[1]*n,t[2]=e[2]*s+r[2]*n,t[3]=e[3]*s+r[3]*n,t[4]=e[4]*s+r[4]*n,t[5]=e[5]*s+r[5]*n,t[6]=e[6]*s+r[6]*n,t[7]=e[7]*s+r[7]*n,t}function hd(t,e){var r=xn(e);return t[0]=-e[0]/r,t[1]=-e[1]/r,t[2]=-e[2]/r,t[3]=e[3]/r,t[4]=-e[4]/r,t[5]=-e[5]/r,t[6]=-e[6]/r,t[7]=e[7]/r,t}function pd(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t[4]=-e[4],t[5]=-e[5],t[6]=-e[6],t[7]=e[7],t}var oc=Us,gd=oc,xn=Ls,dd=xn;function md(t,e){var r=xn(e);if(r>0){r=Math.sqrt(r);var n=e[0]/r,s=e[1]/r,i=e[2]/r,a=e[3]/r,o=e[4],c=e[5],f=e[6],h=e[7],d=n*o+s*c+i*f+a*h;t[0]=n,t[1]=s,t[2]=i,t[3]=a,t[4]=(o-n*d)/r,t[5]=(c-s*d)/r,t[6]=(f-i*d)/r,t[7]=(h-a*d)/r}return t}function vd(t){return"quat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+")"}function xd(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]}function yd(t,e){var r=t[0],n=t[1],s=t[2],i=t[3],a=t[4],o=t[5],c=t[6],f=t[7],h=e[0],d=e[1],m=e[2],y=e[3],M=e[4],R=e[5],p=e[6],w=e[7];return Math.abs(r-h)<=W*Math.max(1,Math.abs(r),Math.abs(h))&&Math.abs(n-d)<=W*Math.max(1,Math.abs(n),Math.abs(d))&&Math.abs(s-m)<=W*Math.max(1,Math.abs(s),Math.abs(m))&&Math.abs(i-y)<=W*Math.max(1,Math.abs(i),Math.abs(y))&&Math.abs(a-M)<=W*Math.max(1,Math.abs(a),Math.abs(M))&&Math.abs(o-R)<=W*Math.max(1,Math.abs(o),Math.abs(R))&&Math.abs(c-p)<=W*Math.max(1,Math.abs(c),Math.abs(p))&&Math.abs(f-w)<=W*Math.max(1,Math.abs(f),Math.abs(w))}var Td=Object.freeze({__proto__:null,add:cd,clone:zg,conjugate:pd,copy:sc,create:jg,dot:ac,equals:yd,exactEquals:xd,fromMat4:Wg,fromRotation:Hg,fromRotationTranslation:nc,fromRotationTranslationValues:Gg,fromTranslation:qg,fromValues:kg,getDual:Jg,getReal:Kg,getTranslation:ed,identity:Xg,invert:hd,len:gd,length:oc,lerp:ud,mul:ld,multiply:ic,normalize:md,rotateAroundAxis:od,rotateByQuatAppend:id,rotateByQuatPrepend:ad,rotateX:rd,rotateY:nd,rotateZ:sd,scale:fd,set:Yg,setDual:Qg,setReal:Zg,sqrLen:dd,squaredLength:xn,str:vd,translate:td});function cc(){var t=new ee(2);return ee!=Float32Array&&(t[0]=0,t[1]=0),t}function Md(t){var e=new ee(2);return e[0]=t[0],e[1]=t[1],e}function Ed(t,e){var r=new ee(2);return r[0]=t,r[1]=e,r}function Rd(t,e){return t[0]=e[0],t[1]=e[1],t}function wd(t,e,r){return t[0]=e,t[1]=r,t}function Id(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t}function lc(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t}function fc(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t}function uc(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t}function Ad(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t}function bd(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t}function _d(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t}function Sd(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t}function Cd(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t}function Nd(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t}function Od(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t}function hc(t,e){var r=e[0]-t[0],n=e[1]-t[1];return Math.hypot(r,n)}function pc(t,e){var r=e[0]-t[0],n=e[1]-t[1];return r*r+n*n}function gc(t){var e=t[0],r=t[1];return Math.hypot(e,r)}function dc(t){var e=t[0],r=t[1];return e*e+r*r}function $d(t,e){return t[0]=-e[0],t[1]=-e[1],t}function Fd(t,e){return t[0]=1/e[0],t[1]=1/e[1],t}function Dd(t,e){var r=e[0],n=e[1],s=r*r+n*n;return s>0&&(s=1/Math.sqrt(s)),t[0]=e[0]*s,t[1]=e[1]*s,t}function Pd(t,e){return t[0]*e[0]+t[1]*e[1]}function Ud(t,e,r){var n=e[0]*r[1]-e[1]*r[0];return t[0]=t[1]=0,t[2]=n,t}function Ld(t,e,r,n){var s=e[0],i=e[1];return t[0]=s+n*(r[0]-s),t[1]=i+n*(r[1]-i),t}function Bd(t,e){e=e||1;var r=Ze()*2*Math.PI;return t[0]=Math.cos(r)*e,t[1]=Math.sin(r)*e,t}function Vd(t,e,r){var n=e[0],s=e[1];return t[0]=r[0]*n+r[2]*s,t[1]=r[1]*n+r[3]*s,t}function jd(t,e,r){var n=e[0],s=e[1];return t[0]=r[0]*n+r[2]*s+r[4],t[1]=r[1]*n+r[3]*s+r[5],t}function zd(t,e,r){var n=e[0],s=e[1];return t[0]=r[0]*n+r[3]*s+r[6],t[1]=r[1]*n+r[4]*s+r[7],t}function kd(t,e,r){var n=e[0],s=e[1];return t[0]=r[0]*n+r[4]*s+r[12],t[1]=r[1]*n+r[5]*s+r[13],t}function Gd(t,e,r,n){var s=e[0]-r[0],i=e[1]-r[1],a=Math.sin(n),o=Math.cos(n);return t[0]=s*o-i*a+r[0],t[1]=s*a+i*o+r[1],t}function qd(t,e){var r=t[0],n=t[1],s=e[0],i=e[1],a=Math.sqrt(r*r+n*n)*Math.sqrt(s*s+i*i),o=a&&(r*s+n*i)/a;return Math.acos(Math.min(Math.max(o,-1),1))}function Hd(t){return t[0]=0,t[1]=0,t}function Wd(t){return"vec2("+t[0]+", "+t[1]+")"}function Xd(t,e){return t[0]===e[0]&&t[1]===e[1]}function Yd(t,e){var r=t[0],n=t[1],s=e[0],i=e[1];return Math.abs(r-s)<=W*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(n-i)<=W*Math.max(1,Math.abs(n),Math.abs(i))}var Kd=gc,Jd=lc,Zd=fc,Qd=uc,e0=hc,t0=pc,r0=dc,n0=function(){var t=cc();return function(e,r,n,s,i,a){var o,c;for(r||(r=2),n||(n=0),s?c=Math.min(s*r+n,e.length):c=e.length,o=n;o<c;o+=r)t[0]=e[o],t[1]=e[o+1],i(t,t,a),e[o]=t[0],e[o+1]=t[1];return e}}(),s0=Object.freeze({__proto__:null,add:Id,angle:qd,ceil:Ad,clone:Md,copy:Rd,create:cc,cross:Ud,dist:e0,distance:hc,div:Qd,divide:uc,dot:Pd,equals:Yd,exactEquals:Xd,floor:bd,forEach:n0,fromValues:Ed,inverse:Fd,len:Kd,length:gc,lerp:Ld,max:Sd,min:_d,mul:Zd,multiply:fc,negate:$d,normalize:Dd,random:Bd,rotate:Gd,round:Cd,scale:Nd,scaleAndAdd:Od,set:wd,sqrDist:t0,sqrLen:r0,squaredDistance:pc,squaredLength:dc,str:Wd,sub:Jd,subtract:lc,transformMat2:Vd,transformMat2d:jd,transformMat3:zd,transformMat4:kd,zero:Hd}),mc=Object.freeze({__proto__:null,glMatrix:Ju,mat2:Eh,mat2d:Hh,mat3:Ep,mat4:u1,quat:Vg,quat2:Td,vec2:s0,vec3:W1,vec4:mg}),i0=(()=>{var t=import.meta.url;return async function(e={}){var r,n=e,s,i,a=new Promise((l,u)=>{s=l,i=u}),o=typeof window=="object",c=typeof importScripts=="function",f=typeof process=="object"&&typeof process.versions=="object"&&typeof process.versions.node=="string";if(f){const{createRequire:l}=await import("./__vite-browser-external-4ed993c7.js");var h=l(import.meta.url)}var d=!1;n.setup=function(){if(d)return;d=!0,n.initTBB();function l(A,S,D=k=>k){if(S)for(let k of S)A.push_back(D(k));return A}function u(A,S=D=>D){const D=[],k=A.size();for(let Z=0;Z<k;Z++)D.push(S(A.get(Z)));return D}function v(A,S=D=>D){const D=[],k=A.size();for(let Z=0;Z<k;Z++){const ue=A.get(Z),Te=ue.size(),Ve=[];for(let Se=0;Se<Te;Se++)Ve.push(S(ue.get(Se)));D.push(Ve)}return D}function E(A){return A[0].length<3&&(A=[A]),l(new n.Vector2_vec2,A,S=>l(new n.Vector_vec2,S,D=>D instanceof Array?{x:D[0],y:D[1]}:D))}function _(A){for(let S=0;S<A.size();S++)A.get(S).delete();A.delete()}function N(A){return A[0]instanceof Array?{x:A[0][0],y:A[0][1]}:typeof A[0]=="number"?{x:A[0]||0,y:A[1]||0}:A[0]}function U(A){return A[0]instanceof Array?{x:A[0][0],y:A[0][1],z:A[0][2]}:typeof A[0]=="number"?{x:A[0]||0,y:A[1]||0,z:A[2]||0}:A[0]}function $(A){return A=="EvenOdd"?0:A=="NonZero"?1:A=="Negative"?3:2}function B(A){return A=="Round"?1:A=="Miter"?2:0}const z=n.CrossSection;function H(A,S="Positive"){if(A instanceof z)return A;{const D=E(A),k=new z(D,$(S));return _(D),k}}n.CrossSection.prototype.translate=function(...A){return this._Translate(N(A))},n.CrossSection.prototype.scale=function(A){return typeof A=="number"?this._Scale({x:A,y:A}):this._Scale(N([A]))},n.CrossSection.prototype.mirror=function(A){return this._Mirror(N([A]))},n.CrossSection.prototype.warp=function(A){const S=ur(function(k){const Z=We(k,"double"),ue=We(k+8,"double"),Te=[Z,ue];A(Te),kt(k,Te[0],"double"),kt(k+8,Te[1],"double")},"vi"),D=this._Warp(S);return hr(S),D},n.CrossSection.prototype.decompose=function(){const A=this._Decompose(),S=u(A);return A.delete(),S},n.CrossSection.prototype.bounds=function(){const A=this._Bounds();return{min:["x","y"].map(S=>A.min[S]),max:["x","y"].map(S=>A.max[S])}},n.CrossSection.prototype.offset=function(A,S="Square",D=2,k=0){return this._Offset(A,B(S),D,k)},n.CrossSection.prototype.simplify=function(A=1e-6){return this._Simplify(A)},n.CrossSection.prototype.extrude=function(A,S=0,D=0,k=[1,1],Z=!1){k=N([k]);const ue=n._Extrude(this._ToPolygons(),A,S,D,k);return Z?ue.translate([0,0,-A/2]):ue},n.CrossSection.prototype.revolve=function(A=0,S=360){return n._Revolve(this._ToPolygons(),A,S)},n.CrossSection.prototype.add=function(A){return this._add(H(A))},n.CrossSection.prototype.subtract=function(A){return this._subtract(H(A))},n.CrossSection.prototype.intersect=function(A){return this._intersect(H(A))},n.CrossSection.prototype.toPolygons=function(){const A=this._ToPolygons(),S=v(A,D=>[D.x,D.y]);return A.delete(),S},n.Manifold.prototype.smoothOut=function(A=60,S=0){return this._SmoothOut(A,S)},n.Manifold.prototype.warp=function(A){const S=ur(function(Z){const ue=We(Z,"double"),Te=We(Z+8,"double"),Ve=We(Z+16,"double"),Se=[ue,Te,Ve];A(Se),kt(Z,Se[0],"double"),kt(Z+8,Se[1],"double"),kt(Z+16,Se[2],"double")},"vi"),D=this._Warp(S);hr(S);const k=D.status();if(k.value!==0)throw new n.ManifoldError(k.value);return D},n.Manifold.prototype.calculateNormals=function(A,S=60){return this._CalculateNormals(A,S)},n.Manifold.prototype.setProperties=function(A,S){const D=this.numProp(),k=ur(function(ue,Te,Ve){const Se=[];for(let Me=0;Me<A;++Me)Se[Me]=We(ue+8*Me,"double");const Xt=[];for(let Me=0;Me<3;++Me)Xt[Me]=We(Te+8*Me,"double");const Yt=[];for(let Me=0;Me<D;++Me)Yt[Me]=We(Ve+8*Me,"double");S(Se,Xt,Yt);for(let Me=0;Me<A;++Me)kt(ue+8*Me,Se[Me],"double")},"viii"),Z=this._SetProperties(A,k);return hr(k),Z},n.Manifold.prototype.translate=function(...A){return this._Translate(U(A))},n.Manifold.prototype.rotate=function(A,S,D){return Array.isArray(A)?this._Rotate(...A):this._Rotate(A,S||0,D||0)},n.Manifold.prototype.scale=function(A){return typeof A=="number"?this._Scale({x:A,y:A,z:A}):this._Scale(U([A]))},n.Manifold.prototype.mirror=function(A){return this._Mirror(U([A]))},n.Manifold.prototype.trimByPlane=function(A,S=0){return this._TrimByPlane(U([A]),S)},n.Manifold.prototype.slice=function(A=0){const S=this._Slice(A),D=new z(S,$("Positive"));return _(S),D},n.Manifold.prototype.project=function(){const A=this._Project(),S=new z(A,$("Positive"));return _(A),S},n.Manifold.prototype.split=function(A){const S=this._Split(A),D=u(S);return S.delete(),D},n.Manifold.prototype.splitByPlane=function(A,S=0){const D=this._SplitByPlane(U([A]),S),k=u(D);return D.delete(),k},n.Manifold.prototype.decompose=function(){const A=this._Decompose(),S=u(A);return A.delete(),S},n.Manifold.prototype.boundingBox=function(){const A=this._boundingBox();return{min:["x","y","z"].map(S=>A.min[S]),max:["x","y","z"].map(S=>A.max[S])}};class J{constructor({numProp:S=3,triVerts:D=new Uint32Array,vertProperties:k=new Float32Array,mergeFromVert:Z,mergeToVert:ue,runIndex:Te,runOriginalID:Ve,faceID:Se,halfedgeTangent:Xt,runTransform:Yt}={}){this.numProp=S,this.triVerts=D,this.vertProperties=k,this.mergeFromVert=Z,this.mergeToVert=ue,this.runIndex=Te,this.runOriginalID=Ve,this.faceID=Se,this.halfedgeTangent=Xt,this.runTransform=Yt}get numTri(){return this.triVerts.length/3}get numVert(){return this.vertProperties.length/this.numProp}get numRun(){return this.runOriginalID.length}merge(){const{changed:S,mesh:D}=n._Merge(this);return Object.assign(this,{...D}),S}verts(S){return this.triVerts.subarray(3*S,3*(S+1))}position(S){return this.vertProperties.subarray(this.numProp*S,this.numProp*S+3)}extras(S){return this.vertProperties.subarray(this.numProp*S+3,this.numProp*(S+1))}tangent(S){return this.halfedgeTangent.subarray(4*S,4*(S+1))}transform(S){const D=new Array(16);for(const k of[0,1,2,3])for(const Z of[0,1,2])D[4*k+Z]=this.runTransform[12*S+3*k+Z];return D[15]=1,D}}n.Mesh=J,n.Manifold.prototype.getMesh=function(A=-1){return new J(this._GetMeshJS(A))},n.ManifoldError=function(S,...D){let k="Unknown error";switch(S){case n.status.NonFiniteVertex.value:k="Non-finite vertex";break;case n.status.NotManifold.value:k="Not manifold";break;case n.status.VertexOutOfBounds.value:k="Vertex index out of bounds";break;case n.status.PropertiesWrongLength.value:k="Properties have wrong length";break;case n.status.MissingPositionProperties.value:k="Less than three properties";break;case n.status.MergeVectorsDifferentLengths.value:k="Merge vectors have different lengths";break;case n.status.MergeIndexOutOfBounds.value:k="Merge index out of bounds";break;case n.status.TransformWrongLength.value:k="Transform vector has wrong length";break;case n.status.RunIndexWrongLength.value:k="Run index vector has wrong length";break;case n.status.FaceIDWrongLength.value:k="Face ID vector has wrong length";case n.status.InvalidConstruction.value:k="Manifold constructed with invalid parameters"}const Z=Error.apply(this,[k,...D]);Z.name=this.name="ManifoldError",this.message=Z.message,this.stack=Z.stack,this.code=S},n.ManifoldError.prototype=Object.create(Error.prototype,{constructor:{value:n.ManifoldError,writable:!0,configurable:!0}}),n.CrossSection=function(A,S="Positive"){const D=E(A),k=new z(D,$(S));return _(D),k},n.CrossSection.ofPolygons=function(A,S="Positive"){return new n.CrossSection(A,S)},n.CrossSection.square=function(...A){let S;A.length==0?S={x:1,y:1}:typeof A[0]=="number"?S={x:A[0],y:A[0]}:S=N(A);const D=A[1]||!1;return n._Square(S,D)},n.CrossSection.circle=function(A,S=0){return n._Circle(A,S)};function ne(A){return function(...S){S.length==1&&(S=S[0]);const D=new n.Vector_crossSection;for(const Z of S)D.push_back(H(Z));const k=n["_crossSection"+A](D);return D.delete(),k}}n.CrossSection.compose=ne("Compose"),n.CrossSection.union=ne("UnionN"),n.CrossSection.difference=ne("DifferenceN"),n.CrossSection.intersection=ne("IntersectionN");function Ie(A,S){l(A,S,D=>D instanceof Array?{x:D[0],y:D[1]}:D)}n.CrossSection.hull=function(...A){A.length==1&&(A=A[0]);let S=new n.Vector_vec2;for(const k of A)if(k instanceof z)n._crossSectionCollectVertices(S,k);else if(k instanceof Array&&k.length==2&&typeof k[0]=="number")S.push_back({x:k[0],y:k[1]});else if(k.x)S.push_back(k);else{const ue=k[0].length==2&&typeof k[0][0]=="number"||k[0].x?[k]:k;for(const Te of ue)Ie(S,Te)}const D=n._crossSectionHullPoints(S);return S.delete(),D},n.CrossSection.prototype=Object.create(z.prototype),Object.defineProperty(n.CrossSection,Symbol.hasInstance,{get:()=>A=>A instanceof z});const xe=n.Manifold;n.Manifold=function(A){const S=new xe(A),D=S.status();if(D.value!==0)throw new n.ManifoldError(D.value);return S},n.Manifold.ofMesh=function(A){return new n.Manifold(A)},n.Manifold.tetrahedron=function(){return n._Tetrahedron()},n.Manifold.cube=function(...A){let S;A.length==0?S={x:1,y:1,z:1}:typeof A[0]=="number"?S={x:A[0],y:A[0],z:A[0]}:S=U(A);const D=A[1]||!1;return n._Cube(S,D)},n.Manifold.cylinder=function(A,S,D=-1,k=0,Z=!1){return n._Cylinder(A,S,D,k,Z)},n.Manifold.sphere=function(A,S=0){return n._Sphere(A,S)},n.Manifold.smooth=function(A,S=[]){const D=new n.Vector_smoothness;l(D,S);const k=n._Smooth(A,D);return D.delete(),k},n.Manifold.extrude=function(A,S,D=0,k=0,Z=[1,1],ue=!1){return(A instanceof z?A:n.CrossSection(A,"Positive")).extrude(S,D,k,Z,ue)},n.Manifold.revolve=function(A,S=0,D=360){return(A instanceof z?A:n.CrossSection(A,"Positive")).revolve(S,D)},n.Manifold.reserveIDs=function(A){return n._ReserveIDs(A)},n.Manifold.compose=function(A){const S=new n.Vector_manifold;l(S,A);const D=n._manifoldCompose(S);return S.delete(),D};function Ke(A){return function(...S){S.length==1&&(S=S[0]);const D=new n.Vector_manifold;for(const Z of S)D.push_back(Z);const k=n["_manifold"+A+"N"](D);return D.delete(),k}}n.Manifold.union=Ke("Union"),n.Manifold.difference=Ke("Difference"),n.Manifold.intersection=Ke("Intersection"),n.Manifold.levelSet=function(A,S,D,k=0,Z=-1){const ue={min:{x:S.min[0],y:S.min[1],z:S.min[2]},max:{x:S.max[0],y:S.max[1],z:S.max[2]}},Te=ur(function(Se){const Xt=We(Se,"double"),Yt=We(Se+8,"double"),Me=We(Se+16,"double");return A([Xt,Yt,Me])},"di"),Ve=n._LevelSet(Te,ue,D,k,Z);return hr(Te),Ve};function Je(A,S){l(A,S,D=>D instanceof Array?{x:D[0],y:D[1],z:D[2]}:D)}n.Manifold.hull=function(...A){A.length==1&&(A=A[0]);let S=new n.Vector_vec3;for(const k of A)k instanceof xe?n._manifoldCollectVertices(S,k):k instanceof Array&&k.length==3&&typeof k[0]=="number"?S.push_back({x:k[0],y:k[1],z:k[2]}):k.x?S.push_back(k):Je(S,k);const D=n._manifoldHullPoints(S);return S.delete(),D},n.Manifold.prototype=Object.create(xe.prototype),Object.defineProperty(n.Manifold,Symbol.hasInstance,{get:()=>A=>A instanceof xe}),n.triangulate=function(A,S=-1,D=!0){const k=E(A),Z=u(n._Triangulate(k,S,D),ue=>[ue[0],ue[1],ue[2]]);return _(k),Z}};var m=Object.assign({},n),y="";function M(l){return n.locateFile?n.locateFile(l,y):y+l}var R,p;if(f){var w=h("fs"),g=h("path");y=h("url").fileURLToPath(new URL("./",self.location)),p=l=>{l=ct(l)?new URL(l):g.normalize(l);var u=w.readFileSync(l);return u},R=(l,u=!0)=>(l=ct(l)?new URL(l):g.normalize(l),new Promise((v,E)=>{w.readFile(l,u?void 0:"utf8",(_,N)=>{_?E(_):v(u?N.buffer:N)})})),!n.thisProgram&&process.argv.length>1&&process.argv[1].replace(/\\/g,"/"),process.argv.slice(2)}else(o||c)&&(c?y=self.location.href:typeof document<"u"&&document.currentScript&&(y=document.currentScript.src),t&&(y=t),y.startsWith("blob:")?y="":y=y.substr(0,y.replace(/[?#].*/,"").lastIndexOf("/")+1),c&&(p=l=>{var u=new XMLHttpRequest;return u.open("GET",l,!1),u.responseType="arraybuffer",u.send(null),new Uint8Array(u.response)}),R=l=>ct(l)?new Promise((u,v)=>{var E=new XMLHttpRequest;E.open("GET",l,!0),E.responseType="arraybuffer",E.onload=()=>{(E.status==200||E.status==0&&E.response)&&v(E.response),u(E.status)},E.onerror=u,E.send(null)}):fetch(l,{credentials:"same-origin"}).then(u=>u.ok?u.arrayBuffer():Promise.reject(new Error(u.status+" : "+u.url))));n.print||console.log.bind(console);var x=n.printErr||console.error.bind(console);Object.assign(n,m),m=null,n.arguments&&n.arguments,n.thisProgram&&n.thisProgram,n.quit&&n.quit;var T;n.wasmBinary&&(T=n.wasmBinary);var I,b=!1,F,O,C,V,L,j,G,P;function Y(){var l=I.buffer;n.HEAP8=F=new Int8Array(l),n.HEAP16=C=new Int16Array(l),n.HEAPU8=O=new Uint8Array(l),n.HEAPU16=V=new Uint16Array(l),n.HEAP32=L=new Int32Array(l),n.HEAPU32=j=new Uint32Array(l),n.HEAPF32=G=new Float32Array(l),n.HEAPF64=P=new Float64Array(l)}var te=[],K=[],ie=[];function se(){if(n.preRun)for(typeof n.preRun=="function"&&(n.preRun=[n.preRun]);n.preRun.length;)he(n.preRun.shift());Mn(te)}function ae(){Mn(K)}function oe(){if(n.postRun)for(typeof n.postRun=="function"&&(n.postRun=[n.postRun]);n.postRun.length;)ge(n.postRun.shift());Mn(ie)}function he(l){te.unshift(l)}function Ae(l){K.unshift(l)}function ge(l){ie.unshift(l)}var ce=0,Ce=null;function He(l){ce++,n.monitorRunDependencies?.(ce)}function dt(l){if(ce--,n.monitorRunDependencies?.(ce),ce==0&&Ce){var u=Ce;Ce=null,u()}}function le(l){n.onAbort?.(l),l="Aborted("+l+")",x(l),b=!0,l+=". Build with -sASSERTIONS for more info.";var u=new WebAssembly.RuntimeError(l);throw i(u),u}var mt="data:application/octet-stream;base64,",Fe=l=>l.startsWith(mt),ct=l=>l.startsWith("file://");function xt(){if(n.locateFile){var l="manifold.wasm";return Fe(l)?l:M(l)}return new URL("/assets/manifold-c76c9e3a.wasm",self.location).href}var tt;function Fr(l){if(l==tt&&T)return new Uint8Array(T);if(p)return p(l);throw"both async and sync fetching of the wasm failed"}function Tn(l){return T?Promise.resolve().then(()=>Fr(l)):R(l).then(u=>new Uint8Array(u),()=>Fr(l))}function Dr(l,u,v){return Tn(l).then(E=>WebAssembly.instantiate(E,u)).then(v,E=>{x(`failed to asynchronously prepare wasm: ${E}`),le(E)})}function _c(l,u,v,E){return!l&&typeof WebAssembly.instantiateStreaming=="function"&&!Fe(u)&&!ct(u)&&!f&&typeof fetch=="function"?fetch(u,{credentials:"same-origin"}).then(_=>{var N=WebAssembly.instantiateStreaming(_,v);return N.then(E,function(U){return x(`wasm streaming compile failed: ${U}`),x("falling back to ArrayBuffer instantiation"),Dr(u,v,E)})}):Dr(u,v,E)}function Sc(){return{a:ff}}function Cc(){var l=Sc();function u(E,_){return Ye=E.exports,Ye=uf(Ye),I=Ye.J,Y(),Wt=Ye.M,Ae(Ye.K),dt(),Ye}He();function v(E){u(E.instance)}if(n.instantiateWasm)try{return n.instantiateWasm(l,u)}catch(E){x(`Module.instantiateWasm callback failed with error: ${E}`),i(E)}return tt||(tt=xt()),_c(T,tt,l,v).catch(i),{}}var Mn=l=>{for(;l.length>0;)l.shift()(n)};function We(l,u="i8"){switch(u.endsWith("*")&&(u="*"),u){case"i1":return F[l>>>0];case"i8":return F[l>>>0];case"i16":return C[l>>>1>>>0];case"i32":return L[l>>>2>>>0];case"i64":le("to do getValue(i64) use WASM_BIGINT");case"float":return G[l>>>2>>>0];case"double":return P[l>>>3>>>0];case"*":return j[l>>>2>>>0];default:le(`invalid type for getValue: ${u}`)}}n.noExitRuntime;function kt(l,u,v="i8"){switch(v.endsWith("*")&&(v="*"),v){case"i1":F[l>>>0]=u;break;case"i8":F[l>>>0]=u;break;case"i16":C[l>>>1>>>0]=u;break;case"i32":L[l>>>2>>>0]=u;break;case"i64":le("to do setValue(i64) use WASM_BIGINT");case"float":G[l>>>2>>>0]=u;break;case"double":P[l>>>3>>>0]=u;break;case"*":j[l>>>2>>>0]=u;break;default:le(`invalid type for setValue: ${v}`)}}class Nc{constructor(u){this.excPtr=u,this.ptr=u-24}set_type(u){j[this.ptr+4>>>2>>>0]=u}get_type(){return j[this.ptr+4>>>2>>>0]}set_destructor(u){j[this.ptr+8>>>2>>>0]=u}get_destructor(){return j[this.ptr+8>>>2>>>0]}set_caught(u){u=u?1:0,F[this.ptr+12>>>0]=u}get_caught(){return F[this.ptr+12>>>0]!=0}set_rethrown(u){u=u?1:0,F[this.ptr+13>>>0]=u}get_rethrown(){return F[this.ptr+13>>>0]!=0}init(u,v){this.set_adjusted_ptr(0),this.set_type(u),this.set_destructor(v)}set_adjusted_ptr(u){j[this.ptr+16>>>2>>>0]=u}get_adjusted_ptr(){return j[this.ptr+16>>>2>>>0]}get_exception_ptr(){var u=ui(this.get_type());if(u)return j[this.excPtr>>>2>>>0];var v=this.get_adjusted_ptr();return v!==0?v:this.excPtr}}var ks=0;function Oc(l,u,v){l>>>=0,u>>>=0,v>>>=0;var E=new Nc(l);throw E.init(u,v),ks=l,ks}var $c=()=>{le("")},Pr={},En=l=>{for(;l.length;){var u=l.pop(),v=l.pop();v(u)}};function ar(l){return this.fromWireType(j[l>>>2>>>0])}var Gt={},yt={},Ur={},Gs,Lr=l=>{throw new Gs(l)},Tt=(l,u,v)=>{l.forEach(function($){Ur[$]=u});function E($){var B=v($);B.length!==l.length&&Lr("Mismatched type converter count");for(var z=0;z<l.length;++z)rt(l[z],B[z])}var _=new Array(u.length),N=[],U=0;u.forEach(($,B)=>{yt.hasOwnProperty($)?_[B]=yt[$]:(N.push($),Gt.hasOwnProperty($)||(Gt[$]=[]),Gt[$].push(()=>{_[B]=yt[$],++U,U===N.length&&E(_)}))}),N.length===0&&E(_)},Fc=function(l){l>>>=0;var u=Pr[l];delete Pr[l];var v=u.rawConstructor,E=u.rawDestructor,_=u.fields,N=_.map(U=>U.getterReturnType).concat(_.map(U=>U.setterArgumentType));Tt([l],N,U=>{var $={};return _.forEach((B,z)=>{var H=B.fieldName,J=U[z],ne=B.getter,Ie=B.getterContext,xe=U[z+_.length],Ke=B.setter,Je=B.setterContext;$[H]={read:A=>J.fromWireType(ne(Ie,A)),write:(A,S)=>{var D=[];Ke(Je,A,xe.toWireType(D,S)),En(D)}}}),[{name:u.name,fromWireType:B=>{var z={};for(var H in $)z[H]=$[H].read(B);return E(B),z},toWireType:(B,z)=>{for(var H in $)if(!(H in z))throw new TypeError(`Missing field: "${H}"`);var J=v();for(H in $)$[H].write(J,z[H]);return B!==null&&B.push(E,J),J},argPackAdvance:nt,readValueFromPointer:ar,destructorFunction:E}]})};function Dc(l,u,v,E,_){}var Pc=()=>{for(var l=new Array(256),u=0;u<256;++u)l[u]=String.fromCharCode(u);qs=l},qs,Ne=l=>{for(var u="",v=l;O[v>>>0];)u+=qs[O[v++>>>0]];return u},qt,re=l=>{throw new qt(l)};function Uc(l,u,v={}){var E=u.name;if(l||re(`type "${E}" must have a positive integer typeid pointer`),yt.hasOwnProperty(l)){if(v.ignoreDuplicateRegistrations)return;re(`Cannot register type '${E}' twice`)}if(yt[l]=u,delete Ur[l],Gt.hasOwnProperty(l)){var _=Gt[l];delete Gt[l],_.forEach(N=>N())}}function rt(l,u,v={}){if(!("argPackAdvance"in u))throw new TypeError("registerType registeredInstance requires argPackAdvance");return Uc(l,u,v)}var nt=8;function Lc(l,u,v,E){l>>>=0,u>>>=0,u=Ne(u),rt(l,{name:u,fromWireType:function(_){return!!_},toWireType:function(_,N){return N?v:E},argPackAdvance:nt,readValueFromPointer:function(_){return this.fromWireType(O[_>>>0])},destructorFunction:null})}var Bc=l=>({count:l.count,deleteScheduled:l.deleteScheduled,preservePointerOnDelete:l.preservePointerOnDelete,ptr:l.ptr,ptrType:l.ptrType,smartPtr:l.smartPtr,smartPtrType:l.smartPtrType}),Rn=l=>{function u(v){return v.$$.ptrType.registeredClass.name}re(u(l)+" instance already deleted")},wn=!1,Hs=l=>{},Vc=l=>{l.smartPtr?l.smartPtrType.rawDestructor(l.smartPtr):l.ptrType.registeredClass.rawDestructor(l.ptr)},Ws=l=>{l.count.value-=1;var u=l.count.value===0;u&&Vc(l)},Xs=(l,u,v)=>{if(u===v)return l;if(v.baseClass===void 0)return null;var E=Xs(l,u,v.baseClass);return E===null?null:v.downcast(E)},Ys={},jc=()=>Object.keys(lr).length,zc=()=>{var l=[];for(var u in lr)lr.hasOwnProperty(u)&&l.push(lr[u]);return l},or=[],In=()=>{for(;or.length;){var l=or.pop();l.$$.deleteScheduled=!1,l.delete()}},cr,kc=l=>{cr=l,or.length&&cr&&cr(In)},Gc=()=>{n.getInheritedInstanceCount=jc,n.getLiveInheritedInstances=zc,n.flushPendingDeletes=In,n.setDelayFunction=kc},lr={},qc=(l,u)=>{for(u===void 0&&re("ptr should not be undefined");l.baseClass;)u=l.upcast(u),l=l.baseClass;return u},Hc=(l,u)=>(u=qc(l,u),lr[u]),Br=(l,u)=>{(!u.ptrType||!u.ptr)&&Lr("makeClassHandle requires ptr and ptrType");var v=!!u.smartPtrType,E=!!u.smartPtr;return v!==E&&Lr("Both smartPtrType and smartPtr must be specified"),u.count={value:1},fr(Object.create(l,{$$:{value:u,writable:!0}}))};function Wc(l){var u=this.getPointee(l);if(!u)return this.destructor(l),null;var v=Hc(this.registeredClass,u);if(v!==void 0){if(v.$$.count.value===0)return v.$$.ptr=u,v.$$.smartPtr=l,v.clone();var E=v.clone();return this.destructor(l),E}function _(){return this.isSmartPointer?Br(this.registeredClass.instancePrototype,{ptrType:this.pointeeType,ptr:u,smartPtrType:this,smartPtr:l}):Br(this.registeredClass.instancePrototype,{ptrType:this,ptr:l})}var N=this.registeredClass.getActualType(u),U=Ys[N];if(!U)return _.call(this);var $;this.isConst?$=U.constPointerType:$=U.pointerType;var B=Xs(u,this.registeredClass,$.registeredClass);return B===null?_.call(this):this.isSmartPointer?Br($.registeredClass.instancePrototype,{ptrType:$,ptr:B,smartPtrType:this,smartPtr:l}):Br($.registeredClass.instancePrototype,{ptrType:$,ptr:B})}var fr=l=>typeof FinalizationRegistry>"u"?(fr=u=>u,l):(wn=new FinalizationRegistry(u=>{Ws(u.$$)}),fr=u=>{var v=u.$$,E=!!v.smartPtr;if(E){var _={$$:v};wn.register(u,_,u)}return u},Hs=u=>wn.unregister(u),fr(l)),Xc=()=>{Object.assign(Vr.prototype,{isAliasOf(l){if(!(this instanceof Vr)||!(l instanceof Vr))return!1;var u=this.$$.ptrType.registeredClass,v=this.$$.ptr;l.$$=l.$$;for(var E=l.$$.ptrType.registeredClass,_=l.$$.ptr;u.baseClass;)v=u.upcast(v),u=u.baseClass;for(;E.baseClass;)_=E.upcast(_),E=E.baseClass;return u===E&&v===_},clone(){if(this.$$.ptr||Rn(this),this.$$.preservePointerOnDelete)return this.$$.count.value+=1,this;var l=fr(Object.create(Object.getPrototypeOf(this),{$$:{value:Bc(this.$$)}}));return l.$$.count.value+=1,l.$$.deleteScheduled=!1,l},delete(){this.$$.ptr||Rn(this),this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete&&re("Object already scheduled for deletion"),Hs(this),Ws(this.$$),this.$$.preservePointerOnDelete||(this.$$.smartPtr=void 0,this.$$.ptr=void 0)},isDeleted(){return!this.$$.ptr},deleteLater(){return this.$$.ptr||Rn(this),this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete&&re("Object already scheduled for deletion"),or.push(this),or.length===1&&cr&&cr(In),this.$$.deleteScheduled=!0,this}})};function Vr(){}var Ht=(l,u)=>Object.defineProperty(u,"name",{value:l}),Ks=(l,u,v)=>{if(l[u].overloadTable===void 0){var E=l[u];l[u]=function(..._){return l[u].overloadTable.hasOwnProperty(_.length)||re(`Function '${v}' called with an invalid number of arguments (${_.length}) - expects one of (${l[u].overloadTable})!`),l[u].overloadTable[_.length].apply(this,_)},l[u].overloadTable=[],l[u].overloadTable[E.argCount]=E}},An=(l,u,v)=>{n.hasOwnProperty(l)?((v===void 0||n[l].overloadTable!==void 0&&n[l].overloadTable[v]!==void 0)&&re(`Cannot register public name '${l}' twice`),Ks(n,l,l),n.hasOwnProperty(v)&&re(`Cannot register multiple overloads of a function with the same number of arguments (${v})!`),n[l].overloadTable[v]=u):(n[l]=u,v!==void 0&&(n[l].numArguments=v))},Yc=48,Kc=57,Jc=l=>{if(l===void 0)return"_unknown";l=l.replace(/[^a-zA-Z0-9_]/g,"$");var u=l.charCodeAt(0);return u>=Yc&&u<=Kc?`_${l}`:l};function Zc(l,u,v,E,_,N,U,$){this.name=l,this.constructor=u,this.instancePrototype=v,this.rawDestructor=E,this.baseClass=_,this.getActualType=N,this.upcast=U,this.downcast=$,this.pureVirtualFunctions=[]}var bn=(l,u,v)=>{for(;u!==v;)u.upcast||re(`Expected null or instance of ${v.name}, got an instance of ${u.name}`),l=u.upcast(l),u=u.baseClass;return l};function Qc(l,u){if(u===null)return this.isReference&&re(`null is not a valid ${this.name}`),0;u.$$||re(`Cannot pass "${On(u)}" as a ${this.name}`),u.$$.ptr||re(`Cannot pass deleted object as a pointer of type ${this.name}`);var v=u.$$.ptrType.registeredClass,E=bn(u.$$.ptr,v,this.registeredClass);return E}function el(l,u){var v;if(u===null)return this.isReference&&re(`null is not a valid ${this.name}`),this.isSmartPointer?(v=this.rawConstructor(),l!==null&&l.push(this.rawDestructor,v),v):0;(!u||!u.$$)&&re(`Cannot pass "${On(u)}" as a ${this.name}`),u.$$.ptr||re(`Cannot pass deleted object as a pointer of type ${this.name}`),!this.isConst&&u.$$.ptrType.isConst&&re(`Cannot convert argument of type ${u.$$.smartPtrType?u.$$.smartPtrType.name:u.$$.ptrType.name} to parameter type ${this.name}`);var E=u.$$.ptrType.registeredClass;if(v=bn(u.$$.ptr,E,this.registeredClass),this.isSmartPointer)switch(u.$$.smartPtr===void 0&&re("Passing raw pointer to smart pointer is illegal"),this.sharingPolicy){case 0:u.$$.smartPtrType===this?v=u.$$.smartPtr:re(`Cannot convert argument of type ${u.$$.smartPtrType?u.$$.smartPtrType.name:u.$$.ptrType.name} to parameter type ${this.name}`);break;case 1:v=u.$$.smartPtr;break;case 2:if(u.$$.smartPtrType===this)v=u.$$.smartPtr;else{var _=u.clone();v=this.rawShare(v,_e.toHandle(()=>_.delete())),l!==null&&l.push(this.rawDestructor,v)}break;default:re("Unsupporting sharing policy")}return v}function tl(l,u){if(u===null)return this.isReference&&re(`null is not a valid ${this.name}`),0;u.$$||re(`Cannot pass "${On(u)}" as a ${this.name}`),u.$$.ptr||re(`Cannot pass deleted object as a pointer of type ${this.name}`),u.$$.ptrType.isConst&&re(`Cannot convert argument of type ${u.$$.ptrType.name} to parameter type ${this.name}`);var v=u.$$.ptrType.registeredClass,E=bn(u.$$.ptr,v,this.registeredClass);return E}var rl=()=>{Object.assign(jr.prototype,{getPointee(l){return this.rawGetPointee&&(l=this.rawGetPointee(l)),l},destructor(l){this.rawDestructor?.(l)},argPackAdvance:nt,readValueFromPointer:ar,fromWireType:Wc})};function jr(l,u,v,E,_,N,U,$,B,z,H){this.name=l,this.registeredClass=u,this.isReference=v,this.isConst=E,this.isSmartPointer=_,this.pointeeType=N,this.sharingPolicy=U,this.rawGetPointee=$,this.rawConstructor=B,this.rawShare=z,this.rawDestructor=H,!_&&u.baseClass===void 0?E?(this.toWireType=Qc,this.destructorFunction=null):(this.toWireType=tl,this.destructorFunction=null):this.toWireType=el}var Js=(l,u,v)=>{n.hasOwnProperty(l)||Lr("Replacing nonexistent public symbol"),n[l].overloadTable!==void 0&&v!==void 0?n[l].overloadTable[v]=u:(n[l]=u,n[l].argCount=v)},nl=(l,u,v)=>{l=l.replace(/p/g,"i");var E=n["dynCall_"+l];return E(u,...v)},Wt,zr=l=>Wt.get(l),sl=(l,u,v=[])=>{if(l.includes("j"))return nl(l,u,v);var E=zr(u)(...v);return l[0]=="p"?E>>>0:E},Zs=(l,u)=>(...v)=>sl(l,u,v),Xe=(l,u)=>{l=Ne(l);function v(){return l.includes("j")||l.includes("p")?Zs(l,u):zr(u)}var E=v();return typeof E!="function"&&re(`unknown function pointer with signature ${l}: ${u}`),E},il=(l,u)=>{var v=Ht(u,function(E){this.name=u,this.message=E;var _=new Error(E).stack;_!==void 0&&(this.stack=this.toString()+`
`+_.replace(/^Error(:[^\n]*)?\n/,""))});return v.prototype=Object.create(l.prototype),v.prototype.constructor=v,v.prototype.toString=function(){return this.message===void 0?this.name:`${this.name}: ${this.message}`},v},Qs,ei=l=>{var u=fi(l),v=Ne(u);return ft(u),v},kr=(l,u)=>{var v=[],E={};function _(N){if(!E[N]&&!yt[N]){if(Ur[N]){Ur[N].forEach(_);return}v.push(N),E[N]=!0}}throw u.forEach(_),new Qs(`${l}: `+v.map(ei).join([", "]))};function al(l,u,v,E,_,N,U,$,B,z,H,J,ne){l>>>=0,u>>>=0,v>>>=0,E>>>=0,_>>>=0,N>>>=0,U>>>=0,$>>>=0,B>>>=0,z>>>=0,H>>>=0,J>>>=0,ne>>>=0,H=Ne(H),N=Xe(_,N),$&&=Xe(U,$),z&&=Xe(B,z),ne=Xe(J,ne);var Ie=Jc(H);An(Ie,function(){kr(`Cannot construct ${H} due to unbound types`,[E])}),Tt([l,u,v],E?[E]:[],xe=>{xe=xe[0];var Ke,Je;E?(Ke=xe.registeredClass,Je=Ke.instancePrototype):Je=Vr.prototype;var A=Ht(H,function(...Te){if(Object.getPrototypeOf(this)!==S)throw new qt("Use 'new' to construct "+H);if(D.constructor_body===void 0)throw new qt(H+" has no accessible constructor");var Ve=D.constructor_body[Te.length];if(Ve===void 0)throw new qt(`Tried to invoke ctor of ${H} with invalid number of parameters (${Te.length}) - expected (${Object.keys(D.constructor_body).toString()}) parameters instead!`);return Ve.apply(this,Te)}),S=Object.create(Je,{constructor:{value:A}});A.prototype=S;var D=new Zc(H,A,S,ne,Ke,N,$,z);D.baseClass&&(D.baseClass.__derivedClasses??=[],D.baseClass.__derivedClasses.push(D));var k=new jr(H,D,!0,!1,!1),Z=new jr(H+"*",D,!1,!1,!1),ue=new jr(H+" const*",D,!1,!0,!1);return Ys[l]={pointerType:Z,constPointerType:ue},Js(Ie,A),[k,Z,ue]})}var _n=(l,u)=>{for(var v=[],E=0;E<l;E++)v.push(j[u+E*4>>>2>>>0]);return v};function ti(l){for(var u=1;u<l.length;++u)if(l[u]!==null&&l[u].destructorFunction===void 0)return!0;return!1}function ri(l,u){if(!(l instanceof Function))throw new TypeError(`new_ called with constructor type ${typeof l} which is not a function`);var v=Ht(l.name||"unknownFunctionName",function(){});v.prototype=l.prototype;var E=new v,_=l.apply(E,u);return _ instanceof Object?_:E}function ol(l,u,v,E){for(var _=ti(l),N=l.length,U="",$="",B=0;B<N-2;++B)U+=(B!==0?", ":"")+"arg"+B,$+=(B!==0?", ":"")+"arg"+B+"Wired";var z=`
        return function (${U}) {
        if (arguments.length !== ${N-2}) {
          throwBindingError('function ' + humanName + ' called with ' + arguments.length + ' arguments, expected ${N-2}');
        }`;_&&(z+=`var destructors = [];
`);var H=_?"destructors":"null",J=["humanName","throwBindingError","invoker","fn","runDestructors","retType","classParam"];u&&(z+="var thisWired = classParam['toWireType']("+H+`, this);
`);for(var B=0;B<N-2;++B)z+="var arg"+B+"Wired = argType"+B+"['toWireType']("+H+", arg"+B+`);
`,J.push("argType"+B);if(u&&($="thisWired"+($.length>0?", ":"")+$),z+=(v||E?"var rv = ":"")+"invoker(fn"+($.length>0?", ":"")+$+`);
`,_)z+=`runDestructors(destructors);
`;else for(var B=u?1:2;B<l.length;++B){var ne=B===1?"thisWired":"arg"+(B-2)+"Wired";l[B].destructorFunction!==null&&(z+=`${ne}_dtor(${ne});
`,J.push(`${ne}_dtor`))}return v&&(z+=`var ret = retType['fromWireType'](rv);
return ret;
`),z+=`}
`,[J,z]}function Sn(l,u,v,E,_,N){var U=u.length;U<2&&re("argTypes array size mismatch! Must at least get return value and 'this' types!");for(var $=u[1]!==null&&v!==null,B=ti(u),z=u[0].name!=="void",H=[l,re,E,_,En,u[0],u[1]],J=0;J<U-2;++J)H.push(u[J+2]);if(!B)for(var J=$?1:2;J<u.length;++J)u[J].destructorFunction!==null&&H.push(u[J].destructorFunction);let[ne,Ie]=ol(u,$,z,N);ne.push(Ie);var xe=ri(Function,ne)(...H);return Ht(l,xe)}var cl=function(l,u,v,E,_,N){l>>>=0,v>>>=0,E>>>=0,_>>>=0,N>>>=0;var U=_n(u,v);_=Xe(E,_),Tt([],[l],$=>{$=$[0];var B=`constructor ${$.name}`;if($.registeredClass.constructor_body===void 0&&($.registeredClass.constructor_body=[]),$.registeredClass.constructor_body[u-1]!==void 0)throw new qt(`Cannot register multiple constructors with identical number of parameters (${u-1}) for class '${$.name}'! Overload resolution is currently only performed using the parameter count, not actual type info!`);return $.registeredClass.constructor_body[u-1]=()=>{kr(`Cannot construct ${$.name} due to unbound types`,U)},Tt([],U,z=>(z.splice(1,0,null),$.registeredClass.constructor_body[u-1]=Sn(B,z,null,_,N),[])),[]})},ni=l=>{l=l.trim();const u=l.indexOf("(");return u!==-1?l.substr(0,u):l},ll=function(l,u,v,E,_,N,U,$,B){l>>>=0,u>>>=0,E>>>=0,_>>>=0,N>>>=0,U>>>=0;var z=_n(v,E);u=Ne(u),u=ni(u),N=Xe(_,N),Tt([],[l],H=>{H=H[0];var J=`${H.name}.${u}`;u.startsWith("@@")&&(u=Symbol[u.substring(2)]),$&&H.registeredClass.pureVirtualFunctions.push(u);function ne(){kr(`Cannot call ${J} due to unbound types`,z)}var Ie=H.registeredClass.instancePrototype,xe=Ie[u];return xe===void 0||xe.overloadTable===void 0&&xe.className!==H.name&&xe.argCount===v-2?(ne.argCount=v-2,ne.className=H.name,Ie[u]=ne):(Ks(Ie,u,J),Ie[u].overloadTable[v-2]=ne),Tt([],z,Ke=>{var Je=Sn(J,Ke,H,N,U,B);return Ie[u].overloadTable===void 0?(Je.argCount=v-2,Ie[u]=Je):Ie[u].overloadTable[v-2]=Je,[]}),[]})},Cn=[],lt=[];function Nn(l){l>>>=0,l>9&&--lt[l+1]===0&&(lt[l]=void 0,Cn.push(l))}var fl=()=>lt.length/2-5-Cn.length,ul=()=>{lt.push(0,1,void 0,1,null,1,!0,1,!1,1),n.count_emval_handles=fl},_e={toValue:l=>(l||re("Cannot use deleted val. handle = "+l),lt[l]),toHandle:l=>{switch(l){case void 0:return 2;case null:return 4;case!0:return 6;case!1:return 8;default:{const u=Cn.pop()||lt.length;return lt[u]=l,lt[u+1]=1,u}}}},hl={name:"emscripten::val",fromWireType:l=>{var u=_e.toValue(l);return Nn(l),u},toWireType:(l,u)=>_e.toHandle(u),argPackAdvance:nt,readValueFromPointer:ar,destructorFunction:null};function si(l){return l>>>=0,rt(l,hl)}var pl=(l,u,v)=>{switch(u){case 1:return v?function(E){return this.fromWireType(F[E>>>0])}:function(E){return this.fromWireType(O[E>>>0])};case 2:return v?function(E){return this.fromWireType(C[E>>>1>>>0])}:function(E){return this.fromWireType(V[E>>>1>>>0])};case 4:return v?function(E){return this.fromWireType(L[E>>>2>>>0])}:function(E){return this.fromWireType(j[E>>>2>>>0])};default:throw new TypeError(`invalid integer width (${u}): ${l}`)}};function gl(l,u,v,E){l>>>=0,u>>>=0,v>>>=0,u=Ne(u);function _(){}_.values={},rt(l,{name:u,constructor:_,fromWireType:function(N){return this.constructor.values[N]},toWireType:(N,U)=>U.value,argPackAdvance:nt,readValueFromPointer:pl(u,v,E),destructorFunction:null}),An(u,_)}var Gr=(l,u)=>{var v=yt[l];return v===void 0&&re(`${u} has unknown type ${ei(l)}`),v};function dl(l,u,v){l>>>=0,u>>>=0;var E=Gr(l,"enum");u=Ne(u);var _=E.constructor,N=Object.create(E.constructor.prototype,{value:{value:v},constructor:{value:Ht(`${E.name}_${u}`,function(){})}});_.values[v]=N,_[u]=N}var On=l=>{if(l===null)return"null";var u=typeof l;return u==="object"||u==="array"||u==="function"?l.toString():""+l},ml=(l,u)=>{switch(u){case 4:return function(v){return this.fromWireType(G[v>>>2>>>0])};case 8:return function(v){return this.fromWireType(P[v>>>3>>>0])};default:throw new TypeError(`invalid float width (${u}): ${l}`)}},vl=function(l,u,v){l>>>=0,u>>>=0,v>>>=0,u=Ne(u),rt(l,{name:u,fromWireType:E=>E,toWireType:(E,_)=>_,argPackAdvance:nt,readValueFromPointer:ml(u,v),destructorFunction:null})};function xl(l,u,v,E,_,N,U){l>>>=0,v>>>=0,E>>>=0,_>>>=0,N>>>=0;var $=_n(u,v);l=Ne(l),l=ni(l),_=Xe(E,_),An(l,function(){kr(`Cannot call ${l} due to unbound types`,$)},u-1),Tt([],$,B=>{var z=[B[0],null].concat(B.slice(1));return Js(l,Sn(l,z,null,_,N,U),u-1),[]})}var yl=(l,u,v)=>{switch(u){case 1:return v?E=>F[E>>>0]:E=>O[E>>>0];case 2:return v?E=>C[E>>>1>>>0]:E=>V[E>>>1>>>0];case 4:return v?E=>L[E>>>2>>>0]:E=>j[E>>>2>>>0];default:throw new TypeError(`invalid integer width (${u}): ${l}`)}};function Tl(l,u,v,E,_){l>>>=0,u>>>=0,v>>>=0,u=Ne(u);var N=H=>H;if(E===0){var U=32-8*v;N=H=>H<<U>>>U}var $=u.includes("unsigned"),B=(H,J)=>{},z;$?z=function(H,J){return B(J,this.name),J>>>0}:z=function(H,J){return B(J,this.name),J},rt(l,{name:u,fromWireType:N,toWireType:z,argPackAdvance:nt,readValueFromPointer:yl(u,v,E!==0),destructorFunction:null})}function Ml(l,u,v){l>>>=0,v>>>=0;var E=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array],_=E[u];function N(U){var $=j[U>>>2>>>0],B=j[U+4>>>2>>>0];return new _(F.buffer,B,$)}v=Ne(v),rt(l,{name:v,fromWireType:N,argPackAdvance:nt,readValueFromPointer:N},{ignoreDuplicateRegistrations:!0})}function El(l,u){l>>>=0,si(l)}var Rl=(l,u,v,E)=>{if(v>>>=0,!(E>0))return 0;for(var _=v,N=v+E-1,U=0;U<l.length;++U){var $=l.charCodeAt(U);if($>=55296&&$<=57343){var B=l.charCodeAt(++U);$=65536+(($&1023)<<10)|B&1023}if($<=127){if(v>=N)break;u[v++>>>0]=$}else if($<=2047){if(v+1>=N)break;u[v++>>>0]=192|$>>6,u[v++>>>0]=128|$&63}else if($<=65535){if(v+2>=N)break;u[v++>>>0]=224|$>>12,u[v++>>>0]=128|$>>6&63,u[v++>>>0]=128|$&63}else{if(v+3>=N)break;u[v++>>>0]=240|$>>18,u[v++>>>0]=128|$>>12&63,u[v++>>>0]=128|$>>6&63,u[v++>>>0]=128|$&63}}return u[v>>>0]=0,v-_},wl=(l,u,v)=>Rl(l,O,u,v),Il=l=>{for(var u=0,v=0;v<l.length;++v){var E=l.charCodeAt(v);E<=127?u++:E<=2047?u+=2:E>=55296&&E<=57343?(u+=4,++v):u+=3}return u},ii=typeof TextDecoder<"u"?new TextDecoder:void 0,Al=(l,u,v)=>{u>>>=0;for(var E=u+v,_=u;l[_]&&!(_>=E);)++_;if(_-u>16&&l.buffer&&ii)return ii.decode(l.subarray(u,_));for(var N="";u<_;){var U=l[u++];if(!(U&128)){N+=String.fromCharCode(U);continue}var $=l[u++]&63;if((U&224)==192){N+=String.fromCharCode((U&31)<<6|$);continue}var B=l[u++]&63;if((U&240)==224?U=(U&15)<<12|$<<6|B:U=(U&7)<<18|$<<12|B<<6|l[u++]&63,U<65536)N+=String.fromCharCode(U);else{var z=U-65536;N+=String.fromCharCode(55296|z>>10,56320|z&1023)}}return N},bl=(l,u)=>(l>>>=0,l?Al(O,l,u):"");function _l(l,u){l>>>=0,u>>>=0,u=Ne(u);var v=u==="std::string";rt(l,{name:u,fromWireType(E){var _=j[E>>>2>>>0],N=E+4,U;if(v)for(var $=N,B=0;B<=_;++B){var z=N+B;if(B==_||O[z>>>0]==0){var H=z-$,J=bl($,H);U===void 0?U=J:(U+=String.fromCharCode(0),U+=J),$=z+1}}else{for(var ne=new Array(_),B=0;B<_;++B)ne[B]=String.fromCharCode(O[N+B>>>0]);U=ne.join("")}return ft(E),U},toWireType(E,_){_ instanceof ArrayBuffer&&(_=new Uint8Array(_));var N,U=typeof _=="string";U||_ instanceof Uint8Array||_ instanceof Uint8ClampedArray||_ instanceof Int8Array||re("Cannot pass non-string to std::string"),v&&U?N=Il(_):N=_.length;var $=Pn(4+N+1),B=$+4;if(j[$>>>2>>>0]=N,v&&U)wl(_,B,N+1);else if(U)for(var z=0;z<N;++z){var H=_.charCodeAt(z);H>255&&(ft(B),re("String has UTF-16 code units that do not fit in 8 bits")),O[B+z>>>0]=H}else for(var z=0;z<N;++z)O[B+z>>>0]=_[z];return E!==null&&E.push(ft,$),$},argPackAdvance:nt,readValueFromPointer:ar,destructorFunction(E){ft(E)}})}var ai=typeof TextDecoder<"u"?new TextDecoder("utf-16le"):void 0,Sl=(l,u)=>{for(var v=l,E=v>>1,_=E+u/2;!(E>=_)&&V[E>>>0];)++E;if(v=E<<1,v-l>32&&ai)return ai.decode(O.subarray(l>>>0,v>>>0));for(var N="",U=0;!(U>=u/2);++U){var $=C[l+U*2>>>1>>>0];if($==0)break;N+=String.fromCharCode($)}return N},Cl=(l,u,v)=>{if(v??=2147483647,v<2)return 0;v-=2;for(var E=u,_=v<l.length*2?v/2:l.length,N=0;N<_;++N){var U=l.charCodeAt(N);C[u>>>1>>>0]=U,u+=2}return C[u>>>1>>>0]=0,u-E},Nl=l=>l.length*2,Ol=(l,u)=>{for(var v=0,E="";!(v>=u/4);){var _=L[l+v*4>>>2>>>0];if(_==0)break;if(++v,_>=65536){var N=_-65536;E+=String.fromCharCode(55296|N>>10,56320|N&1023)}else E+=String.fromCharCode(_)}return E},$l=(l,u,v)=>{if(u>>>=0,v??=2147483647,v<4)return 0;for(var E=u,_=E+v-4,N=0;N<l.length;++N){var U=l.charCodeAt(N);if(U>=55296&&U<=57343){var $=l.charCodeAt(++N);U=65536+((U&1023)<<10)|$&1023}if(L[u>>>2>>>0]=U,u+=4,u+4>_)break}return L[u>>>2>>>0]=0,u-E},Fl=l=>{for(var u=0,v=0;v<l.length;++v){var E=l.charCodeAt(v);E>=55296&&E<=57343&&++v,u+=4}return u},Dl=function(l,u,v){l>>>=0,u>>>=0,v>>>=0,v=Ne(v);var E,_,N,U;u===2?(E=Sl,_=Cl,U=Nl,N=$=>V[$>>>1>>>0]):u===4&&(E=Ol,_=$l,U=Fl,N=$=>j[$>>>2>>>0]),rt(l,{name:v,fromWireType:$=>{for(var B=j[$>>>2>>>0],z,H=$+4,J=0;J<=B;++J){var ne=$+4+J*u;if(J==B||N(ne)==0){var Ie=ne-H,xe=E(H,Ie);z===void 0?z=xe:(z+=String.fromCharCode(0),z+=xe),H=ne+u}}return ft($),z},toWireType:($,B)=>{typeof B!="string"&&re(`Cannot pass non-string to C++ string type ${v}`);var z=U(B),H=Pn(4+z+u);return j[H>>>2>>>0]=z/u,_(B,H+4,z+u),$!==null&&$.push(ft,H),H},argPackAdvance:nt,readValueFromPointer:ar,destructorFunction($){ft($)}})};function Pl(l,u,v,E,_,N){l>>>=0,u>>>=0,v>>>=0,E>>>=0,_>>>=0,N>>>=0,Pr[l]={name:Ne(u),rawConstructor:Xe(v,E),rawDestructor:Xe(_,N),fields:[]}}function Ul(l,u,v,E,_,N,U,$,B,z){l>>>=0,u>>>=0,v>>>=0,E>>>=0,_>>>=0,N>>>=0,U>>>=0,$>>>=0,B>>>=0,z>>>=0,Pr[l].fields.push({fieldName:Ne(u),getterReturnType:v,getter:Xe(E,_),getterContext:N,setterArgumentType:U,setter:Xe($,B),setterContext:z})}var Ll=function(l,u){l>>>=0,u>>>=0,u=Ne(u),rt(l,{isVoid:!0,name:u,argPackAdvance:0,fromWireType:()=>{},toWireType:(v,E)=>{}})};function Bl(l,u,v){return l>>>=0,u>>>=0,v>>>=0,O.copyWithin(l>>>0,u>>>0,u+v>>>0)}var oi=(l,u,v)=>{var E=[],_=l.toWireType(E,v);return E.length&&(j[u>>>2>>>0]=_e.toHandle(E)),_};function Vl(l,u,v){return l>>>=0,u>>>=0,v>>>=0,l=_e.toValue(l),u=Gr(u,"emval::as"),oi(u,v,l)}var jl={},ci=l=>{var u=jl[l];return u===void 0?Ne(l):u},$n=[];function zl(l,u,v,E,_){return l>>>=0,u>>>=0,v>>>=0,E>>>=0,_>>>=0,l=$n[l],u=_e.toValue(u),v=ci(v),l(u,u[v],E,_)}function kl(l,u){return l>>>=0,u>>>=0,l=_e.toValue(l),u=_e.toValue(u),l==u}var Gl=l=>{var u=$n.length;return $n.push(l),u},ql=(l,u)=>{for(var v=new Array(l),E=0;E<l;++E)v[E]=Gr(j[u+E*4>>>2>>>0],"parameter "+E);return v};function Hl(l,u,v){u>>>=0;var E=ql(l,u),_=E.shift();l--;var N=`return function (obj, func, destructorsRef, args) {
`,U=0,$=[];v===0&&$.push("obj");for(var B=["retType"],z=[_],H=0;H<l;++H)$.push("arg"+H),B.push("argType"+H),z.push(E[H]),N+=`  var arg${H} = argType${H}.readValueFromPointer(args${U?"+"+U:""});
`,U+=E[H].argPackAdvance;var J=v===1?"new func":"func.call";N+=`  var rv = ${J}(${$.join(", ")});
`,_.isVoid||(B.push("emval_returnValue"),z.push(oi),N+=`  return emval_returnValue(retType, destructorsRef, rv);
`),N+=`};
`,B.push(N);var ne=ri(Function,B)(...z),Ie=`methodCaller<(${E.map(xe=>xe.name).join(", ")}) => ${_.name}>`;return Gl(Ht(Ie,ne))}function Wl(l,u){return l>>>=0,u>>>=0,l=_e.toValue(l),u=_e.toValue(u),_e.toHandle(l[u])}function Xl(l){l>>>=0,l>9&&(lt[l+1]+=1)}function Yl(l){return l>>>=0,_e.toHandle(ci(l))}function Kl(){return _e.toHandle({})}function Jl(l){l>>>=0;var u=_e.toValue(l);En(u),Nn(l)}function Zl(l,u,v){l>>>=0,u>>>=0,v>>>=0,l=_e.toValue(l),u=_e.toValue(u),v=_e.toValue(v),l[u]=v}function Ql(l,u){l>>>=0,u>>>=0,l=Gr(l,"_emval_take_value");var v=l.readValueFromPointer(u);return _e.toHandle(v)}var ef=()=>4294901760,tf=l=>{var u=I.buffer,v=(l-u.byteLength+65535)/65536;try{return I.grow(v),Y(),1}catch{}};function rf(l){l>>>=0;var u=O.length,v=ef();if(l>v)return!1;for(var E=(B,z)=>B+(z-B%z)%z,_=1;_<=4;_*=2){var N=u*(1+.2/_);N=Math.min(N,l+100663296);var U=Math.min(v,E(Math.max(l,N),65536)),$=tf(U);if($)return!0}return!1}var li=(l,u)=>{l<128?u.push(l):u.push(l%128|128,l>>7)},nf=l=>{for(var u={i:"i32",j:"i64",f:"f32",d:"f64",e:"externref",p:"i32"},v={parameters:[],results:l[0]=="v"?[]:[u[l[0]]]},E=1;E<l.length;++E)v.parameters.push(u[l[E]]);return v},sf=(l,u)=>{var v=l.slice(0,1),E=l.slice(1),_={i:127,p:127,j:126,f:125,d:124,e:111};u.push(96),li(E.length,u);for(var N=0;N<E.length;++N)u.push(_[E[N]]);v=="v"?u.push(0):u.push(1,_[v])},af=(l,u)=>{if(typeof WebAssembly.Function=="function")return new WebAssembly.Function(nf(u),l);var v=[1];sf(u,v);var E=[0,97,115,109,1,0,0,0,1];li(v.length,E),E.push(...v),E.push(2,7,1,1,101,1,102,0,0,7,5,1,1,102,0,0);var _=new WebAssembly.Module(new Uint8Array(E)),N=new WebAssembly.Instance(_,{e:{f:l}}),U=N.exports.f;return U},of=(l,u)=>{if(Mt)for(var v=l;v<l+u;v++){var E=zr(v);E&&Mt.set(E,v)}},Mt,cf=l=>(Mt||(Mt=new WeakMap,of(0,Wt.length)),Mt.get(l)||0),Fn=[],lf=()=>{if(Fn.length)return Fn.pop();try{Wt.grow(1)}catch(l){throw l instanceof RangeError?"Unable to grow wasm table. Set ALLOW_TABLE_GROWTH.":l}return Wt.length-1},Dn=(l,u)=>Wt.set(l,u),ur=(l,u)=>{var v=cf(l);if(v)return v;var E=lf();try{Dn(E,l)}catch(N){if(!(N instanceof TypeError))throw N;var _=af(l,u);Dn(E,_)}return Mt.set(l,E),E},hr=l=>{Mt.delete(zr(l)),Dn(l,null),Fn.push(l)};Gs=n.InternalError=class extends Error{constructor(u){super(u),this.name="InternalError"}},Pc(),qt=n.BindingError=class extends Error{constructor(u){super(u),this.name="BindingError"}},Xc(),Gc(),rl(),Qs=n.UnboundTypeError=il(Error,"UnboundTypeError"),ul();var ff={i:Oc,D:$c,n:Fc,C:Dc,H:Lc,h:al,g:cl,a:ll,G:si,t:gl,f:dl,x:vl,c:xl,j:Tl,e:Ml,k:El,w:_l,s:Dl,o:Pl,l:Ul,I:Ll,F:Bl,v:Vl,z:zl,b:Nn,m:kl,y:Hl,B:Wl,u:Xl,q:Yl,A:Kl,p:Jl,r:Zl,d:Ql,E:rf},Ye=Cc(),fi=l=>(fi=Ye.L)(l),ft=l=>(ft=Ye.N)(l),Pn=l=>(Pn=Ye.O)(l),ui=l=>(ui=Ye.P)(l);function uf(l){l=Object.assign({},l);var u=E=>_=>E(_)>>>0,v=E=>()=>E()>>>0;return l.L=u(l.L),l.O=u(l.O),l._emscripten_stack_alloc=u(l._emscripten_stack_alloc),l.emscripten_stack_get_current=v(l.emscripten_stack_get_current),l}n.addFunction=ur,n.removeFunction=hr;var qr;Ce=function l(){qr||hi(),qr||(Ce=l)};function hi(){if(ce>0||(se(),ce>0))return;function l(){qr||(qr=!0,n.calledRun=!0,!b&&(ae(),s(n),n.onRuntimeInitialized?.(),oe()))}n.setStatus?(n.setStatus("Running..."),setTimeout(function(){setTimeout(function(){n.setStatus("")},1),l()},1)):l()}if(n.preInit)for(typeof n.preInit=="function"&&(n.preInit=[n.preInit]);n.preInit.length>0;)n.preInit.pop()();return hi(),r=a,r}})();const at="EXT_mesh_manifold",ji="MERGE";class Vs extends we{static EXTENSION_NAME=at;init(){Vs.EXTENSION_NAME=at,this.propertyType="ManifoldPrimitive",this.parentTypes=[q.MESH]}getDefaults(){return Object.assign(super.getDefaults(),{manifoldPrimitive:null,mergeIndices:null,mergeValues:null})}getMergeIndices(){return this.getRef("mergeIndices")}getMergeValues(){return this.getRef("mergeValues")}setMerge(e,r){if(e.getCount()!==r.getCount())throw new Error("merge vectors must be the same length.");return this.setRef("mergeIndices",e),this.setRef("mergeValues",r)}getRunIndex(){return this.get("runIndex")}setRunIndex(e){return this.set("runIndex",e)}setIndices(e){return this.setRef("indices",e)}getIndices(){return this.getRef("indices")}}class vc extends me{extensionName=at;prewriteTypes=[q.ACCESSOR];static EXTENSION_NAME=at;createManifoldPrimitive(){return new Vs(this.document.getGraph())}read(e){const{json:r}=e.jsonDoc;return(r.meshes||[]).forEach((s,i)=>{if(!s.extensions||!s.extensions[at])return;const a=e.meshes[i],o=this.createManifoldPrimitive();a.setExtension(at,o);const c=s.extensions[at];if(c.manifoldPrimitive){let f=0;const h=Array();h.push(f);for(const d of a.listPrimitives()){const m=d.getIndices();if(!m){console.log("Skipping non-indexed primitive ",d.getName());continue}f+=m.getCount(),h.push(f)}o.setRunIndex(h),o.setIndices(e.accessors[c.manifoldPrimitive.indices])}c.mergeIndices!=null&&c.mergeValues!=null&&o.setMerge(e.accessors[c.mergeIndices],e.accessors[c.mergeValues])}),this}prewrite(e){return this.document.getRoot().listMeshes().forEach(r=>{const n=r.getExtension(at);if(!n)return;const s=n.getIndices();e.addAccessorToUsageGroup(s,Qe.BufferViewUsage.ELEMENT_ARRAY_BUFFER);const i=n.getMergeIndices(),a=n.getMergeValues();!i||!a||(e.addAccessorToUsageGroup(i,ji),e.addAccessorToUsageGroup(a,ji))}),this}write(e){const{json:r}=e.jsonDoc;return this.document.getRoot().listMeshes().forEach(n=>{const s=n.getExtension(at);if(!s)return;const i=e.meshIndexMap.get(n),a=r.meshes[i],o=s.getRunIndex(),c=o.length-1;if(c!==a.primitives.length)throw new Error("The number of primitives must be exactly one less than the length of runIndex.");const f=e.accessorIndexMap.get(s.getMergeIndices()),h=e.accessorIndexMap.get(s.getMergeValues()),d=r.accessors[f],m=r.accessors[h],y=a.primitives[0],M={indices:e.accessorIndexMap.get(s.getIndices()),mode:y.mode,attributes:{POSITION:y.attributes.POSITION}},R=r.accessors[M.indices];if(R){d&&m&&(R.sparse={count:d.count,indices:{bufferView:d.bufferView,byteOffset:d.byteOffset,componentType:d.componentType},values:{bufferView:m.bufferView,byteOffset:m.byteOffset}});for(let p=0;p<c;++p){const w=r.accessors[a.primitives[p].indices];w.bufferView=R.bufferView,w.byteOffset=R.byteOffset+4*o[p],w.count=o[p+1]-o[p]}a.extensions=a.extensions||{},a.extensions[at]={manifoldPrimitive:M,mergeIndices:f,mergeValues:h}}}),this}}const mr={POSITION:{type:X.Type.VEC3,components:3},NORMAL:{type:X.Type.VEC3,components:3},TANGENT:{type:X.Type.VEC4,components:4},TEXCOORD_0:{type:X.Type.VEC2,components:2},TEXCOORD_1:{type:X.Type.VEC2,components:2},COLOR_0:{type:X.Type.VEC3,components:3},JOINTS_0:{type:X.Type.VEC4,components:4},WEIGHTS_0:{type:X.Type.VEC4,components:4},SKIP_1:{type:null,components:1},SKIP_2:{type:null,components:2},SKIP_3:{type:null,components:3},SKIP_4:{type:null,components:4}};function a0(t){return t.registerExtensions([vc])}function zi(t,e,r){t.getRoot().listBuffers().length===0&&t.createBuffer();const n=t.getRoot().listBuffers()[0],s=t.createExtension(vc),i=t.createMesh(),a=Array(),o=Array(),c=new Map,f=e.runIndex.length-1;let h=-1;for(let x=0;x<f;++x){const T=e.runOriginalID[x];if(T==h)continue;h=T,a.push(e.runIndex[x]);const I=t.createAccessor("primitive indices of ID "+T).setBuffer(n).setType(X.Type.SCALAR).setArray(new Uint32Array(1)),b=t.createPrimitive().setIndices(I),F=r.get(T);if(F){const{material:O,attributes:C}=F;if(C.length<1||C[0]!=="POSITION")throw new Error('First attribute must be "POSITION".');b.setMaterial(O),c.set(b,C),F.attributes.forEach((V,L)=>{if(L>=o.length)o.push(V);else{const j=mr[V].components,G=mr[o[L]].components;if(j!=G)throw new Error("Attribute sizes do not correspond: "+V+" and "+o[L]);mr[o[L]].type==null&&(o[L]=V)}})}else c.set(b,["POSITION"]);i.addPrimitive(b)}a.push(e.runIndex[f]);const d=e.numVert,m=e.numProp;let y=0;o.forEach((x,T)=>{const I=mr[x];if(I==null)throw new Error(x+" is not a recognized attribute.");if(I.type==null){++y;return}const b=I.components;if(y+b>m)throw new Error("Too many attribute channels.");const F=new Float32Array(b*d);for(let C=0;C<d;++C)for(let V=0;V<b;++V){let L=e.vertProperties[m*C+y+V];x=="COLOR_0"&&(L=Math.max(0,Math.min(1,L))),F[b*C+V]=L}const O=t.createAccessor(x).setBuffer(n).setType(I.type).setArray(F);for(const C of i.listPrimitives()){const V=c.get(C);V.length>T&&mr[V[T]].type!=null&&C.setAttribute(x,O)}y+=b});const M=s.createManifoldPrimitive();i.setExtension("EXT_mesh_manifold",M);const R=t.createAccessor("manifold indices").setBuffer(n).setType(X.Type.SCALAR).setArray(e.triVerts);M.setIndices(R),M.setRunIndex(a);const p=[...Array(e.numVert).keys()],w=Array(),g=Array();if(e.mergeFromVert&&e.mergeToVert){for(const[x,T]of e.mergeFromVert.entries())p[T]=e.mergeToVert[x];for(const[x,T]of e.triVerts.entries()){const I=p[T];T!==I&&(w.push(x),g.push(I))}}if(w.length>0){const x=t.createAccessor("merge from").setBuffer(n).setType(X.Type.SCALAR).setArray(new Uint32Array(w)),T=t.createAccessor("merge to").setBuffer(n).setType(X.Type.SCALAR).setArray(new Uint32Array(g));M.setMerge(x,T)}return i}const qe=await i0();qe.setup();so(Array);const xc=a0(new Df);xc.registerExtensions(Wa);const o0=["cube","cylinder","sphere","tetrahedron","extrude","revolve","compose","union","difference","intersection","levelSet","smooth","ofMesh","hull"],c0=["add","subtract","intersect","decompose","warp","transform","translate","rotate","scale","mirror","calculateCurvature","calculateNormals","smoothByNormals","smoothOut","refine","refineToLength","refineToTolerance","setProperties","setTolerance","asOriginal","trimByPlane","split","splitByPlane","slice","project","hull"],l0=["square","circle","union","difference","intersection","compose","ofPolygons","hull"],f0=["add","subtract","intersect","rectClip","decompose","transform","translate","rotate","scale","mirror","simplify","offset","hull"],yc=["show","only","setMaterial"],u0=["setMinCircularAngle","setMinCircularEdgeLength","setCircularSegments","getCircularSegments","resetToCircularDefaults","Mesh","GLTFNode","Manifold","CrossSection","setMorphStart","setMorphEnd"],h0=yc.concat(u0),un=new Array;function yn(t,e,r){const n=qe[t],s=r?n:n.prototype;for(const i of e){const a=s[i];s[i]=function(...o){const c=a(...o);return un.push(c),c}}}yn("Manifold",c0,!1);yn("Manifold",o0,!0);yn("CrossSection",f0,!1);yn("CrossSection",l0,!0);for(const t of yc){const e=qe[t];qe[t]=function(...r){const n=e(...r);return un.push(n),n}}let js=!1;const hn=new Map,zs=new Map,p0=30,Tc={roughness:.2,metallic:1,baseColorFactor:[1,1,0],alpha:1,unlit:!1,animationLength:1,animationMode:"loop"},g0={baseColorFactor:[1,0,0],alpha:.25,roughness:1,metallic:0},d0={baseColorFactor:[.5,.5,.5],alpha:.25,roughness:1,metallic:0},Pt=new Array,pn=new Map,tn=new Map,Bt=new Map,jt=new Map;let Or=1,er,_r,kn,rn,gn,Mc=0;function m0(){for(const t of un)if(t instanceof Array)for(const e of t)e.delete();else t.delete();un.length=0,js=!1,hn.clear(),zs.clear(),Pt.length=0,pn.clear(),tn.clear(),Bt.clear(),jt.clear(),Or=1}class v0{_parent;manifold;translation;rotation;scale;material;name;constructor(e){this._parent=e,Pt.push(this)}clone(e){const r={...this};return r._parent=e,Pt.push(r),r}get parent(){return this._parent}}qe.GLTFNode=v0;const Ft={...Tc};qe.setMaterial=(t,e)=>{const r=t.asOriginal();return pn.set(r.originalID(),e),r};qe.setMorphStart=(t,e)=>{const r=jt.get(t);r!=null?r.start=e:jt.set(t,{start:e})};qe.setMorphEnd=(t,e)=>{const r=jt.get(t);r!=null?r.end=e:jt.set(t,{end:e})};function Ec(t,e){let r=t.asOriginal();return e.set(r.originalID(),r.getMesh()),r}qe.show=t=>Ec(t,hn);qe.only=t=>(js=!0,Ec(t,zs));function Zt(...t){typeof self<"u"&&self.console&&self.console.log(...t)}function Rc(t){const{quat:e}=mc,r=Math.PI/180,n=e.create();return e.rotateZ(n,n,r*t[2]),e.rotateY(n,n,r*t[1]),e.rotateX(n,n,r*t[0]),n}function Gn(t,e,r,n){const s=r[e];if(s==null)return null;if(typeof s!="function")return s;const i=_r.getCount(),a=e=="rotation"?4:3,o=new Float32Array(a*i);for(let d=0;d<i;++d){const m=d/(i-1),y=s(Ft.animationMode!=="ping-pong"?m:(1-Math.cos(m*2*Math.PI))/2);o.set(a===4?Rc(y):y,a*d)}const c=t.createAccessor(r.name+" "+e+" frames").setBuffer(t.getRoot().listBuffers()[0]).setArray(o).setType(a===4?X.Type.VEC4:X.Type.VEC3),f=t.createAnimationSampler().setInput(_r).setOutput(c).setInterpolation("LINEAR"),h=t.createAnimationChannel().setTargetPath(e).setTargetNode(n).setSampler(f);return er.addSampler(f),er.addChannel(h),gn=!0,s(0)}function x0(t,e,r){if(jt.has(r)){const n=t.createAnimationChannel().setTargetPath("weights").setTargetNode(e).setSampler(rn);er.addChannel(n),gn=!0}}function y0(t,e){const r=[];if(e==null)return r;for(let n=0;n<t.numVert;++n)for(let s=0;s<3;++s)r[n*3+s]=t.vertProperties[n*t.numProp+s];if(e.start)for(let n=0;n<t.numVert;++n){const s=t.vertProperties,i=n*t.numProp,a=r.slice(i,i+3);e.start(a);for(let o=0;o<3;++o)s[i+o]=a[o]}return r}function T0(t,e,r,n,s){s!=null&&(r.setWeights([0]),r.listPrimitives().forEach((i,a)=>{if(s.end)for(let m=0;m<e.numVert;++m){const y=n.slice(3*m,3*(m+1));s.end(y),n.splice(3*m,3,...y)}const o=i.getAttribute("POSITION").getArray(),c=new Float32Array(o.length),f=e.runIndex[a];for(let m=0;m<c.length;++m)c[m]=n[f+m]-o[m];const h=t.createAccessor(r.getName()+" morph target").setBuffer(t.getRoot().listBuffers()[0]).setArray(c).setType(X.Type.VEC3),d=t.createPrimitiveTarget().setAttribute("POSITION",h);i.addTarget(d)}))}function M0(t,e){const r=t.createNode(e.name),n=Gn(t,"translation",e,r);n!=null&&r.setTranslation(n);const s=Gn(t,"rotation",e,r);s!=null&&r.setRotation(Rc(s));const i=Gn(t,"scale",e,r);return i!=null&&r.setScale(i),r}function wc(t){return t==null?{}:(t.material==null&&(t.material=wc(t.parent)),t.material)}function E0(t,e={}){const r={...Ft};Object.assign(r,e);const{roughness:n,metallic:s,baseColorFactor:i,alpha:a,unlit:o}=r,c=t.createMaterial(e.name??"");if(o){const f=t.createExtension(bs).createUnlit();c.setExtension("KHR_materials_unlit",f)}return a<1&&c.setAlphaMode(sr.AlphaMode.BLEND).setDoubleSided(!0),c.setRoughnessFactor(n).setMetallicFactor(s).setBaseColorFactor([...i,a])}function dn(t,e){return tn.has(e)||tn.set(e,E0(t,e)),tn.get(e)}function Ic(t,e,r,n,s={}){const i=n.numTri();if(i==0){Zt("Empty manifold, skipping.");return}Zt(`Triangles: ${i.toLocaleString()}`);const a=n.boundingBox(),o=[0,0,0];for(let R=0;R<3;R++)o[R]=Math.round((a.max[R]-a.min[R])*10)/10;Zt(`Bounding Box: X = ${o[0].toLocaleString()} mm, Y = ${o[1].toLocaleString()} mm, Z = ${o[2].toLocaleString()} mm`);const c=Math.round(n.volume()/10);Zt(`Genus: ${n.genus().toLocaleString()}, Volume: ${(c/100).toLocaleString()} cm^3`);const f=n.getMesh(),h=new Map;for(const R of f.runOriginalID){const p=pn.get(R)||s;h.set(R,{material:dn(t,js?d0:p),attributes:["POSITION",...p.attributes??[]]})}const d=jt.get(n),m=y0(f,d),y=zi(t,f,h);y.setName(r.getName()),r.setMesh(y),T0(t,f,y,m,d);const M=f.numProp===3?f.vertProperties:new Float32Array(f.numVert*3);if(f.numProp>3)for(let R=0;R<f.numVert;++R)for(let p=0;p<3;++p)M[R*3+p]=f.vertProperties[R*f.numProp+p];Bt.set(n,Or),e.meshes.push({vertices:M,indices:f.triVerts,id:`${Or++}`});for(const[R,p]of f.runOriginalID.entries()){const w=hn.has(p),g=w?hn.get(p):zs.get(p);if(g==null)continue;h.get(p).material=dn(t,w?g0:pn.get(p)||s);const x=t.createNode("debug").setMesh(zi(t,g,h)).setMatrix(f.transform(R));r.addChild(x)}}function Ac(t,e){t.setMesh(e.getMesh()),e.listChildren().forEach(r=>{const n=r.clone();t.addChild(n)})}function R0(t,e,r,n,s){Ac(e,r);const i=t.createMesh();e.setMesh(i),r.getMesh().listPrimitives().forEach(a=>{const o=a.clone();a.getMaterial()===s&&o.setMaterial(n),i.addPrimitive(o)})}function w0(t,e,r,n){const s=M0(t,r),{manifold:i}=r;if(i!=null){x0(t,s,i);const a=wc(r),o=n.get(i);if(o==null){Ic(t,e,s,i,a);const c=new Map;c.set(a,s),n.set(i,c)}else{const c=o.get(a);if(c==null){const[f,h]=o.entries().next().value;R0(t,s,h,dn(t,a),dn(t,f)),o.set(a,s)}else Ac(s,c)}}return Bt.set(r,Or),e.components.push({id:`${Or++}`,name:r.name,children:i==null?[]:[{objectID:`${Bt.get(i)}`}]}),s}async function bc(t,e){Object.assign(Ft,Tc),Object.assign(Ft,t);const r=new hs,n=Math.sqrt(2)/2,s=1/1e3,i=r.createNode("wrapper").setRotation([-n,0,0,n]).setScale([s,s,s]);r.createScene().addChild(i),er=r.createAnimation(""),gn=!1;const a=Math.round(Ft.animationLength*p0)+1,o=new Float32Array(a),c=new Float32Array(a);for(let x=0;x<a;++x){const T=x/(a-1);o[x]=T*Ft.animationLength,c[x]=Ft.animationMode!=="ping-pong"?T:(1-Math.cos(T*2*Math.PI))/2}_r=r.createAccessor("animation times").setBuffer(r.createBuffer()).setArray(o).setType(X.Type.SCALAR),kn=r.createAccessor("animation weights").setBuffer(r.getRoot().listBuffers()[0]).setArray(c).setType(X.Type.SCALAR),rn=r.createAnimationSampler().setInput(_r).setOutput(kn).setInterpolation("LINEAR"),er.addSampler(rn);const f={meshes:[],components:[],items:[],precision:7,header:{unit:"millimeter",title:"ManifoldCAD.org model",description:"ManifoldCAD.org model",application:"ManifoldCAD.org"}};if(Pt.length>0){const x=new Map,T=new Map;let I=0;for(const b of Pt)x.set(b,w0(r,f,b,T)),b.manifold&&++I;for(const b of Pt){const F=x.get(b),O={objectID:`${Bt.get(b)}`,transform:F.getMatrix()},{parent:C}=b;C==null?(i.addChild(F),f.items.push(O)):(x.get(C).addChild(F),f.components.find(L=>L.id==`${Bt.get(C)}`).children.push(O))}Zt("Total glTF nodes: ",Pt.length,", Total mesh references: ",I)}else{if(e==null){Zt('No output because "result" is undefined and no "GLTFNode"s were created.');return}const x=r.createNode();Ic(r,f,x,e),i.addChild(x),f.items.push({objectID:`${Bt.get(e)}`})}const h=performance.now();console.log(`Manifold took ${(Math.round((h-Mc)/10)/100).toLocaleString()} seconds`),gn||(_r.dispose(),kn.dispose(),rn.dispose(),er.dispose());const d=await xc.writeBinary(r),m=new Blob([d],{type:"application/octet-stream"}),y=new Ou;y.add3dModel("3D/3dmodel.model");const M=Nu(f),R={};R["3D/3dmodel.model"]=br(M),R[Fi.name]=br(Fi.content),R[y.name]=br(y.content);const p=Wu(R),w=new Blob([p],{type:"application/vnd.ms-package.3dmanufacturing-3dmodel+xml"}),g=performance.now();return console.log(`Exporting GLB & 3MF took ${(Math.round((g-h)/10)/100).toLocaleString()} seconds`),{glbURL:URL.createObjectURL(m),threeMFURL:URL.createObjectURL(w)}}function I0(t){const e={},r={globalDefaults:e,exportModels:bc,glMatrix:mc,module:qe,...Object.fromEntries(h0.map(i=>[i,qe[i]]))},s=new Function(...Object.keys(r),`resetToCircularDefaults();
`+t+`
 return typeof result === "undefined" ? undefined : result;`)(...Object.values(r));return{globalDefaults:e,manifold:s}}async function A0(t){Mc=performance.now();const{globalDefaults:e,manifold:r}=I0(t);return await bc(e,r)}self.postMessage(null);if(self.console){const t=self.console.log;self.console.log=function(...e){let r="";for(const n of e)n==null?r+="undefined":typeof n=="object"?r+=JSON.stringify(n,null,4):r+=n.toString();self.postMessage({log:r}),t(...e)}}self.onmessage=async t=>{try{const e=await A0(t.data);self.postMessage(e)}catch(e){console.log(e.toString()),self.postMessage({objectURL:null})}finally{m0()}};
//# sourceMappingURL=worker-wrapper-1e8cd37e.js.map
